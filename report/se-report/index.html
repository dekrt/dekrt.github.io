<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>软件工程课程设计 &amp; 理论课实验报告 | dekrt's blog</title><meta name="keywords" content="报告 | report"><meta name="author" content="dekrt"><meta name="copyright" content="dekrt"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="软件学院软件工程课程设计与理论课实验报告">
<meta property="og:type" content="article">
<meta property="og:title" content="软件工程课程设计 &amp; 理论课实验报告">
<meta property="og:url" content="https://dekrt.cn/report/se-report/index.html">
<meta property="og:site_name" content="dekrt&#39;s blog">
<meta property="og:description" content="软件学院软件工程课程设计与理论课实验报告">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2023/07/26/pCjsWb4.jpg">
<meta property="article:published_time" content="2023-07-18T03:09:40.000Z">
<meta property="article:modified_time" content="2023-10-12T02:26:22.286Z">
<meta property="article:author" content="dekrt">
<meta property="article:tag" content="报告 | report">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2023/07/26/pCjsWb4.jpg"><link rel="shortcut icon" href="https://s1.ax1x.com/2023/04/14/ppzvSxK.jpg"><link rel="canonical" href="https://dekrt.cn/report/se-report/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '软件工程课程设计 & 理论课实验报告',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-12 10:26:22'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="dekrt's blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s1.ax1x.com/2023/04/14/ppzvSxK.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s1.ax1x.com/2023/07/26/pCjsWb4.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">dekrt's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">软件工程课程设计 &amp; 理论课实验报告</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-18T03:09:40.000Z" title="发表于 2023-07-18 11:09:40">2023-07-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-12T02:26:22.286Z" title="更新于 2023-10-12 10:26:22">2023-10-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/report/">report</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">40.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>176分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="软件工程课程设计 &amp; 理论课实验报告"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/report/se-report/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/report/se-report/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>1-6为课程设计报告，7为理论课报告。</p>
<p>项目Github地址：<a target="_blank" rel="noopener" href="https://github.com/dekrt/TransWe">dekrt/TransWe: HUST-SSE
Software-Engineering-Curriculum-Design: Translation Miniprogram |
华中科技大学软件学院软件工程课设：机器翻译小程序 (github.com)</a></p>
<p>如果帮助到了你，可以进Github页面点个Star噢！</p>
<p>报告仓库：<a target="_blank" rel="noopener" href="https://github.com/dekrt/Reports">dekrt/Reports:
HUST SSE Courses Reports | 华科软件学院课程报告 (github.com)</a></p>
</blockquote>
<h1 id="项目概述">1. 项目概述</h1>
<h2 id="项目基本介绍">1.1 项目基本介绍</h2>
<center>
<img src="/report/se-report/icon.jpg" align="center" width="40%">
</center>
<center>
<h1 align="center">
TransWe
</h1>
<h4 align="center">
Translate WeChat Mini Program
</h4>
简体中文   |   
<a target="_blank" rel="noopener" href="https://github.com/dekrt/TransWe/blob/main/README-en.md">English</a>
<br>
<a href="https://dekrt.cn/"><img src="https://img.shields.io/badge/Author-dekrt-blue"></a>
</center>
<h3 id="ui界面">📱 UI界面</h3>
<p><img src="/report/se-report/UI_Translation_Text.png">
<img src="/report/se-report/UI_Choose_Language.png">
<img src="/report/se-report/UI_OCR_Translation.png">
<img src="/report/se-report/UI_Translation_Voice.png">
<img src="/report/se-report/UI_Translation_History.png"></p>
<h3 id="项目介绍">📖 项目介绍</h3>
<p><strong>TransWe</strong>意为<code>Translation+Wechat</code>，是一个功能强大的机器翻译微信小程序，它能够通过后台机器翻译服务快速、准确地翻译各种语言。它还支持第三方OCR、语音识别和语音合成集成，为用户提供更便捷、高效的翻译服务。</p>
<p>TransWe功能包括：</p>
<ol type="1">
<li>机器翻译：TransWe使用后台机器翻译服务，支持多种语言翻译，包括英语、中文、法语、德语、日语、韩语等，能够准确、快速地翻译用户的文本。</li>
<li>OCR识别：TransWe支持第三方OCR识别，用户只需要上传图片或拍摄照片，就能将图片中的文字转换为文本进行翻译。</li>
<li>语音识别：TransWe支持第三方语音识别，用户只需要录制音频，就能将音频中的语音转换为文本进行翻译。</li>
<li>语音合成：TransWe支持第三方语音合成，用户能够将翻译结果通过语音合成功能转换为语音输出，提高用户的交互体验。</li>
</ol>
<p>TransWe使用简单，功能强大，只需选择需要翻译的语言，输入要翻译的文本，点击“翻译”按钮，TransWe将自动完成翻译，如果需要使用OCR识别、语音识别或语音合成功能，可以选择相应功能按钮，按照提示进行操作即可。同时TransWe还是一款完全免费的小程序，旨在为用户提供更便捷、高效的翻译服务。无论是旅行、学习还是工作，TransWe都能帮助用户轻松应对语言难题。</p>
<h3 id="功能特性">🚀 功能特性</h3>
<p><strong>TransWe</strong>是一款集多种功能于一身的微信小程序，旨在为用户提供便捷、高效的翻译服务。以下是TransWe的主要功能特性：</p>
<ol type="1">
<li><strong>多语言机器翻译</strong>：TransWe支持多种语言的翻译，包括但不限于英语、中文、法语、德语、日语、韩语等。我们的后台机器翻译服务能够快速、准确地翻译用户的文本，满足用户在不同场景下的翻译需求。</li>
<li><strong>OCR识别</strong>：TransWe集成了第三方OCR识别技术，用户只需上传图片或拍摄照片，我们的小程序就能将图片中的文字识别出来，转换为文本进行翻译。这一功能特别适用于处理图片中的外语文字，极大地提高了用户的翻译效率。</li>
<li><strong>语音识别</strong>：TransWe支持第三方语音识别技术，用户只需录制音频，我们的小程序就能将音频中的语音识别并转换为文本进行翻译。这一功能使得用户在无法输入文字时，仍然可以轻松获取翻译服务。</li>
<li><strong>语音合成</strong>：TransWe集成了第三方语音合成技术，用户可以将翻译结果转换为语音输出，提高了用户的交互体验，特别适用于视力不便或者需要听力辅助的用户。</li>
</ol>
<p>TransWe的使用非常简单，用户只需选择需要翻译的语言，输入要翻译的文本，我们的小程序就会自动完成翻译。如果用户需要使用OCR识别、语音识别或语音合成功能，只需选择相应的功能按钮，按照提示进行操作即可。</p>
<p>TransWe是一款完全免费的小程序，我们的目标是为用户提供最便捷、高效的翻译服务。无论是旅行、学习还是工作，TransWe都能帮助用户轻松应对语言难题，让语言交流变得无障碍。</p>
<h3 id="目录结构描述">🧱 目录结构描述</h3>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├─code                              <span class="regexp">//</span>代码文件夹</span><br><span class="line">│  ├─assets                         <span class="regexp">//</span>外部工具</span><br><span class="line">│  │  └─iconfont                    <span class="regexp">//</span>矢量图库</span><br><span class="line">│  ├─components                     <span class="regexp">//</span>组件文件夹</span><br><span class="line">│  │  ├─bottom-button               <span class="regexp">//</span>录音按钮</span><br><span class="line">│  │  ├─modal                       <span class="regexp">//</span>复制按钮</span><br><span class="line">│  │  ├─play-icon                   <span class="regexp">//</span>组件动画</span><br><span class="line">│  │  ├─result-bubble               <span class="regexp">//</span>翻译气泡</span><br><span class="line">│  │  └─waiting-icon                <span class="regexp">//</span>等待图标</span><br><span class="line">│  ├─imgs                           <span class="regexp">//</span>小程序内部图片文件夹</span><br><span class="line">│  ├─pages                          <span class="regexp">//</span>所有页面					    </span><br><span class="line">│  │  ├─choose_language             <span class="regexp">//</span>选择语言</span><br><span class="line">│  │  ├─edit                        <span class="regexp">//</span>文本编辑页面</span><br><span class="line">│  │  ├─getPic                      <span class="regexp">//</span>获取图片</span><br><span class="line">│  │  ├─history                     <span class="regexp">//</span>翻译历史</span><br><span class="line">│  │  ├─history_test                <span class="regexp">//</span>翻译历史前端测试</span><br><span class="line">│  │  ├─index                       <span class="regexp">//</span>主页</span><br><span class="line">│  │  ├─index_test                  <span class="regexp">//</span>主页前端测试</span><br><span class="line">│  │  ├─OCR                         <span class="regexp">//</span>拍照翻页界面</span><br><span class="line">│  │  └─voice_translation           <span class="regexp">//</span>语音翻译界面</span><br><span class="line">│  ├─TDD_test_cdt                   <span class="regexp">//</span>TDD开发语音翻译</span><br><span class="line">│  ├─TDD_test_zxk                   <span class="regexp">//</span>TDD开发文本翻译</span><br><span class="line">│  └─utils                          <span class="regexp">//</span>插件</span><br><span class="line">│      api.js                       <span class="regexp">//</span>翻译api接口</span><br><span class="line">│      conf.js                      <span class="regexp">//</span>翻译配置</span><br><span class="line">│      md5.min.js                   <span class="regexp">//</span>获取MD5加密</span><br><span class="line">│      util.js                      <span class="regexp">//</span>获取时间配置</span><br><span class="line">├─docs                              <span class="regexp">//</span>所有文档</span><br><span class="line">│      API.md                       <span class="regexp">//</span>API接口文档</span><br><span class="line">│      CurriculumDesignReport.md    <span class="regexp">//</span>课设报告文档</span><br><span class="line">│      SystemArchitecture.md        <span class="regexp">//</span>系统架构文档</span><br><span class="line">│      SystemDesign.md              <span class="regexp">//</span>系统设计文档</span><br><span class="line">│      SystemRequirement.md         <span class="regexp">//</span>系统需求文档</span><br><span class="line">│      UI_Design.md                 <span class="regexp">//</span>UI设计文档</span><br><span class="line">│      UserRequirement.md           <span class="regexp">//</span>用户需求文档</span><br><span class="line">└─pics                              <span class="regexp">//</span>图片</span><br></pre></td></tr></table></figure>
<h3 id="版本内容更新">⬇️ 版本内容更新</h3>
<ul>
<li><strong>2023/06/02 TransWe v1.0</strong>: 基本实现全部功能</li>
</ul>
<h3 id="协议">📃 协议</h3>
<p><img src="https://img.shields.io/github/license/dekrt/TransWe"></p>
<blockquote>
<p><strong>警告</strong></p>
<p>除GPLv3许可下的源代码外，其他方均禁止使用TransWe的名义作为下载器应用，TransWe的衍生产品亦同。
衍生品包括但不限于分叉和非官方构建。</p>
</blockquote>
<h2 id="github仓库地址">1.2 Github仓库地址</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/dekrt/TransWe">TransWe</a>: <a target="_blank" rel="noopener" href="https://github.com/dekrt/TransWe" class="uri">https://github.com/dekrt/TransWe</a></p>
<h2 id="人员基本分工">1.3 人员基本分工</h2>
<h3 id="dekrt负责人">1.3.1 <strong>dekrt</strong>（负责人）：</h3>
<p>作为项目的负责人，dekrt将承担项目的后端开发工作，工作内容丰富且富有挑战性，主要包括：</p>
<ol type="1">
<li><strong>负责Github仓库管理</strong>：dekrt将负责整个Github仓库的管理工作，包括代码的整理、归档以及版本的管理。他还将负责编写详实的README文档，以便于其他团队成员以及可能接触项目的人对项目有明确的了解。</li>
<li><strong>将需求作为Issue录入</strong>：为了保证项目开发的流畅进行，dekrt将负责将所有的需求作为Issue录入Github，这样可以保证每一个需求都能被详细跟踪，从而高效地进行项目管理。</li>
<li><strong>共同进行系统设计：</strong>他将积极参与系统设计，利用他的技术专长帮助设计出高效且易于维护的系统。</li>
<li><strong>用户界面设计：</strong>dekrt将负责用户界面的设计和开发，他会注重用户体验，致力于创建出既易于使用又美观的用户界面。</li>
<li><strong>系统流程分析：</strong>他将通过绘制时序图进行系统流程分析，这有助于更好地理解和设计系统。</li>
<li><strong>TDD测试：</strong>dekrt将采用测试驱动开发（TDD）的方法，为代码编写详尽的单元测试，以确保代码的质量和稳定性。</li>
<li><strong>机器翻译服务</strong>：dekrt将负责与后台机器翻译服务的接口开发和维护，他将通过技术手段，确保翻译服务的准确性和效率，提供优质的用户体验。</li>
<li><strong>拍照翻译服务：</strong>他还将负责开发拍照翻译服务，使用户能够通过拍照的方式获得翻译结果，为用户提供更多的便利。</li>
<li><strong>前端页面编写</strong>：dekrt将完成<code>index(小程序主页)、getPic拍照界面）、OCR（获取翻译结果）、history（翻译历史）</code>等页面的前端和后端代码编写，他将负责实现用户界面设计，同时也会对代码进行详细的测试，以保证其正确性和稳定性。</li>
<li><strong>数据库管理</strong>：他将负责数据库的设计和管理，通过合理的数据结构设计和索引优化，确保用户数据的安全和完整。</li>
<li><strong>性能优化</strong>：dekrt将专注于系统的性能优化，通过合理的代码架构和算法优化，他将确保系统在高并发情况下的稳定运行。</li>
<li><strong>编写文档</strong>：为了保证项目的可维护性和持续性，他将负责编写清晰且详细的开发文档，以便于后续的开发和维护工作。</li>
</ol>
<h3 id="cdt副负责人">1.3.2 <strong>cdt</strong>（副负责人）：</h3>
<p>cdt将主要负责项目的前端开发和用户体验设计，包括但不限于：</p>
<ol type="1">
<li><strong>共同撰写需求</strong>：一起参与需求讨论和构思，确保对项目的理解一致，从而能够产生详尽而有用的项目需求文档。在撰写需求过程中，努力保证每个要求都准确、清晰，易于理解且可行。</li>
<li><strong>共同进行系统设计</strong>：
在深入理解了项目需求之后，参与到系统设计中来。确保每个设计决策都能满足项目的需求，同时也会考虑到系统的可扩展性和可维护性。</li>
<li><strong>辅助用户界面设计</strong>：优化部分用户页面，以用户为中心，优化用户体验，使其简单易用。</li>
<li><strong>系统设计</strong>：参与系统架构的设计，负责组件设计以及组件接口的设计。</li>
<li><strong>语音合成功能</strong>：负责语音合成功能的开发和测试，和相关页面集成，确保这些功能的正常运行。</li>
<li><strong>组件开发</strong>：负责components中五个小组件的开发和测试，每一个小组件都将被精心设计和编写，以确保它们在整个系统中都能发挥关键的作用。</li>
<li><strong>页面编写</strong>：完成了<strong>choose_languege</strong>（语言选择页面）、<strong>edit</strong>（文本编辑页面）、<strong>voice_translation</strong>（语音翻译页面）这几个页面的前端、后端代码编写，实现了用户界面设计，和界面的逻辑功能，并进行了测试</li>
<li><strong>编写文档</strong>：包括但不限于设计文档、开发文档、测试文档。</li>
</ol>
<h1 id="需求描述">2. 需求描述</h1>
<h2 id="功能性描述">2.1 功能性描述</h2>
<h3 id="用户需求">2.1.1 用户需求</h3>
<h4 id="集成翻译服务translation-service">1 集成翻译服务（Translation
Service）</h4>
<ol type="1">
<li>用户需求：
<ul>
<li>用户在输入框中输入文字，选择输入语言与目标语言，程序在输出框中给出翻译结果。</li>
</ul></li>
<li>用户需求标识：<strong>TransWe-UR-TS</strong></li>
</ol>
<h4 id="集成第三方ocr功能optical-character-recognition">2
集成第三方OCR功能（Optical Character Recognition）</h4>
<ol type="1">
<li>用户需求：
<ul>
<li>用户可以选择使用图片转文字服务（OCR），并进行拍照（或选择图库中的图片）进行翻译。</li>
</ul></li>
<li>用户需求标识 ：<strong>TransWe-UR-OCR</strong></li>
</ol>
<h4 id="集成第三方语音识别speech-recognition">3
集成第三方语音识别(Speech Recognition):</h4>
<ol type="1">
<li>用户需求：
<ul>
<li>用户选择输入语言及目标语言，通过语音进行输入，程序以文字形式展示输入结果与翻译结果。</li>
</ul></li>
<li>用户需求标识：<strong>TransWe-UR-SR</strong></li>
</ol>
<h4 id="集成第三方语音合成speech-synthesis">4 集成第三方语音合成（Speech
Synthesis）</h4>
<ol type="1">
<li>用户需求：
<ul>
<li>用户在翻译完成后点击发声按钮，程序将翻译结果以语音的形式进行输出。</li>
</ul></li>
<li>用户需求标识：<strong>TransWe-UR-SS</strong></li>
</ol>
<h3 id="系统需求">2.1.2 系统需求</h3>
<h4 id="基础翻译功能transwe-sr-ts">1 基础翻译功能（TransWe-SR-TS）</h4>
<ol type="1">
<li><strong>初始假设：</strong></li>
</ol>
<ul>
<li>用户在输入框中输入文字，选择输入语言与目标语言，程序在输出框中给出翻译结果。</li>
</ul>
<ol start="2" type="1">
<li><strong>正常状态：</strong></li>
</ol>
<ul>
<li>用户在输入框中输入待翻译的文本，<strong>程序会自动检测输入语言</strong>，用户在下拉菜单中选择相应的目标语言。</li>
<li>用户也可以<strong>手动选择输入语言</strong>。输入完成后，程序将进行翻译并在输出框中显示翻译结果。</li>
</ul>
<ol start="3" type="1">
<li><strong>有哪些会出错：</strong></li>
</ol>
<ul>
<li>输入的文本中包含无法识别的字符或语言。程序会提示用户重新输入或手动选择语言。</li>
<li>输入的文本过长或复杂，程序无法进行翻译。程序会提示用户缩短输入文本或尝试其他翻译方式。</li>
<li>网络连接不稳定，程序无法进行翻译。程序会提示用户检查网络连接并重试。</li>
</ul>
<ol start="4" type="1">
<li><strong>其他活动：</strong></li>
</ol>
<ul>
<li>用户可以在下拉菜单中选择默认语言，程序会在下一次启动时自动选择该语言。</li>
<li>程序会记录用户的翻译历史，并允许用户在历史记录中查看以前的翻译结果。</li>
</ul>
<ol start="5" type="1">
<li><strong>完成的系统状态：</strong></li>
</ol>
<ul>
<li>用户可以通过打开程序，并进入翻译界面来进行翻译。程序会自动检测输入语言，并在下拉菜单中选择相应的目标语言。</li>
<li>用户在输入框中输入待翻译的文本后，程序会进行翻译并在输出框中显示翻译结果。</li>
<li>程序记录了用户的翻译历史，并允许用户在历史记录中查看以前的翻译结果。</li>
</ul>
<h4 id="集成第三方ocr功能的脚本transwe-sr-ocr">2
集成第三方OCR功能的脚本（TransWe-SR-OCR）</h4>
<ol type="1">
<li><strong>初始假设：</strong></li>
</ol>
<ul>
<li>用户需要使用一个微信翻译小程序，该小程序集成了第三方OCR功能，用户可以通过拍照或上传照片将图片中的待翻译文本识别成目标语言并显示到图片上。</li>
</ul>
<ol start="2" type="1">
<li><strong>正常状态：</strong></li>
</ol>
<ul>
<li><p>用户打开小程序，选择OCR功能，进入拍照界面。用户可以<strong>使用手机摄像头拍下待识别的图片</strong>，也可以<strong>按下图库按钮上传照片</strong>。进入图片编辑界面后，<strong>用户可以选择整张图片或者框选一部分图片</strong>，用户需要选择待翻译的语言种类和目标语言种类。检测到用户按下翻译按钮时，系统应该调用OCR服务对目标图片进行文字识别，并在界面上显示识别结果。</p></li>
<li><p>系统应该允许用户在翻译后重新选择图片，重新选择翻译语言并进行翻译。</p></li>
</ul>
<ol start="3" type="1">
<li><strong>有哪些会出错：</strong></li>
</ol>
<ul>
<li>系统权限不足，无法访问用户图库。</li>
<li>第三方OCR功能出现故障，导致无法完成文字识别。</li>
</ul>
<ol start="4" type="1">
<li><strong>其他活动：</strong></li>
</ol>
<ul>
<li>系统应该保证用户隐私，不记录用户的OCR识别记录。</li>
<li>系统应该对用户图库进行保护，确保不被未授权的其他脚本访问。</li>
</ul>
<ol start="5" type="1">
<li><strong>完成的系统状态：</strong></li>
</ol>
<ul>
<li>用户可以通过OCR功能成功识别图片中的文字并进行翻译。</li>
</ul>
<h4 id="语音识别功能transwe-sr-sr">3 语音识别功能（TransWe-SR-SR）</h4>
<ol type="1">
<li><strong>初始假设：</strong></li>
</ol>
<ul>
<li>用户希望通过语音输入来输入翻译内容，系统需要进行语音识别功能，将语音转换为文本，再进行翻译操作。</li>
</ul>
<ol start="2" type="1">
<li><strong>正常状态：</strong></li>
</ol>
<ul>
<li>用户点击语音输入按钮，系统开始录音并将录音转换为文本格式，并输出到屏幕上。</li>
<li>系统对文本<strong>进行分词</strong>并进行翻译操作。</li>
<li>翻译结果以文本形式<strong>呈现在界面上</strong>。</li>
</ul>
<ol start="3" type="1">
<li><strong>有哪些会出错：</strong></li>
</ol>
<ul>
<li>语音输入的质量不好，无法被识别成文本。系统应该提示用户录音质量不好，请重试。</li>
<li>翻译服务不可用或异常。系统应该提示用户翻译服务暂时不可用，请稍后再试。</li>
</ul>
<ol start="4" type="1">
<li><strong>其他活动：</strong></li>
</ol>
<ul>
<li>系统应该保证用户隐私，不记录用户的语音输入内容。</li>
<li>系统应该对录音文件进行保护，确保不被未授权的人访问。</li>
</ul>
<ol start="5" type="1">
<li><strong>完成的系统状态：</strong></li>
</ol>
<ul>
<li>用户可以通过语音输入方式进行翻译操作。</li>
<li>系统可以对语音进行识别并将其转换为文本格式。</li>
<li>系统可以对文本进行分词和翻译操作，将翻译结果呈现在界面上。</li>
</ul>
<h4 id="语音合成功能transwe-ur-ss">4 语音合成功能（TransWe-UR-SS）</h4>
<ol type="1">
<li><strong>初始假设：</strong></li>
</ol>
<ul>
<li>用户希望通过语音的形式来输出翻译内容，系统需要进行语音合成功能，将文本转换为语音，再通过扬声器播放。</li>
</ul>
<ol start="2" type="1">
<li><strong>正常状态：</strong></li>
</ol>
<ul>
<li>用户正常进行翻译后，点击语音输出按钮，系统开始进行语音合成并将翻译结果以<strong>语音的形式进行输出</strong>。</li>
<li>翻译结果以<strong>文本形式呈现</strong>在界面上。</li>
</ul>
<ol start="3" type="1">
<li><strong>有哪些会出错：</strong></li>
</ol>
<ul>
<li>系统语音合成功能出现故障，无法将文本正确转换为语音。</li>
<li>扬声器或音频设备出现故障，无法正常播放语音。</li>
</ul>
<ol start="4" type="1">
<li><strong>其他活动：</strong></li>
</ol>
<ul>
<li>当正在播放合成的语音时，图标的颜色将会改变；播放完成后回到原来的颜色。</li>
</ul>
<ol start="5" type="1">
<li><strong>完成的系统状态：</strong></li>
</ol>
<ul>
<li>用户可以通过语音输入并输出翻译内容，系统可以将文本转换为语音，并通过扬声器播放出来。系统记录了用户的输入和输出内容，并可以对其进行分析和统计。</li>
</ul>
<h2 id="非功能性需求">2.2 非功能性需求</h2>
<h3 id="性能需求">2.2.1 <strong>性能需求</strong>：</h3>
<ul>
<li>翻译响应时间：对于用户输入的文本，系统应在1秒内返回翻译结果。</li>
<li>OCR识别和语音识别的处理时间：对于用户上传的图片或音频，系统应在5秒内完成识别并返回结果。</li>
<li>系统应能够支持高并发请求，即在用户量剧增的情况下，系统的性能不会显著下降。</li>
</ul>
<h3 id="安全性需求">2.2.2 <strong>安全性需求</strong>：</h3>
<ul>
<li>用户的个人信息和使用数据应得到充分保护，不得泄露给第三方。</li>
<li>系统应具备防止恶意攻击的能力，如DDoS攻击、SQL注入等。</li>
</ul>
<h3 id="可用性需求">2.2.3 <strong>可用性需求</strong>：</h3>
<ul>
<li>系统的正常运行时间应达到99.9%。</li>
<li>在出现故障时，系统应能在1小时内恢复正常。</li>
</ul>
<h3 id="可维护性需求">2.2.4 <strong>可维护性需求</strong>：</h3>
<ul>
<li>系统应具备良好的模块化和文档化，以便进行维护和升级。</li>
<li>系统应能够容易地添加新的语言支持和新的功能。</li>
</ul>
<h3 id="可扩展性需求"><strong>2.2.5 可扩展性需求</strong>：</h3>
<ul>
<li>系统应设计成可扩展的架构，以便在未来可以添加更多的功能，如多语言支持、语音翻译等。</li>
</ul>
<h3 id="用户体验需求">2.2.6 <strong>用户体验需求</strong>：</h3>
<ul>
<li>系统的用户界面应简洁易用，用户能够快速理解如何使用各项功能。</li>
<li>系统应提供用户反馈功能，用户可以方便地报告问题和提出建议。</li>
</ul>
<h1 id="系统设计">3. <strong>系统设计</strong></h1>
<h2 id="架构设计">3.1 <strong>架构设计</strong></h2>
<p>我们的翻译小程序采用分层架构的架构模式，架构示意图如下：</p>
<p><img src="/report/se-report/system_architecture.png"></p>
<h3 id="表示层presentation-layer">3.1.1 表示层（Presentation
Layer）</h3>
<p>表示层是用户与系统交互的界面，包括用户界面、数据输入、输出等。这一层主要负责将用户请求传递给下一层，并将处理结果返回给用户。在我们的翻译软件中，表示层包括用户输入文本的界面、显示翻译结果的界面、对翻译结果进行输出的页面等，以及获取用户的授权信息。</p>
<h3 id="应用层application-layer">3.1.2 应用层（Application Layer）</h3>
<p>应用层是系统的核心层，它实现了翻译的核心算法和业务逻辑，包括文本处理、翻译算法等。这一层主要负责接收并处理表示层传递的请求，然后调用其他层的服务，最后将处理结果返回给表示层。在我们的小程序中，应用层负责：</p>
<ol type="1">
<li>获取用户输入：
<ul>
<li>手动输入</li>
<li>OCR识别</li>
<li>语音输入</li>
</ul></li>
<li>获取输出结果：
<ul>
<li>文本输出</li>
<li>语音合成输出</li>
</ul></li>
</ol>
<h3 id="服务层service-layer">3.1.3 服务层（Service Layer）</h3>
<p>服务层为应用层提供支持，包括网络通信、数据访问、存储等服务。这一层主要负责处理数据的存储和访问，以及与其他系统的交互。在我们的翻译软件中，服务层可以包括调用翻译接口获取翻译结果、调取OCR接口获取OCR识别结果、调取语音合成API对翻译结果进行语音输出等。</p>
<p>总的来说，以上三个层级构成了一个完整的翻译软件系统，每个层级都负责不同的功能，各司其职。这种分层架构模式使得系统更加清晰、易于扩展和维护。</p>
<h2 id="界面原型设计">3.2<strong>界面原型设计</strong></h2>
<h3 id="主页面main-page">3.2.1. 主页面（Main Page）</h3>
<p>主页是小程序的入口，包括小程序的基本信息和主要功能模块。页面包含四个模块，分别是文字翻译，录音按钮、OCR翻译按钮和翻译历史记录。</p>
<ul>
<li><strong>文本输入框</strong>：用户可以在这个框中手动输入需要翻译的文本。</li>
<li><strong>翻译框</strong>：用户输入文本、点击这个按钮开始翻译。</li>
<li><strong>语音播放器</strong>：用户点击播放语音。</li>
<li><strong>语言选择器</strong>：用户可以在这里选择源语言和目标语言。</li>
<li><strong>语音按钮</strong>：用户可以点击这个按钮，跳转到语音翻译页面。</li>
<li><strong>OCR按钮</strong>：用户可以点击这个按钮，跳转到语音OCR页面。</li>
<li><strong>翻译历史按钮</strong>：用户可以点击这个按钮，跳转到翻译历史页面。</li>
</ul>
<h3 id="语言选择页settings-page">3.2.2.语言选择页（Settings Page）</h3>
<p>语言选择页提供用户多种翻译语言。用户可以选择支持的语言。</p>
<ul>
<li><strong>语言设置</strong>：用户可以在这里更改默认的源语言和目标语言。</li>
</ul>
<h3 id="语音翻译页voice-translation-page">3.2.3.语音翻译页（Voice
Translation Page）</h3>
<p>语音翻译页是用户输入需要翻译的语音的页面。页面主要包括录音按钮、语言选择器和翻译结果框。翻译结果框会以卡片形式保存下来，用户可以编辑录入的文字。</p>
<ul>
<li><strong>录音按钮</strong>：位于页面下方，用户可以点击此按钮开始进行语音输入，输入的语音将被实时转化为文字并显示在结果框内。</li>
<li><strong>语言选择器</strong>：位于页面顶部，用户可以在此一键切换中英文。</li>
<li><strong>翻译结果框</strong>显示用户录音输入的文字以及翻译结果。翻译结果以卡片形式保存并展示，每个卡片包括原文和译文，用户可以删除不要的卡片。</li>
<li><strong>编辑按钮</strong>：每个翻译结果卡片右上角都会有一个编辑按钮，用户点击后可以对录入的文字进行编辑，编辑完成后翻译结果将自动更新。</li>
<li><strong>返回按钮</strong>：页面左上角有一个返回按钮，用户点击后可以返回主页面。</li>
</ul>
<h3 id="ocr拍照翻译页面ocr-translation-page">3.2.4.OCR拍照翻译页面（OCR
Translation Page）</h3>
<p>OCR拍照翻译页面是用户能够通过拍照进行翻译的地方。</p>
<ul>
<li><strong>拍照按钮</strong>：用户可以点击这个按钮，利用手机相机进行拍摄，完成拍摄后，系统会自动进行识别并将图片中的文字进行翻译。</li>
<li><strong>翻译结果展示区</strong>：系统完成翻译后，翻译结果将会在这个区域显示，用户可以查看翻译结果。</li>
</ul>
<h3 id="翻译历史页translation-history-page">3.2.5.翻译历史页（Translation
History Page）</h3>
<p>翻译历史页面保存用户之前的文字翻译和语音翻译记录。</p>
<ul>
<li><strong>翻译历史</strong>：用户可以划动屏幕查询所有的本地翻译记录。每条历史以卡片形式保存并展示，每个卡片包括原文和译文。</li>
</ul>
<h2 id="详细设计">3.3 <strong>详细设计</strong></h2>
<h3 id="组件设计">3.3.1. 组件设计</h3>
<p><img src="/report/se-report/Package_Diagram.png"></p>
<h3 id="组件接口设计">3.3.2. 组件接口设计</h3>
<h4 id="数据库接口">1 数据库接口</h4>
<p><img src="/report/se-report/Interface_DataBase.png"></p>
<ul>
<li><code>saveTranslationRecord(record: TranslationRecord):
void</code>：保存翻译记录。</li>
<li><code>getTranslationRecords(userId: String):
List&lt;TranslationRecord&gt;</code>：获取指定用户的翻译记录列表。</li>
</ul>
<h4 id="语言设置接口">2 语言设置接口</h4>
<p><img src="/report/se-report/Interface_LanguageSetting.png"></p>
<ul>
<li><code>sourceLanguage: String</code>：源语言属性。</li>
<li><code>targetLanguage: String</code>：目标语言属性。</li>
<li><code>setSourceLanguage(sourceLanguage: String):
void</code>：设置源语言。</li>
<li><code>setTargetLanguage(targetLanguage: String):
void</code>：设置目标语言。</li>
<li><code>getSourceLanguage(): String</code>：获取源语言。</li>
<li><code>getTargetLanguage(): String</code>：获取目标语言。</li>
</ul>
<h4 id="ocr翻译接口">3 OCR翻译接口</h4>
<p><img src="/report/se-report/Interface_OCRTranslation.png"></p>
<ul>
<li><code>recognizeImage(image: ImageData, sourceLanguage: String,
targetLanguage: String):
String</code>：将图像数据识别为文本，并将其翻译成指定的目标语言。</li>
</ul>
<h4 id="语音翻译接口">4 语音翻译接口</h4>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/Interface_Speech_Translation.png&quot; /&gt;</code></pre>
</div>
<ul>
<li><code>recognizeSpeech(audio: AudioData, sourceLanguage: String,
targetLanguage: String):
String</code>：将音频数据识别为文本，并将其翻译成指定的目标语言。</li>
</ul>
<h4 id="文本翻译接口">5 文本翻译接口</h4>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/Interface_TextTranslation.png&quot; /&gt;</code></pre>
</div>
<ul>
<li><code>translateText(text: String, sourceLanguage: String,
targetLanguage: String):
String</code>：将指定的文本翻译成指定的目标语言。</li>
</ul>
<h4 id="用户界面接口">6 用户界面接口</h4>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/Interface_UserInterface.png&quot; /&gt;</code></pre>
</div>
<ul>
<li><code>showTextInputBox(): void</code>：显示文本输入框。</li>
<li><code>showTranslationResult(text: String):
void</code>：显示翻译结果。</li>
<li><code>showVoiceInputButton(): void</code>：显示语音输入按钮。</li>
<li><code>showOCRButton(): void</code>：显示 OCR 按钮。</li>
<li><code>showHistoryButton(): void</code>：显示历史记录按钮。</li>
<li><code>showVoiceAndCopy(): void</code>：显示语音合成和复制按钮。</li>
</ul>
<h4 id="语音录入接口">7 语音录入接口</h4>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/Interface_VoiceAndCopy.png&quot; /&gt;</code></pre>
</div>
<ul>
<li><code>getVoice(text: String, targetLanguage: String):
AudioData</code>：将指定的文本转换为语音，并返回音频数据。</li>
<li><code>copyText(text: String):
void</code>：将指定的文本复制到剪贴板。</li>
</ul>
<h4 id="页面控制接口">8 页面控制接口</h4>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/Interface_PageController.png&quot; /&gt;</code></pre>
</div>
<ul>
<li><code>+getToPage(page: String)</code>：表示该接口具有一个公共方法
<code>getToPage</code>，该方法接受一个参数 <code>page</code>，类型为
<code>String</code>，用于获取指定页面的内容。</li>
</ul>
<h4 id="api信息配置接口">9 API信息配置接口</h4>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/Interface_API_Info_Config.png&quot; /&gt;</code></pre>
</div>
<ul>
<li><code>-api_config: ApiConfig</code>：表示该接口具有一个私有属性
<code>api_config</code>，其类型为
<code>ApiConfig</code>。私有属性只能在该类内部访问。</li>
<li><code>+setApiConfig(api_config :
ApiConfig)</code>：表示该接口具有一个公共方法
<code>setApiConfig</code>，该方法接受一个参数
<code>api_config</code>，类型为 <code>ApiConfig</code>，用于设置
<code>api_config</code> 的值。</li>
<li><code>+getApiConfig(): ApiConfig</code>：表示该接口具有一个公共方法
<code>getApiConfig</code>，该方法返回 <code>api_config</code>
的值，类型为 <code>ApiConfig</code>。</li>
</ul>
<h4 id="翻译记录">10 翻译记录</h4>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/Class_TranslationRecord.png&quot; /&gt;</code></pre>
</div>
<ul>
<li><code>userId: String</code>：用户 ID 属性。</li>
<li><code>sourceText: String</code>：源文本属性。</li>
<li><code>sourceLanguage: String</code>：源语言属性。</li>
<li><code>targetText: String</code>：目标文本属性。</li>
<li><code>targetLanguage: String</code>：目标语言属性。</li>
<li><code>timestamp: DateTime</code>：时间戳属性。</li>
<li><code>getUserId(): String</code>：获取用户 ID。</li>
<li><code>getSourceText(): String</code>：获取源文本。</li>
<li><code>getSourceLanguage(): String</code>：获取源语言。</li>
<li><code>getTargetText(): String</code>：获取目标文本。</li>
<li><code>getTargetLanguage(): String</code>：获取目标语言。</li>
<li><code>getTimestamp(): DateTime</code>: 获取时间戳。</li>
</ul>
<h3 id="系统流程分析">3.3.3 系统流程分析</h3>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/UseCase.png&quot; width = &quot;40%&quot;/&gt;</code></pre>
</div>
<p>结合上述用例图，我们得出以下的时序图：</p>
<h4 id="文本翻译时序图">1 文本翻译时序图</h4>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/Sequence_Text_Translation.png&quot; /&gt;</code></pre>
</div>
<h4 id="拍照翻译时序图">2 拍照翻译时序图</h4>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/Sequence_OCR_Translation.png&quot; /&gt;</code></pre>
</div>
<h4 id="语音翻译时序图">3 语音翻译时序图</h4>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/Sequence_Speech_Recognition.png&quot; /&gt;</code></pre>
</div>
<h4 id="语音合成时序图">4 语音合成时序图</h4>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/Sequence_Speech_Synthesis.png&quot; /&gt;</code></pre>
</div>
<p>​</p>
<h4 id="查看翻译历史时序图">5 查看翻译历史时序图</h4>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/Sequence_Get_Translation_History.png&quot; /&gt;</code></pre>
</div>
<h1 id="系统实现和测试">4. 系统实现和测试</h1>
<h2 id="系统实现">4.1 系统实现</h2>
<blockquote>
<p>开发语言：Html(Wxml) + Css(Wxss) + javascript；</p>
<p>开发框架：微信原生框架 + Less</p>
<p>开发环境：微信开发者工具 + Vscode</p>
</blockquote>
<h3 id="assets">4.1.1 assets/</h3>
<h4 id="assetsiconfont.wxss">4.1.1.1 assets/iconfont.wxss</h4>
<p>这段代码在全局在全局引用了Iconfont的Icon图标。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">@font-face</span> &#123;<span class="attribute">font-family</span>: <span class="string">&quot;iconfont&quot;</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;https://at.alicdn.com/t/font_811118_f7oh8iao9yd.ttf&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;truetype&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.iconfont</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>:<span class="string">&quot;iconfont&quot;</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">font-size</span>:<span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">font-style</span>:normal;</span><br><span class="line">  -webkit-<span class="attribute">font-smoothing</span>: antialiased;</span><br><span class="line">  -moz-osx-<span class="attribute">font-smoothing</span>: grayscale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.icon-down</span>:before &#123; content: <span class="string">&quot;\e600&quot;</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.icon-close</span>:before &#123; content: <span class="string">&quot;\e78f&quot;</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.icon-arrow-right</span>:before &#123; content: <span class="string">&quot;\e682&quot;</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.icon-duihao</span>:before &#123; content: <span class="string">&quot;\e601&quot;</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.icon-right</span>:before &#123; content: <span class="string">&quot;\e790&quot;</span>; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="components">4.1.2 components/</h3>
<blockquote>
<p>翻译组件介绍(语音翻译页面配置)</p>
</blockquote>
<h4 id="componentsbottom-button">4.1.2.1 components/bottom-button</h4>
<blockquote>
<p>录音按钮组</p>
</blockquote>
<p>以下代码主要功能是：</p>
<ol type="1">
<li>根据语言配置生成对应的录音按钮。</li>
<li>当按下按钮时，开始录音，并将按钮样式改为按下状态。</li>
<li>当松开按钮时，结束录音，并将按钮样式改回正常状态。</li>
<li>当按钮被禁用时，修改按钮样式为禁用状态。</li>
</ol>
<ul>
<li><strong>bottom-button.js</strong></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入语言配置文件</span></span><br><span class="line"><span class="keyword">import</span> &#123; language &#125; <span class="keyword">from</span> <span class="string">&#x27;../../utils/conf.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取全局应用实例</span></span><br><span class="line"><span class="keyword">let</span> app = getApp();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取全局按钮配置</span></span><br><span class="line"><span class="keyword">let</span> buttons = app.globalData.buttons;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据语言配置生成按钮配置</span></span><br><span class="line">language.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  buttons.push(&#123;</span><br><span class="line">    <span class="attr">buttonText</span>: item.lang_name, <span class="comment">// 按钮文本</span></span><br><span class="line">    <span class="attr">lang</span>: item.lang_content, <span class="comment">// 按钮对应的语言</span></span><br><span class="line">    <span class="attr">lto</span>: item.lang_to[<span class="number">0</span>], <span class="comment">// 目标语言</span></span><br><span class="line">    <span class="attr">msg</span>: item.hold_talk, <span class="comment">// 提示信息</span></span><br><span class="line">    <span class="attr">buttonType</span>: <span class="string">&#x27;normal&#x27;</span>, <span class="comment">// 按钮类型</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮对应的背景图片</span></span><br><span class="line"><span class="keyword">let</span> buttonBackground = &#123;</span><br><span class="line">  <span class="attr">zh_CN</span>: &#123;</span><br><span class="line">    <span class="attr">normal</span>: <span class="string">&#x27;../../imgs/R.png&#x27;</span>,</span><br><span class="line">    <span class="attr">press</span>: <span class="string">&#x27;../../imgs/R1.png&#x27;</span>,</span><br><span class="line">    <span class="attr">disabled</span>: <span class="string">&#x27;../../imgs/R.png&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">en_US</span>: &#123;</span><br><span class="line">    <span class="attr">normal</span>: <span class="string">&#x27;../../imgs/R.png&#x27;</span>,</span><br><span class="line">    <span class="attr">press</span>: <span class="string">&#x27;../../imgs/R1.png&#x27;</span>,</span><br><span class="line">    <span class="attr">disabled</span>: <span class="string">&#x27;../../imgs/R.png&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件定义</span></span><br><span class="line">Component(&#123;</span><br><span class="line">  <span class="comment">// 组件的属性列表</span></span><br><span class="line">  <span class="attr">properties</span>: &#123;</span><br><span class="line">    <span class="comment">// 按钮是否禁用</span></span><br><span class="line">    <span class="attr">buttonDisabled</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">      <span class="attr">value</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">observer</span>: <span class="function"><span class="keyword">function</span> (<span class="params">newVal, oldVal</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> buttonType = newVal ? <span class="string">&#x27;disabled&#x27;</span> : <span class="string">&#x27;normal&#x27;</span></span><br><span class="line">        <span class="built_in">this</span>.changeButtonType(buttonType)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 组件的初始数据</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">buttons</span>: buttons, <span class="comment">// 按钮配置</span></span><br><span class="line">    <span class="attr">buttonBackground</span>: buttonBackground, <span class="comment">// 按钮背景图片</span></span><br><span class="line">    <span class="attr">currentButtonType</span>: <span class="string">&#x27;normal&#x27;</span>, <span class="comment">// 当前按钮类型</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 组件的方法列表</span></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 按下按钮开始录音</span></span><br><span class="line">    <span class="function"><span class="title">streamRecord</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.data.buttonDisabled) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 先清空背景音</span></span><br><span class="line">      wx.stopBackgroundAudio()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> currentButtonConf = e.currentTarget.dataset.conf</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>.changeButtonType(<span class="string">&#x27;press&#x27;</span>, currentButtonConf.lang)</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>.triggerEvent(<span class="string">&#x27;recordstart&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">buttonItem</span>: currentButtonConf</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 松开按钮结束录音</span></span><br><span class="line">    <span class="function"><span class="title">endStreamRecord</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> currentButtonConf = e.currentTarget.dataset.conf</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>.triggerEvent(<span class="string">&#x27;recordend&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">buttonItem</span>: currentButtonConf</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改按钮样式</span></span><br><span class="line">    <span class="function"><span class="title">changeButtonType</span>(<span class="params">buttonType, buttonLang</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> tmpButtons = <span class="built_in">this</span>.data.buttons.slice(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">      tmpButtons.forEach(<span class="function"><span class="params">button</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!buttonLang || buttonLang == button.lang) &#123;</span><br><span class="line">          button.buttonType = buttonType</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">buttons</span>: tmpButtons</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>bottom-button.json</strong> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;component&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>bottom-button.wxml</strong> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 按钮组容器，当hidden为true时隐藏 --&gt;</span><br><span class="line">&lt;view class=&quot;<span class="selector-tag">button</span>-wrap&quot; hidden=&quot;&#123;&#123;hidden&#125;&#125;&quot;&gt;</span><br><span class="line">  &lt;!-- 图片大容器 --&gt;</span><br><span class="line">  &lt;view class=&quot;<span class="selector-tag">img</span>-big-wrap&quot;&gt;</span><br><span class="line">    &lt;!-- 按钮容器 --&gt;</span><br><span class="line">    &lt;view class=&quot;<span class="selector-tag">button</span>-container&quot;&gt;</span><br><span class="line">      &lt;!-- 使用wx:for指令遍历buttons数组，生成对应的按钮 --&gt;</span><br><span class="line">      &lt;view wx:for=<span class="string">&quot;&#123;&#123;buttons&#125;&#125;&quot;</span> wx:for-item=<span class="string">&quot;button&quot;</span> wx:key=<span class="string">&quot;lang&quot;</span> class=<span class="string">&quot;button-item&quot;</span>&gt;</span><br><span class="line">        &lt;view catchtouchstart=<span class="string">&quot;streamRecord&quot;</span></span><br><span class="line">               catchtouchend=<span class="string">&quot;endStreamRecord&quot;</span></span><br><span class="line">               data-conf=<span class="string">&quot;&#123;&#123;button&#125;&#125;&quot;</span></span><br><span class="line">               class=<span class="string">&quot;button-press&quot;</span>&gt;</span><br><span class="line">          &lt;image class=<span class="string">&quot;button-background&quot;</span> src=<span class="string">&quot;&#123;&#123;buttonBackground[button.lang][button.buttonType]&#125;&#125;&quot;</span>&gt;&lt;/image&gt;</span><br><span class="line">        &lt;/view&gt;</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure></li>
<li><strong>bottom-button.wxss</strong> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 按钮组容器样式，使用flex布局，内容居中 */</span></span><br><span class="line"><span class="selector-class">.button-wrap</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-flex;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  -webkit-<span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 图片大容器样式，宽度100%，使用flex布局，背景色为#1494fc */</span></span><br><span class="line"><span class="selector-class">.img-big-wrap</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-flex;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#1494fc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 按钮容器样式，使用flex布局，高度100%，宽度100%，内容居中，底部外边距20px */</span></span><br><span class="line"><span class="selector-class">.button-container</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-flex;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  -webkit-<span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  -webkit-<span class="attribute">align-items</span>:flex-start;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">50</span>rpx <span class="number">0</span> <span class="number">38</span>rpx <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 按钮项样式，使用flex布局，方向为列，内容从上开始，居中对齐，宽度75px */</span></span><br><span class="line"><span class="selector-class">.button-item</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  -webkit-<span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-start;</span><br><span class="line">  -webkit-<span class="attribute">justify-content</span>: flex-start;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  -webkit-<span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">75px</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 按钮标签样式，字体大小28rpx，颜色#9B9B9B，字母间距0，上外边距15rpx */</span></span><br><span class="line"><span class="selector-class">.button-label</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#9B9B9B</span>;</span><br><span class="line">  <span class="attribute">letter-spacing</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">15</span>rpx <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 按钮按下样式，位置相对，使用flex布局，高度150rpx，宽度100%，圆角100rpx，内容居中对齐 */</span></span><br><span class="line"><span class="selector-class">.button-press</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-flex;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">150</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  -webkit-<span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  -wekbit-<span class="attribute">align-items</span>:center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 按钮背景样式，位置相对，高度150rpx，宽度100%，左边距0，z-index为3 */</span></span><br><span class="line"><span class="selector-class">.button-background</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">150</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="comment">/* border-radius: 100rpx; */</span></span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="componentsmodal">4.1.2.2 components/modal</h4>
<p>工具组件</p>
<p>以下代码主要功能是：</p>
<ol type="1">
<li>三个操作项：复制源文本、复制目标文本和删除条目。</li>
<li>当点击复制源文本或复制目标文本时，会调用<code>setClip</code></li>
</ol>
<ul>
<li><strong>modal.js</strong> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入语言配置</span></span><br><span class="line"><span class="keyword">import</span> &#123; language &#125; <span class="keyword">from</span> <span class="string">&#x27;../../utils/conf.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取第一种语言配置</span></span><br><span class="line"><span class="keyword">const</span> tips_language = language[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义模态框中的操作项</span></span><br><span class="line"><span class="keyword">let</span> modalItems = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;copySource&#x27;</span>, <span class="comment">// 复制源文本</span></span><br><span class="line">      <span class="attr">text</span>: tips_language.copy_source_text</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;delete&#x27;</span>, <span class="comment">// 删除条目</span></span><br><span class="line">      <span class="attr">text</span>: tips_language.delete_item</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;copyTarget&#x27;</span>, <span class="comment">// 复制目标文本</span></span><br><span class="line">      <span class="attr">text</span>: tips_language.copy_target_text</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义组件</span></span><br><span class="line">Component(&#123;</span><br><span class="line">  <span class="comment">// 组件的属性列表</span></span><br><span class="line">  <span class="attr">properties</span>: &#123;</span><br><span class="line">    <span class="comment">// 条目数据</span></span><br><span class="line">    <span class="attr">item</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">Object</span>,</span><br><span class="line">      <span class="attr">value</span>: &#123;&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 是否显示模态框</span></span><br><span class="line">    <span class="attr">modalShow</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">      <span class="attr">value</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 条目索引</span></span><br><span class="line">    <span class="attr">index</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">Number</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 组件的初始数据</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">modalItems</span>: modalItems, <span class="comment">// 模态框操作项</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 组件的方法列表</span></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 删除条目并关闭模态框</span></span><br><span class="line">    <span class="attr">deleteBubbleModal</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.triggerEvent(<span class="string">&#x27;modaldelete&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">item</span>: <span class="built_in">this</span>.data.item,</span><br><span class="line">        <span class="attr">index</span>: <span class="built_in">this</span>.data.index,</span><br><span class="line">      &#125;,&#123; <span class="attr">bubbles</span>: <span class="literal">true</span>, <span class="attr">composed</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">      <span class="built_in">this</span>.leaveBubbleModal()</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点击操作项</span></span><br><span class="line">    <span class="attr">itemTap</span>: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> itemType = e.currentTarget.dataset.type</span><br><span class="line">      <span class="keyword">let</span> item = <span class="built_in">this</span>.data.item</span><br><span class="line"></span><br><span class="line">      <span class="keyword">switch</span>(itemType) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;copySource&#x27;</span>: <span class="comment">// 复制源文本</span></span><br><span class="line">          <span class="built_in">this</span>.setClip(item.text)</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;copyTarget&#x27;</span>: <span class="comment">// 复制目标文本</span></span><br><span class="line">          <span class="built_in">this</span>.setClip(item.translateText)</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;delete&#x27;</span>: <span class="comment">// 删除条目</span></span><br><span class="line">          <span class="built_in">this</span>.deleteBubbleModal()</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 复制到剪贴板</span></span><br><span class="line">    <span class="attr">setClip</span>: <span class="function"><span class="keyword">function</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">      wx.setClipboardData(&#123;</span><br><span class="line">        <span class="attr">data</span>: text,</span><br><span class="line">        <span class="attr">success</span>:  <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.leaveBubbleModal()</span><br><span class="line">          wx.showToast(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&quot;已复制到剪切板&quot;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">            <span class="attr">duration</span>: <span class="number">1000</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">              <span class="built_in">console</span>.log(<span class="string">&quot;show succ&quot;</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">              <span class="built_in">console</span>.log(res);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭模态框</span></span><br><span class="line">    <span class="attr">leaveBubbleModal</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.triggerEvent(<span class="string">&#x27;modalleave&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">modalShow</span>: <span class="built_in">this</span>.data.modalShow</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>modal.json</strong> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;component&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>modal.wxml</strong> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 如果modalShow为true，则显示模态框 --&gt;</span><br><span class="line">&lt;view wx:if=<span class="string">&quot;&#123;&#123;modalShow&#125;&#125;&quot;</span> style=<span class="string">&quot;height:100%;width:100%&quot;</span>&gt;</span><br><span class="line">  &lt;view class=<span class="string">&quot;modal-wrapper&quot;</span>&gt;</span><br><span class="line">    &lt;!-- 模态框的三角形部分 --&gt;</span><br><span class="line">    &lt;view class=<span class="string">&quot;modal-triangle&quot;</span>&gt;&lt;/view&gt;</span><br><span class="line">    &lt;!-- 模态框的主体部分，包含一些可点击的选项 --&gt;</span><br><span class="line">    &lt;view class=<span class="string">&quot;menu-modal&quot;</span>&gt;</span><br><span class="line">      &lt;!-- 遍历modalItems数组，为每个选项创建一个视图元素 --&gt;</span><br><span class="line">      &lt;view wx:for=<span class="string">&quot;&#123;&#123;modalItems&#125;&#125;&quot;</span> wx:key=<span class="string">&quot;type&quot;</span> class=<span class="string">&quot;menu-modal-item&quot;</span> data-type=<span class="string">&quot;&#123;&#123;item.type&#125;&#125;&quot;</span> bindtap=<span class="string">&quot;itemTap&quot;</span>&gt;&#123;&#123;item.text&#125;&#125;&lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/view&gt;</span><br><span class="line">&lt;!-- 如果modalShow为true，则显示一个透明的遮罩层，点击遮罩层可以关闭模态框 --&gt;</span><br><span class="line">&lt;view wx:if=<span class="string">&quot;&#123;&#123;modalShow&#125;&#125;&quot;</span> class=<span class="string">&quot;modal-hidden&quot;</span> 	bindtouchstart=<span class="string">&quot;leaveBubbleModal&quot;</span>&gt;&lt;/view&gt;</span><br></pre></td></tr></table></figure></li>
<li><strong>modal.wxss</strong> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 模态框容器样式 */</span></span><br><span class="line"><span class="selector-class">.modal-wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#FFFFFF</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">70</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">80%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">70</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.9</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 模态框中三角形的样式 */</span></span><br><span class="line"><span class="selector-class">.modal-triangle</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">28px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">5px</span> solid <span class="number">#000000</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 模态框隐藏状态的样式 */</span></span><br><span class="line"><span class="selector-class">.modal-hidden</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#FFFFFF</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">69</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 模态菜单的样式 */</span></span><br><span class="line"><span class="selector-class">.menu-modal</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">70</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-flex;</span><br><span class="line">  -webkit-<span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 模态菜单项的样式 */</span></span><br><span class="line"><span class="selector-class">.menu-modal-item</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#FFFFFF</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">35%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  -webkit-<span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  -webkit-<span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">background-clip</span>: content-box;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#000000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 第一个模态菜单项的样式，添加左上和左下的圆角 */</span></span><br><span class="line"><span class="selector-class">.menu-modal-item</span><span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">  <span class="attribute">border-top-left-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">border-bottom-left-radius</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 最后一个模态菜单项的样式，添加右上和右下的圆角 */</span></span><br><span class="line"><span class="selector-class">.menu-modal-item</span><span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">  <span class="attribute">border-top-right-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">border-bottom-right-radius</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 模态菜单项之间的分隔线样式 */</span></span><br><span class="line"><span class="selector-class">.menu-modal-item</span> + <span class="selector-class">.menu-modal-item</span> &#123;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">1</span>rpx solid <span class="number">#FFFFFF</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 模态菜单项被按下时的样式 */</span></span><br><span class="line"><span class="selector-class">.menu-modal-item</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#9e9e9e</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure> #### 4.1.2.3
components/play-icon</li>
</ul>
<p>播放加载组件</p>
<p>以下代码主要功能是：</p>
<ol type="1">
<li>监听播放状态的变化，当播放状态从'loading'变为'playing'时，根据加载动画的播放次数和剩余的播放时间，决定是立即将播放状态设置为'playing'，还是等待剩余的播放时间后再将播放状态设置为'playing'。</li>
<li>当播放状态变为'loading'时，记录加载开始的时间。</li>
</ol>
<ul>
<li><strong>play-icon.js</strong> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载图标的路径</span></span><br><span class="line"><span class="keyword">const</span> loadingIcon = <span class="string">&#x27;../../imgs/loading.gif&#x27;</span></span><br><span class="line"></span><br><span class="line">Component(&#123;</span><br><span class="line">  <span class="attr">properties</span>: &#123;</span><br><span class="line">    <span class="comment">// 播放状态，可能的值有&#x27;wait&#x27;、&#x27;loading&#x27;和&#x27;playing&#x27;</span></span><br><span class="line">    <span class="attr">playType</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="attr">value</span>: <span class="string">&#x27;wait&#x27;</span>,</span><br><span class="line">      <span class="comment">// 当playType的值发生变化时，会触发这个函数</span></span><br><span class="line">      <span class="attr">observer</span>: <span class="function"><span class="keyword">function</span>(<span class="params">newVal, oldVal</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 当播放状态从&#x27;loading&#x27;变为&#x27;playing&#x27;时</span></span><br><span class="line">        <span class="keyword">if</span>(oldVal == <span class="string">&#x27;loading&#x27;</span> &amp;&amp; newVal == <span class="string">&#x27;playing&#x27;</span>) &#123;</span><br><span class="line">          <span class="comment">// 加载动画的周期为1240ms</span></span><br><span class="line">          <span class="keyword">let</span> loadingTransitionTime = <span class="number">1240</span>;</span><br><span class="line">          <span class="comment">// 获取当前时间</span></span><br><span class="line">          <span class="keyword">let</span> nowTime = + <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">          <span class="comment">// 获取加载开始的时间</span></span><br><span class="line">          <span class="keyword">let</span> loadingStartTime = <span class="built_in">this</span>.data.loadingStartTime</span><br><span class="line">          <span class="comment">// 计算加载的时间</span></span><br><span class="line">          <span class="keyword">let</span> loadingTime = nowTime - loadingStartTime</span><br><span class="line">          <span class="comment">// 计算加载动画播放的完整次数</span></span><br><span class="line">          <span class="keyword">let</span> loadingCount = <span class="built_in">parseInt</span>(loadingTime / loadingTransitionTime);</span><br><span class="line">          <span class="comment">// 计算加载动画剩余的播放时间</span></span><br><span class="line">          <span class="keyword">let</span> timeLeft = loadingTransitionTime - loadingTime % loadingTransitionTime;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 如果加载动画播放了至少一次，并且剩余的播放时间大于1秒</span></span><br><span class="line">          <span class="keyword">if</span>(loadingCount &gt; <span class="number">0</span> &amp;&amp; timeLeft &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">            <span class="comment">// 直接将播放状态设置为&#x27;playing&#x27;，并清空加载图标</span></span><br><span class="line">            <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">              <span class="attr">realPlayType</span>: newVal,</span><br><span class="line">              <span class="attr">loadingImg</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 否则，等待剩余的播放时间后，再将播放状态设置为&#x27;playing&#x27;</span></span><br><span class="line">            <span class="built_in">setTimeout</span>( <span class="function">()=&gt;</span>&#123;</span><br><span class="line">              <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                <span class="attr">realPlayType</span>: newVal,</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;, timeLeft)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newVal == <span class="string">&#x27;loading&#x27;</span>)&#123;</span><br><span class="line">          <span class="comment">// 当播放状态变为&#x27;loading&#x27;时，记录加载开始的时间，并将播放状态设置为&#x27;loading&#x27;</span></span><br><span class="line">          <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="attr">loadingStartTime</span>: + <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">            <span class="attr">realPlayType</span>: newVal,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 对于其他的播放状态，直接更新播放状态</span></span><br><span class="line">          <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="attr">realPlayType</span>: newVal,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="comment">// 实际在wxml中使用的播放状态</span></span><br><span class="line">    <span class="attr">realPlayType</span>: <span class="string">&#x27;wait&#x27;</span>,</span><br><span class="line">    <span class="comment">// 加载开始的时间</span></span><br><span class="line">    <span class="attr">loadingStartTime</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">ready</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 组件准备就绪时执行的函数</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">detached</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 组件被移除时执行的函数</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 组件的方法列表</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><strong>play-icon.json</strong> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;component&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;usingComponents&quot;</span>: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>play-icon.wxml</strong> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 主视图，包含音乐播放图标 --&gt;</span><br><span class="line">&lt;view class=&quot;play-loud-<span class="attribute">icon</span>&quot;&gt;</span><br><span class="line">  &lt;!-- 根据播放状态显示或隐藏的主播放图标 --&gt;</span><br><span class="line">  &lt;image <span class="attribute">src</span>=&quot;../../imgs/play_loud<span class="selector-class">.png</span>&quot; class=&quot;play-loud-<span class="selector-tag">img</span> play-<span class="attribute">icon</span>-<span class="selector-tag">main</span> &#123;&#123;realPlayType == &#x27;loading&#x27; ? &#x27;is-hide&#x27; : <span class="string">&#x27;&#x27;</span>&#125;&#125;&quot; &gt;&lt;/image&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 当播放状态不是&#x27;loading&#x27;时，以下内容生效 --&gt;</span><br><span class="line">  &lt;block wx:if=<span class="string">&quot;&#123;&#123;realPlayType != &#x27;loading&#x27;&#125;&#125;&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 当播放状态是<span class="string">&#x27;playing&#x27;</span>时，显示动画效果 --&gt;</span><br><span class="line">    &lt;block wx:if=<span class="string">&quot;&#123;&#123;realPlayType==&#x27;playing&#x27;&#125;&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;image src=<span class="string">&quot;../../imgs/play_loud_1.png&quot;</span> class=<span class="string">&quot;play-loud-img play-animation&quot;</span> &gt;&lt;/image&gt;</span><br><span class="line">        &lt;image src=<span class="string">&quot;../../imgs/play_loud_2.png&quot;</span> class=<span class="string">&quot;play-loud-img play-animation1&quot;</span>&gt;&lt;/image&gt;</span><br><span class="line">    &lt;/block&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 当播放状态不是<span class="string">&#x27;playing&#x27;</span>时，显示静态图标 --&gt;</span><br><span class="line">    &lt;block wx:else&gt;</span><br><span class="line">        &lt;image src=<span class="string">&quot;../../imgs/play_loud_1.png&quot;</span> class=<span class="string">&quot;play-loud-img&quot;</span>&gt;&lt;/image&gt;</span><br><span class="line">    &lt;/block&gt;</span><br><span class="line">  &lt;/block&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 当播放状态是<span class="string">&#x27;loading&#x27;</span>时，显示过渡效果 --&gt;</span><br><span class="line">  &lt;block wx:else=<span class="string">&quot;&#123;&#123;realPlayType != &#x27;loading&#x27;&#125;&#125;&quot;</span>&gt;</span><br><span class="line">    &lt;view class=<span class="string">&quot;play-transition&quot;</span>&gt;&lt;/view&gt;</span><br><span class="line">  &lt;/block&gt;</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure></li>
<li><strong>play-icon.wxss</strong> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 容器的样式 */</span></span><br><span class="line"><span class="selector-class">.play-loud-icon</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 音乐播放图标的样式 */</span></span><br><span class="line"><span class="selector-class">.play-loud-img</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 主播放图标的过渡效果 */</span></span><br><span class="line"><span class="selector-class">.play-icon-main</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: all .<span class="number">2s</span> ease-out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 加载状态的图标样式 */</span></span><br><span class="line"><span class="selector-class">.play-loading-img</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">left</span>: -<span class="number">1</span>rpx;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 隐藏元素的样式 */</span></span><br><span class="line"><span class="selector-class">.is-hide</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 过渡效果的样式，采用背景图base64实现 */</span></span><br><span class="line"><span class="selector-class">.play-transition</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">background</span>: transparent <span class="built_in">url</span>(<span class="string">...</span>) no-repeat;</span><br><span class="line">  <span class="attribute">background-size</span>: <span class="number">40</span>rpx <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">left</span>: -<span class="number">1</span>rpx;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 音乐播放动画的共享样式 */</span></span><br><span class="line"><span class="selector-class">.play-animation</span>,</span><br><span class="line"><span class="selector-class">.play-animation1</span> &#123;</span><br><span class="line">  -webkit-<span class="attribute">animation-delay</span>: <span class="number">200ms</span>;</span><br><span class="line">  <span class="attribute">animation-delay</span>: <span class="number">200ms</span>;</span><br><span class="line">  -webkit-<span class="attribute">animation</span>: tranOpacity <span class="number">1200ms</span> ease-in-out infinite;</span><br><span class="line">  <span class="attribute">animation</span>: tranOpacity <span class="number">1200ms</span> ease-in-out infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 音乐播放动画1的样式 */</span></span><br><span class="line"><span class="selector-class">.play-animation</span> &#123;</span><br><span class="line">  -webkit-<span class="attribute">animation-name</span>: tranOpacity;</span><br><span class="line">  <span class="attribute">animation-name</span>: tranOpacity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 音乐播放动画2的样式 */</span></span><br><span class="line"><span class="selector-class">.play-animation1</span> &#123;</span><br><span class="line">  -webkit-<span class="attribute">animation-name</span>: tranOpacity1;</span><br><span class="line">  <span class="attribute">animation-name</span>: tranOpacity1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 动画1的关键帧定义 */</span></span><br><span class="line"><span class="keyword">@-webkit-keyframes</span> tranOpacity &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">35%</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> tranOpacity &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">35%</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 动画2的关键帧定义 */</span></span><br><span class="line"><span class="keyword">@-webkit-keyframes</span> tranOpacity1 &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">35%</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> tranOpacity1 &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">35%</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure> #### 4.1.2.4
components/result-bubble</li>
</ul>
<p>翻译框组件</p>
<p>以下代码主要功能是： 1.
接收一个对象item作为输入，该对象包含文本信息以及音频路径等数据。 2.
根据item对象中的数据，触发文字的翻译，并且播放翻译后的音频。 3.
提供了一些界面操作，例如弹出和关闭模态框，以及触发播放和停止音频的操作。</p>
<ul>
<li><strong>result-bubble.js</strong> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入语言配置</span></span><br><span class="line"><span class="keyword">import</span> &#123; language &#125; <span class="keyword">from</span> <span class="string">&#x27;../../utils/conf.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个组件</span></span><br><span class="line">Component(&#123;</span><br><span class="line">  <span class="comment">// 定义组件的属性</span></span><br><span class="line">  <span class="attr">properties</span>: &#123;</span><br><span class="line">    <span class="comment">// 属性:item，类型:Object，观察函数进行数据监听</span></span><br><span class="line">    <span class="attr">item</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">Object</span>,</span><br><span class="line">      <span class="attr">value</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">observer</span>: <span class="function"><span class="keyword">function</span>(<span class="params">newVal, oldVal</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 当记录状态为2（翻译完成），且文本有变化，触发重新翻译事件</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.data.recordStatus == <span class="number">2</span> &amp;&amp; oldVal.text &amp;&amp; oldVal.text != <span class="string">&#x27;&#x27;</span> &amp;&amp; newVal.text != oldVal.text) &#123;</span><br><span class="line">          <span class="built_in">this</span>.triggerEvent(<span class="string">&#x27;translate&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">item</span>: <span class="built_in">this</span>.data.item,</span><br><span class="line">            <span class="attr">index</span>: <span class="built_in">this</span>.data.index,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 翻译内容改变触发音频播放，或者结束播放动画</span></span><br><span class="line">        <span class="keyword">if</span>(newVal.autoPlay &amp;&amp; newVal.translateVoicePath != oldVal.translateVoicePath)&#123;</span><br><span class="line">          <span class="built_in">this</span>.autoPlayTranslateVoice()</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(newVal.translateVoicePath == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">          <span class="built_in">this</span>.playAnimationEnd()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 编辑界面展示标志</span></span><br><span class="line">    <span class="attr">editShow</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">      <span class="attr">value</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 项目索引</span></span><br><span class="line">    <span class="attr">index</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">Number</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 当前翻译的音频路径</span></span><br><span class="line">    <span class="attr">currentTranslateVoice</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="attr">observer</span>: <span class="function"><span class="keyword">function</span>(<span class="params">newVal, oldVal</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(newVal != <span class="string">&#x27;&#x27;</span> &amp;&amp; newVal != <span class="built_in">this</span>.data.item.translateVoicePath) &#123;</span><br><span class="line">          <span class="built_in">this</span>.playAnimationEnd()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 记录状态：0-正在识别，1-正在翻译，2-翻译完成</span></span><br><span class="line">    <span class="attr">recordStatus</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">Number</span>,</span><br><span class="line">      <span class="attr">value</span>: <span class="number">2</span>, </span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义组件的内部数据</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="comment">// 语言类型</span></span><br><span class="line">    <span class="attr">tips_language</span>: language[<span class="number">0</span>], </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是否显示模态框</span></span><br><span class="line">    <span class="attr">modalShow</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 语音播放状态</span></span><br><span class="line">    <span class="attr">playType</span>: <span class="string">&#x27;wait&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 待定义动画</span></span><br><span class="line">    <span class="attr">waiting_animation</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">waiting_animation_1</span>: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 编辑图标路径</span></span><br><span class="line">    <span class="attr">edit_icon_path</span>: <span class="string">&#x27;../../imgs/edit.png&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 组件生命周期函数-在组件布局完成后执行</span></span><br><span class="line">  <span class="attr">ready</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">this</span>.data.item.autoPlay) &#123;</span><br><span class="line">      <span class="built_in">this</span>.autoPlayTranslateVoice()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 组件生命周期函数-在组件实例被从页面节点树移除时执行</span></span><br><span class="line">  <span class="attr">detached</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// console.log(&quot;detach&quot;)</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义方法</span></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 显示模态框</span></span><br><span class="line">    <span class="attr">showModal</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;<span class="attr">modalShow</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 离开模态框</span></span><br><span class="line">    <span class="attr">modalLeave</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;<span class="attr">modalShow</span>: <span class="literal">false</span>&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点击播放图标，根据播放状态和音频过期时间，来决定播放，停止还是触发过期事件</span></span><br><span class="line">    <span class="attr">playTranslateVoice</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> nowTime = <span class="built_in">parseInt</span>(+ <span class="keyword">new</span> <span class="built_in">Date</span>() / <span class="number">1000</span>)</span><br><span class="line">      <span class="keyword">let</span> voiceExpiredTime = <span class="built_in">this</span>.data.item.translateVoiceExpiredTime || <span class="number">0</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(<span class="built_in">this</span>.data.playType == <span class="string">&#x27;playing&#x27;</span>) &#123;</span><br><span class="line">        wx.stopBackgroundAudio()</span><br><span class="line">        <span class="built_in">this</span>.playAnimationEnd()</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span>(nowTime &lt; voiceExpiredTime) &#123;</span><br><span class="line">        <span class="built_in">this</span>.autoPlayTranslateVoice()</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">          <span class="attr">playType</span>: <span class="string">&#x27;loading&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">this</span>.triggerEvent(<span class="string">&#x27;expired&#x27;</span>, &#123;</span><br><span class="line">          <span class="attr">item</span>: <span class="built_in">this</span>.data.item,</span><br><span class="line">          <span class="attr">index</span>: <span class="built_in">this</span>.data.index,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自动播放翻译后的音频，音频播放结束后，会结束播放动画</span></span><br><span class="line">    <span class="attr">autoPlayTranslateVoice</span>: <span class="function"><span class="keyword">function</span> (<span class="params">path,index</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> play_path = <span class="built_in">this</span>.data.item.translateVoicePath</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(!play_path) &#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&quot;no translate voice path&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      wx.onBackgroundAudioStop(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;play voice end&quot;</span>,res)</span><br><span class="line">        <span class="built_in">this</span>.playAnimationEnd()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>.playAnimationStart()</span><br><span class="line"></span><br><span class="line">      wx.playBackgroundAudio(&#123;</span><br><span class="line">        <span class="attr">dataUrl</span>: play_path,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.playAnimationStart()</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;failed played&quot;</span>, play_path);</span><br><span class="line">            <span class="built_in">this</span>.playAnimationEnd()</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">complete</span>: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;complete played&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始播放动画</span></span><br><span class="line">    <span class="attr">playAnimationStart</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">playType</span>: <span class="string">&#x27;playing&#x27;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 结束播放动画</span></span><br><span class="line">    <span class="attr">playAnimationEnd</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">          <span class="attr">playType</span>: <span class="string">&#x27;wait&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>result-bubble.json</strong> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;component&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;usingComponents&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;modal&quot;</span>: <span class="string">&quot;/components/modal/index&quot;</span>,</span><br><span class="line">    <span class="string">&quot;waiting-icon&quot;</span>: <span class="string">&quot;/components/waiting-icon/index&quot;</span>,</span><br><span class="line">    <span class="string">&quot;play-icon&quot;</span>: <span class="string">&quot;/components/play-icon/index&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>result-bubble.wxml</strong> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 消息气泡容器，长按显示模态框 --&gt;</span><br><span class="line">&lt;view class=&quot;bubble-wrap&quot; bindlongpress=&quot;showModal&quot; &gt;</span><br><span class="line">  &lt;!-- 模态框容器，当状态为<span class="number">2</span>（翻译完成）时显示 --&gt;</span><br><span class="line">  &lt;view class=&quot;modal-wrap&quot; wx:if=<span class="string">&quot;&#123;&#123;recordStatus == 2&#125;&#125;&quot;</span>&gt;</span><br><span class="line">    &lt;!-- 模态框组件 --&gt;</span><br><span class="line">    &lt;modal </span><br><span class="line">      modal-show=<span class="string">&quot;&#123;&#123;modalShow&#125;&#125;&quot;</span>   &lt;!-- 控制模态框显示隐藏 --&gt;</span><br><span class="line">      index=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span>             &lt;!-- 项目索引 --&gt;</span><br><span class="line">      item=<span class="string">&quot;&#123;&#123;item&#125;&#125;&quot;</span>               &lt;!-- 当前项目 --&gt;</span><br><span class="line">      bindmodalleave=<span class="string">&quot;modalLeave&quot;</span>&gt;  &lt;!-- 模态框离开事件处理函数 --&gt;</span><br><span class="line">    &lt;/modal&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 创建时间显示 --&gt;</span><br><span class="line">  &lt;view class=<span class="string">&quot;create-time&quot;</span>&gt;&#123;&#123;item.create&#125;&#125;&lt;/view&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 消息内容区域 --&gt;</span><br><span class="line">  &lt;view class=&quot;<span class="selector-tag">section</span>-<span class="selector-tag">body</span>&quot; data-index=&quot;&#123;&#123;index&#125;&#125;&quot; &gt;</span><br><span class="line">    &lt;!-- 发送消息区域 --&gt;</span><br><span class="line">    &lt;view class=&quot;send-message&quot;&gt;</span><br><span class="line">      &lt;!-- 消息文本内容 --&gt;</span><br><span class="line">      &lt;view data-id=&quot;&#123;&#123;item<span class="selector-class">.id</span>&#125;&#125;&quot;  class=&quot;text-<span class="attribute">content</span>&quot;  data-index=&quot;&#123;&#123;index&#125;&#125;&quot; &gt;</span><br><span class="line">        &lt;!-- 消息详情 --&gt;</span><br><span class="line">        &lt;view class=&quot;text-detail  text-detail-&#123;&#123;item<span class="selector-class">.lfrom</span>&#125;&#125;&quot; &gt;</span><br><span class="line">          &lt;!-- 消息文本 --&gt;</span><br><span class="line">          &#123;&#123;item<span class="selector-class">.text</span>&#125;&#125;</span><br><span class="line">          &lt;!-- 若正在识别（状态为<span class="number">0</span>），则显示等待图标 --&gt;</span><br><span class="line">          &lt;waiting-<span class="attribute">icon</span> wx:if=<span class="string">&quot;&#123;&#123;recordStatus == 0&#125;&#125;&quot;</span>&gt;&lt;/waiting-icon&gt;</span><br><span class="line">        &lt;/view&gt;</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- 编辑图标，点击进入编辑页面 --&gt;</span><br><span class="line">      &lt;navigator</span><br><span class="line">        hover-class=<span class="string">&quot;navigator-hover&quot;</span></span><br><span class="line">        data-text=<span class="string">&quot;&#123;&#123;item.text&#125;&#125;&quot;</span></span><br><span class="line">        data-id=<span class="string">&quot;&#123;&#123;item.id&#125;&#125;&quot;</span></span><br><span class="line">        data-index=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span></span><br><span class="line">        class=<span class="string">&quot;edit-icon&quot;</span></span><br><span class="line">        wx:if=<span class="string">&quot;&#123;&#123;editShow&#125;&#125;&quot;</span></span><br><span class="line">        data-item=<span class="string">&quot;&#123;&#123;item&#125;&#125;&quot;</span></span><br><span class="line">        url=<span class="string">&quot;&#123;&#123;&#x27;/pages/edit/edit?content=&#x27;+item.text+&#x27;&amp;index=&#x27;+index&#125;&#125;&quot;</span>&gt;</span><br><span class="line">          &lt;!-- 编辑图标图片 --&gt;</span><br><span class="line">          &lt;image class=<span class="string">&quot;edit-icon-img&quot;</span> src=<span class="string">&quot;&#123;&#123;edit_icon_path&#125;&#125;&quot;</span> &gt;&lt;/image&gt;</span><br><span class="line">      &lt;/navigator&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 若正在翻译（状态大于<span class="number">0</span>），显示分割线 --&gt;</span><br><span class="line">    &lt;view class=<span class="string">&quot;line-between&quot;</span>  wx:if=<span class="string">&quot;&#123;&#123;recordStatus &gt; 0&#125;&#125;&quot;</span>&gt;&lt;/view&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 翻译后的消息区域 --&gt;</span><br><span class="line">    &lt;view class=<span class="string">&quot;translate-message&quot;</span> &gt;</span><br><span class="line">      &lt;!-- 消息文本内容 --&gt;</span><br><span class="line">      &lt;view class=<span class="string">&quot;text-content&quot;</span>&gt;</span><br><span class="line">        &lt;!-- 消息详情 --&gt;</span><br><span class="line">        &lt;view class=<span class="string">&quot;text-detail text-detail-&#123;&#123;item.lto&#125;&#125;&quot;</span>&gt;</span><br><span class="line">          &lt;!-- 翻译后的文本 --&gt;</span><br><span class="line">          &#123;&#123;item.translateText&#125;&#125;</span><br><span class="line">          &lt;!-- 若正在翻译（状态为<span class="number">1</span>），则显示等待图标 --&gt;</span><br><span class="line">          &lt;waiting-<span class="attribute">icon</span> wx:if=<span class="string">&quot;&#123;&#123;recordStatus == 1&#125;&#125;&quot;</span>&gt;&lt;/waiting-icon&gt;</span><br><span class="line">        &lt;/view&gt;</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- 若翻译完成（状态为<span class="number">2</span>），显示播放图标，点击播放翻译音频 --&gt;</span><br><span class="line">      &lt;view class=<span class="string">&quot;play-icon&quot;</span> catchtap=<span class="string">&quot;playTranslateVoice&quot;</span> catchtouchstart=<span class="string">&quot;playTranslateVoice&quot;</span> wx:if=<span class="string">&quot;&#123;&#123;recordStatus == 2</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure></li>
<li><strong>result-bubble.wxss</strong> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 消息气泡容器 */</span></span><br><span class="line"><span class="selector-class">.bubble-wrap</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 等待点样式 */</span></span><br><span class="line"><span class="selector-class">.wait-point</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>:inline-block;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">6px</span>;</span><br><span class="line">  <span class="attribute">height</span>:<span class="number">6px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>:<span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ddd</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 加载状态样式 */</span></span><br><span class="line"><span class="selector-class">.loading</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 分割线样式 */</span></span><br><span class="line"><span class="selector-class">.line-between</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#F1F1F1</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">30</span>rpx <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 创建时间文本样式 */</span></span><br><span class="line"><span class="selector-class">.create-time</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>:<span class="number">28</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#B2B2B2</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>:<span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 消息内容区域样式 */</span></span><br><span class="line"><span class="selector-class">.section-body</span>&#123;</span><br><span class="line">  <span class="attribute">word-wrap</span>: break-word;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#FFFFFF</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">16px</span> <span class="number">2px</span> <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.03</span>);</span><br><span class="line">  <span class="attribute">padding</span>:<span class="number">50</span>rpx <span class="number">60</span>rpx;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">260</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 消息详情文本样式 */</span></span><br><span class="line"><span class="selector-class">.text-detail</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">36</span>rpx;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.231</span>;</span><br><span class="line">  <span class="attribute">vertical-align</span>: text-bottom;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&quot;PingFang-SC-Regular&quot;</span>,<span class="string">&quot;SimSun&quot;</span>,<span class="string">&quot;Microsoft Yahei&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 英文和中文消息详情样式 */</span></span><br><span class="line"><span class="selector-class">.text-detail-en_US</span> &#123;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.231</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.text-detail-zh_CN</span> &#123;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.41</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 发送和翻译消息样式 */</span></span><br><span class="line"><span class="selector-class">.translate-message</span>,</span><br><span class="line"><span class="selector-class">.send-message</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.send-message</span> <span class="selector-class">.text-detail</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#9B9B9B</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 编辑图标样式 */</span></span><br><span class="line"><span class="selector-class">.edit-icon</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">8</span>rpx;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">7</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">8</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.edit-icon-img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>:<span class="number">40</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 播放图标样式 */</span></span><br><span class="line"><span class="selector-class">.play-icon</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">3</span>rpx;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">7</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">8</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 编辑和播放图标点击范围扩大 */</span></span><br><span class="line"><span class="selector-class">.edit-icon</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.play-icon</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>:<span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="attribute">position</span>:absolute;</span><br><span class="line">  <span class="attribute">top</span>:-<span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">left</span>:-<span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">bottom</span>:-<span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">right</span>:-<span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 消息文本内容样式 */</span></span><br><span class="line"><span class="selector-class">.text-content</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">48px</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 模态框容器样式 */</span></span><br><span class="line"><span class="selector-class">.modal-wrap</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>:border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 重置navigator样式 */</span></span><br><span class="line"><span class="selector-class">.navigator-hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> #### 4.1.2.5
components/waiting-icon</li>
</ul>
<p>等待加载组件</p>
<p>以下代码主要功能是：</p>
<ol type="1">
<li>控制等待动画的开始，停止</li>
<li>设置等待动画的间隔</li>
</ol>
<ul>
<li><strong>waiting-icon.js</strong> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义小程序组件</span></span><br><span class="line">Component(&#123;</span><br><span class="line">  <span class="attr">properties</span>: &#123;</span><br><span class="line">    <span class="comment">// 这里定义了组件的属性</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 组件的初始数据</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">waiting_animation</span>: &#123;&#125;,     <span class="comment">// 定义等待动画对象</span></span><br><span class="line">    <span class="attr">waiting_animation_1</span>: &#123;&#125;,   <span class="comment">// 定义另一个等待动画对象</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 组件的生命周期函数，在组件布局完成后执行</span></span><br><span class="line">  <span class="attr">ready</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;ready waitting&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建两个等待动画，一个持续600毫秒，一个持续400毫秒</span></span><br><span class="line">    <span class="built_in">this</span>.waiting_animation = wx.createAnimation(&#123;</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">600</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">this</span>.waiting_animation_1 = wx.createAnimation(&#123;</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">400</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置动画循环</span></span><br><span class="line">    <span class="built_in">this</span>.setWaitInterval()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 组件生命周期函数，在组件实例被从页面节点树移除时执行</span></span><br><span class="line">  <span class="attr">detached</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 当组件被移除时，清除动画</span></span><br><span class="line">    <span class="built_in">this</span>.clearAnimation()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 清除动画的函数</span></span><br><span class="line">    <span class="attr">clearAnimation</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.endWaitAnimation()</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 结束动画的函数，将清除循环，并重置动画对象</span></span><br><span class="line">    <span class="attr">endWaitAnimation</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.data.waiting_interval)</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123; <span class="attr">waiting_animation</span> : &#123;&#125;&#125;)</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123; <span class="attr">waiting_animation_1</span>: &#123;&#125; &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始动画的函数，设置动画的参数并启动动画</span></span><br><span class="line">    <span class="attr">startWaitAnimation</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.waiting_animation.opacity(<span class="number">0</span>).scale(<span class="number">1.2</span>, <span class="number">1.2</span>).step()</span><br><span class="line">      <span class="built_in">this</span>.waiting_animation.opacity(<span class="number">1</span>).scale(<span class="number">1</span>, <span class="number">1</span>).step()</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123; <span class="attr">waiting_animation</span>: <span class="built_in">this</span>.waiting_animation.export() &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>.waiting_animation_1.opacity(<span class="number">0</span>).scale(<span class="number">1.2</span>, <span class="number">1.2</span>).step()</span><br><span class="line">      <span class="built_in">this</span>.waiting_animation_1.opacity(<span class="number">1</span>).scale(<span class="number">1</span>, <span class="number">1</span>).step()</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123; <span class="attr">waiting_animation_1</span>: <span class="built_in">this</span>.waiting_animation_1.export() &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置动画循环的函数，将清除并重新启动动画循环</span></span><br><span class="line">    <span class="attr">setWaitInterval</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.endWaitAnimation()</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 创建一个新的循环，每600毫秒启动一次动画</span></span><br><span class="line">      <span class="built_in">this</span>.data.waiting_interval = <span class="built_in">setInterval</span>( <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.startWaitAnimation()</span><br><span class="line">      &#125;,<span class="number">600</span> )</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>waiting-icon.json</strong> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;component&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;usingComponents&quot;</span>: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>waiting-icon.wxml</strong> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;view class=&quot;loading&quot;&gt;</span><br><span class="line">  &lt;view    class=&quot;loading-<span class="attribute">icon</span>&quot;&gt;.&lt;/view&gt;</span><br><span class="line">  &lt;view <span class="attribute">animation</span>=&quot;&#123;&#123;waiting_animation&#125;&#125;&quot; class=&quot;loading-<span class="attribute">icon</span>&quot;&gt;.&lt;/view&gt;</span><br><span class="line">  &lt;view <span class="attribute">animation</span>=&quot;&#123;&#123;waiting_animation_1&#125;&#125;&quot; class=&quot;loading-<span class="attribute">icon</span>&quot;&gt;.&lt;/view&gt;</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure></li>
<li><strong>waiting-icon.wxss</strong> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-class">.loading</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">display</span>: inline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading-icon</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure> ### 4.1.3
imgs/</li>
</ul>
<p>包含微信小程序内部需要用到的静态图片。</p>
<h3 id="pages">4.1.4 pages/</h3>
<h4 id="pageschoose_language">4.1.4.1 pages/choose_language</h4>
<p>切换翻译语言的页面，该页面包含两个语言列表，分别代表源语言和目标语言，用户可以通过点击列表中的项来选择语言。选择的语言信息会被保存到本地存储和全局变量中，并在页面显示时更新。</p>
<h5 id="choose_language.js">1 choose_language.js</h5>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取全局应用实例</span></span><br><span class="line"><span class="keyword">const</span> app = getApp()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入工具函数</span></span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;../../utils/util.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义页面</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  <span class="comment">// 页面初始数据</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="comment">// 语言列表，每一种语言包含一个图像、语言名称、音频等信息</span></span><br><span class="line">    <span class="attr">list_aPbtoDn5</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>:<span class="string">&quot;...&quot;</span>, <span class="string">&quot;text&quot;</span>: <span class="string">&quot;中文&quot;</span>, <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;中文&#x27;</span>, <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;zh&#x27;</span>, <span class="string">&#x27;sound&#x27;</span>:<span class="string">&#x27;zh_CN&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>:<span class="string">&quot;...&quot;</span>, <span class="string">&quot;text&quot;</span>: <span class="string">&quot;英语&quot;</span>, <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;英文&#x27;</span>, <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;sound&#x27;</span>:<span class="string">&#x27;en_US&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>:<span class="string">&quot;...&quot;</span>, <span class="string">&quot;text&quot;</span>: <span class="string">&quot;德语&quot;</span>, <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;德语&#x27;</span>, <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;de&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>:<span class="string">&quot;...&quot;</span>, <span class="string">&quot;text&quot;</span>: <span class="string">&quot;韩语&quot;</span>, <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;韩语&#x27;</span>, <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;kor&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">selectedIndex1</span>: <span class="literal">null</span>, <span class="comment">// 记录第一次选择的语言的索引</span></span><br><span class="line">    <span class="attr">selectedIndex2</span>: <span class="literal">null</span>, <span class="comment">// 记录第二次选择的语言的索引</span></span><br><span class="line">    <span class="attr">isClicked1</span>: <span class="literal">false</span>,    <span class="comment">// 是否已经完成第一次点击</span></span><br><span class="line">    <span class="attr">isClicked2</span>: <span class="literal">false</span>,    <span class="comment">// 是否已经完成第二次点击</span></span><br><span class="line">    <span class="attr">langList</span>: app.globalData.langList, <span class="comment">// 全局语言列表</span></span><br><span class="line">    <span class="attr">curLang</span>: &#123;&#125;,          <span class="comment">// 当前语言</span></span><br><span class="line">    <span class="attr">fromLang</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">targetLang</span>: &#123;&#125;,       <span class="comment">// 目标语言</span></span><br><span class="line">    <span class="attr">currentsound</span>:<span class="string">&#x27;&#x27;</span>,      <span class="comment">// 当前语音</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 页面分享功能</span></span><br><span class="line">  <span class="function"><span class="title">onShareAppMessage</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理第一次点击</span></span><br><span class="line">  <span class="attr">handleTap1</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">isClicked1</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">isClicked2</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理第二次点击</span></span><br><span class="line">  <span class="attr">handleTap2</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">isClicked2</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">isClicked1</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理点击事件，获取点击的语言信息，并保存到对应的数据中</span></span><br><span class="line">  <span class="attr">handleTap</span>: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> langObj = e.currentTarget.dataset</span><br><span class="line">    <span class="keyword">var</span> index = langObj.index;</span><br><span class="line">    <span class="keyword">var</span> sound =langObj.sound;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Clicked item index and sound : &quot;</span>, index,sound);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.data.isClicked1) &#123;</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">selectedIndex1</span>: index,</span><br><span class="line">        <span class="attr">fromLang</span>: langObj </span><br><span class="line">      &#125;);</span><br><span class="line">      app.globalData.fromLang = langObj</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">selectedIndex2</span>: index,</span><br><span class="line">        <span class="attr">targetLang</span>: langObj,</span><br><span class="line">        <span class="attr">currentsound</span>:sound</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 把当前的语言和音频信息保存到本地存储中</span></span><br><span class="line">      wx.setStorageSync(<span class="string">&#x27;currentsound&#x27;</span>, <span class="built_in">this</span>.data.currentsound);</span><br><span class="line">      wx.setStorageSync(<span class="string">&#x27;language&#x27;</span>, langObj)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 把当前的语言保存到全局变量中</span></span><br><span class="line">      <span class="built_in">this</span>.setData(&#123; <span class="string">&#x27;curLang&#x27;</span>: langObj &#125;)</span><br><span class="line">      app.globalData.curLang = langObj</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Selected item: &quot;</span>, <span class="built_in">this</span>.data.curLang, <span class="built_in">this</span>.data.targetLang);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 当页面显示时，更新当前语言信息</span></span><br><span class="line">  <span class="attr">onShow</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123; <span class="attr">curLang</span>: app.globalData.curLang &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="choose_language.json">2 choose_language.json</h5>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;usingComponents&quot;</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="choose_language.wxml">3 choose_language.wxml</h5>
<p>该段代码的主要功能是显示一个语言列表，用户可以通过点击来选择“翻译语言”和“目标语言”。选择的语言会以不同的样式显示，以区分当前</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面主体是一个垂直方向的 <span class="attribute">flex</span> 布局 --&gt;</span><br><span class="line">&lt;view class=&quot;<span class="attribute">flex</span>-col page space-y-<span class="number">44</span>&quot;&gt;</span><br><span class="line">  &lt;!-- 头部区域是一个水平的 <span class="attribute">flex</span> 布局 --&gt;</span><br><span class="line">  &lt;view class=&quot;<span class="attribute">flex</span>-row items-center group space-x-<span class="number">8</span>&quot;&gt;</span><br><span class="line">    &lt;!-- 点击图片，会导航到首页 --&gt;</span><br><span class="line">    &lt;navigator url=&quot;../../pages/index/index&quot; open-type=&quot;redirect&quot; style=&quot;<span class="attribute">display</span>: inline-block<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;image class=&quot;</span>image<span class="string">&quot; src=&quot;</span>...<span class="string">&quot; /&gt;</span></span><br><span class="line"><span class="string">    &lt;/navigator&gt;</span></span><br><span class="line"><span class="string">    &lt;!-- 头部文字提示 --&gt;</span></span><br><span class="line"><span class="string">    &lt;text class=&quot;</span>text<span class="string">&quot;&gt;选择语言&lt;/text&gt;</span></span><br><span class="line"><span class="string">  &lt;/view&gt;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  &lt;!-- 内容区域也是一个垂直方向的 flex 布局 --&gt;</span></span><br><span class="line"><span class="string">  &lt;view class=&quot;</span>flex-col group_2 space-y-<span class="number">30</span><span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;!-- 包含两个选项：翻译语言和目标语言 --&gt;</span></span><br><span class="line"><span class="string">    &lt;view class=&quot;</span>flex-row space-x-<span class="number">15</span><span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;view class=&quot;</span>flex-row &#123;&#123;isClicked1 ? <span class="string">&#x27;text-wrapper_2&#x27;</span> : <span class="string">&#x27;text-wrapper&#x27;</span>&#125;&#125;&quot; bindtap=&quot;handleTap1&quot;&gt;</span><br><span class="line">        &lt;text class=&quot;font_1 &#123;&#123;isClicked1 ? &#x27;text_2&#x27; : <span class="string">&#x27;text_3&#x27;</span>&#125;&#125;&quot;&gt;翻译语言&lt;/text&gt;</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">      &lt;view class=&quot;<span class="attribute">flex</span>-row &#123;&#123;isClicked2 ? &#x27;text-wrapper&#x27; : <span class="string">&#x27;text-wrapper_2&#x27;</span>&#125;&#125;&quot; bindtap=&quot;handleTap2&quot;&gt;</span><br><span class="line">        &lt;text class=&quot;font_1 &#123;&#123;isClicked1 ? &#x27;text_3&#x27; : <span class="string">&#x27;text_2&#x27;</span>&#125;&#125;&quot;&gt;目标语言&lt;/text&gt;</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 语言列表区域 --&gt;</span><br><span class="line">    &lt;view class=&quot;<span class="attribute">flex</span>-col space-y-<span class="number">18</span>&quot;&gt;</span><br><span class="line">      &lt;text class=&quot;self-start font_2 text_4&quot;&gt;全部语言&lt;/text&gt;</span><br><span class="line">      &lt;!-- 遍历语言列表，生成每一项 --&gt;</span><br><span class="line">      &lt;view class=&quot;<span class="attribute">flex</span>-col space-y-<span class="number">16</span>&quot;&gt;</span><br><span class="line">        &lt;view</span><br><span class="line">          class=&quot;<span class="attribute">flex</span>-row items-center &#123;&#123;selectedIndex1 == <span class="selector-tag">i</span> &amp;&amp; isClicked1 == false || selectedIndex2 == <span class="selector-tag">i</span> &amp;&amp; isClicked1 == true ? &#x27;list-item&#x27; : <span class="string">&#x27;list-item_2&#x27;</span>&#125;&#125; space-x-<span class="number">24</span>&quot;</span><br><span class="line">          wx:for=<span class="string">&quot;&#123;&#123;list_aPbtoDn5&#125;&#125;&quot;</span></span><br><span class="line">          wx:key=<span class="string">&quot;index&quot;</span></span><br><span class="line">          wx:for-item=<span class="string">&quot;item&quot;</span></span><br><span class="line">          wx:for-index=<span class="string">&quot;i&quot;</span></span><br><span class="line">          data-chs=<span class="string">&quot;&#123;&#123;item.chs&#125;&#125;&quot;</span> </span><br><span class="line">          data-lang=<span class="string">&quot;&#123;&#123;item.lang&#125;&#125;&quot;</span></span><br><span class="line">          data-index=<span class="string">&quot;&#123;&#123;i&#125;&#125;&quot;</span></span><br><span class="line">          data-src=<span class="string">&quot;&#123;&#123;item.image&#125;&#125;&quot;</span></span><br><span class="line">          data-sound=<span class="string">&quot;&#123;&#123;item.sound ? item.sound : &#x27;en_US&#x27;&#125;&#125;&quot;</span></span><br><span class="line">          bindtap=<span class="string">&quot;handleTap&quot;</span></span><br><span class="line">        &gt;</span><br><span class="line">          &lt;!-- 语言图标 --&gt;</span><br><span class="line">          &lt;image class=<span class="string">&quot;image_2&quot;</span> src=<span class="string">&quot;&#123;&#123;item.image&#125;&#125;&quot;</span>/&gt;</span><br><span class="line">          &lt;!-- 语言名称 --&gt;</span><br><span class="line">          &lt;text class=<span class="string">&quot;&#123;&#123;selectedIndex1 == i &amp;&amp; isClicked1 == false || selectedIndex2 == i &amp;&amp; isClicked1 == true ? &#x27;text_5&#x27; : &#x27;text_6&#x27;&#125;&#125; &quot;</span>&gt;&#123;&#123;item.text&#125;&#125;&lt;/text&gt;</span><br><span class="line">        &lt;/view&gt;</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/view&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="choose_language.wxss">4 choose_language.wxss</h5>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 页面样式，包含内边距，背景色，宽度，溢出处理等样式 */</span></span><br><span class="line"><span class="selector-class">.page</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">72</span>rpx <span class="number">0</span> <span class="number">264</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f8f8f9</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">overflow-y</span>: auto;</span><br><span class="line">  <span class="attribute">overflow-x</span>: hidden;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 处理间距类 .space-y-44 的子元素之间的垂直间距 */</span></span><br><span class="line"><span class="selector-class">.space-y-44</span> &gt; view<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-y-44</span> &gt; text<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-y-44</span> &gt; image<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child) &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">88</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 处理类 .group 的内边距 */</span></span><br><span class="line"><span class="selector-class">.group</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">16</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 处理间距类 .space-x-8 的子元素之间的水平间距 */</span></span><br><span class="line"><span class="selector-class">.space-x-8</span> &gt; view<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-x-8</span> &gt; text<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-x-8</span> &gt; image<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child) &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">16</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 图片样式，包括宽高设置 */</span></span><br><span class="line"><span class="selector-class">.image</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">48</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">48</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 文本样式，包含字体，颜色，大小等 */</span></span><br><span class="line"><span class="selector-class">.text</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1e3163</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">36</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">34</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 处理类 .group_2 的内边距 */</span></span><br><span class="line"><span class="selector-class">.group_2</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">48</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 处理间距类 .space-y-30 的子元素之间的垂直间距 */</span></span><br><span class="line"><span class="selector-class">.space-y-30</span> &gt; view<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-y-30</span> &gt; text<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-y-30</span> &gt; image<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child) &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">60</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 处理间距类 .space-x-15 的子元素之间的水平间距 */</span></span><br><span class="line"><span class="selector-class">.space-x-15</span> &gt; view<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-x-15</span> &gt; text<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-x-15</span> &gt; image<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child) &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">80</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义文本容器样式，包括内边距、背景颜色、圆角半径、阴影、高度、边框和宽度等 */</span></span><br><span class="line"><span class="selector-class">.text-wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">28</span>rpx <span class="number">85</span>rpx <span class="number">40</span>rpx <span class="number">85</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16</span>rpx;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">drop-shadow</span>(<span class="number">0px</span> <span class="number">0px</span> <span class="number">1</span>rpx <span class="number">#000000</span>0a, <span class="number">0px</span> <span class="number">0px</span> <span class="number">2</span>rpx <span class="number">#000000</span>0f, <span class="number">0px</span> <span class="number">8</span>rpx <span class="number">8</span>rpx <span class="number">#000000</span>0a);</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50</span>rpx;</span><br><span class="line">  <span class="attribute">border</span>: solid <span class="number">2</span>rpx <span class="number">#0064e1</span>;</span><br><span class="line">  <span class="attribute">width</span> :<span class="number">40%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义文本容器2的样式，包括内边距、背景颜色、圆角半径、高度、边框和宽度等 */</span></span><br><span class="line"><span class="selector-class">.text-wrapper_2</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">28</span>rpx <span class="number">85</span>rpx <span class="number">40</span>rpx <span class="number">85</span>rpx;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span> <span class="number">1</span> <span class="number">310</span>rpx;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50</span>rpx;</span><br><span class="line">  <span class="attribute">border</span>: solid <span class="number">2</span>rpx <span class="number">#a7a7a7</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义字体样式，包括字体大小、字体系列和行高 */</span></span><br><span class="line"><span class="selector-class">.font_1</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">26</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义文本样式，包括颜色、字体权重、背景图像 */</span></span><br><span class="line"><span class="selector-class">.text_3</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: transparent;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(<span class="number">180deg</span>, <span class="number">#0064e1</span> <span class="number">0%</span>, <span class="number">#0845c2</span> <span class="number">100%</span>);</span><br><span class="line">  -webkit-<span class="attribute">background-clip</span>: text;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义文本2的样式，颜色为灰色 */</span></span><br><span class="line"><span class="selector-class">.text_2</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#a8a8a8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设置间距类 .space-y-18 的子元素之间的垂直间距 */</span></span><br><span class="line"><span class="selector-class">.space-y-18</span> &gt; view<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-y-18</span> &gt; text<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-y-18</span> &gt; image<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child) &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">36</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义字体2的样式，包括字体大小、字体系列、行高和颜色 */</span></span><br><span class="line"><span class="selector-class">.font_2</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">29</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1e3163</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义文本4的样式，字体权重为700，行高为30rpx */</span></span><br><span class="line"><span class="selector-class">.text_4</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设置间距类 .space-y-16 的子元素之间的垂直间距 */</span></span><br><span class="line"><span class="selector-class">.space-y-16</span> &gt; view<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-y-16</span> &gt; text<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-y-16</span> &gt; image<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child) &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">32</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义图片2的样式，包括宽度和高度 */</span></span><br><span class="line"><span class="selector-class">.image_2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">64</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">64</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义文本5的样式，包括颜色、字体大小、字体系列、字体权重和行高 */</span></span><br><span class="line"><span class="selector-class">.text_5</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">35</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设置文本6的上边距 */</span></span><br><span class="line"><span class="selector-class">.text_6</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设置间距类 .space-x-24 的子元素之间的水平间距 */</span></span><br><span class="line"><span class="selector-class">.space-x-24</span> &gt; view<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-x-24</span> &gt; text<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-x-24</span> &gt; image<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child) &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">48</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义列表项样式，包括内边距、背景颜色、圆角半径和阴影等 */</span></span><br><span class="line"><span class="selector-class">.list-item</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#1392fb</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16</span>rpx;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">2</span>rpx <span class="number">#000000</span>0a, <span class="number">0px</span> <span class="number">0px</span> <span class="number">4</span>rpx <span class="number">#000000</span>0f, <span class="number">0px</span> <span class="number">8</span>rpx <span class="number">16</span>rpx <span class="number">#000000</span>0a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义列表项2的样式，包括内边距、背景颜色、圆角半径和阴影等 */</span></span><br><span class="line"><span class="selector-class">.list-item_2</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16</span>rpx;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">2</span>rpx <span class="number">#000000</span>0a, <span class="number">0px</span> <span class="number">0px</span> <span class="number">4</span>rpx <span class="number">#000000</span>0f, <span class="number">0px</span> <span class="number">8</span>rpx <span class="number">16</span>rpx <span class="number">#000000</span>0a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="pagesedit">4.1.4.2 pages/edit</h4>
<p>编辑文本的输入框页面，编辑文本的最大长度限制为200个字符，页面数据中的<code>edit_text</code>字段存储输入的文本，<code>remain_length</code>字段存储剩余可输入的字符数。</p>
<p>当用户在输入框中输入或删除文本时，页面会更新剩余可输入的字符数并显示给用户。当用户提交输入文本时，如果文本长度超过0且与旧文本不相同，页面会将新文本保存到上一页面的对话列表中，并返回上一页面；否则，如果用户提交的文本为空，页面会提供相应的处理。</p>
<h5 id="edit.js">1 edit.js</h5>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//初始化底部高度</span></span><br><span class="line"><span class="keyword">const</span> initBottomHeight = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = getApp()</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">  <span class="comment">// 页面的初始数据</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">edit_text_max</span>: <span class="number">200</span>,     <span class="comment">//最大编辑文本长度</span></span><br><span class="line">    <span class="attr">remain_length</span>: <span class="number">200</span>,     <span class="comment">//剩余可输入长度</span></span><br><span class="line">    <span class="attr">edit_text</span>: <span class="string">&quot;&quot;</span>,          <span class="comment">//编辑文本内容</span></span><br><span class="line">    <span class="attr">is_focus</span>: <span class="literal">false</span>,        <span class="comment">//是否聚焦</span></span><br><span class="line">    <span class="attr">tips</span>: <span class="string">&quot;&quot;</span>,               <span class="comment">//提示信息</span></span><br><span class="line">    <span class="attr">index</span>: -<span class="number">1</span>,              <span class="comment">//索引</span></span><br><span class="line">    <span class="attr">bottomHeight</span>:  initBottomHeight  <span class="comment">//底部高度</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取最大编辑文本长度</span></span><br><span class="line">  <span class="attr">getEditTextMax</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.data.edit_text_max</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新剩余可输入长度</span></span><br><span class="line">  <span class="attr">updateRemainLength</span>: <span class="function"><span class="keyword">function</span> (<span class="params">now_content</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.data.remain_length = <span class="built_in">this</span>.getEditTextMax() - now_content.length</span><br><span class="line">    <span class="built_in">this</span>.data.tips = <span class="string">&quot;还可以输入&quot;</span> + <span class="built_in">this</span>.data.remain_length + <span class="string">&quot;字...&quot;</span></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123; <span class="attr">tips</span>: <span class="built_in">this</span>.data.tips &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置编辑文本内容</span></span><br><span class="line">  <span class="attr">setEditText</span>: <span class="function"><span class="keyword">function</span> (<span class="params">text</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.data.edit_text = text</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123; <span class="attr">edit_text</span>: <span class="built_in">this</span>.data.edit_text &#125;)</span><br><span class="line">    <span class="comment">// 更新剩余长度显示</span></span><br><span class="line">    <span class="built_in">this</span>.updateRemainLength(text)</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123; <span class="attr">is_focus</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// bindinput事件处理</span></span><br><span class="line">  <span class="attr">editInput</span>: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(event)</span><br><span class="line">    <span class="keyword">if</span> (event.detail.value.length &gt; <span class="built_in">this</span>.getEditTextMax()) &#123;</span><br><span class="line">      <span class="comment">//处理输入内容超过最大长度的情况</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.data.edit_text = event.detail.value</span><br><span class="line">      <span class="built_in">this</span>.updateRemainLength(<span class="built_in">this</span>.data.edit_text)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// bindconfirm事件处理</span></span><br><span class="line">  <span class="attr">editConfirm</span>: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.data.edit_text.length &gt; <span class="number">0</span> &amp;&amp; <span class="built_in">this</span>.data.edit_text != <span class="built_in">this</span>.data.oldText) &#123;</span><br><span class="line">      <span class="comment">// 获取页面栈</span></span><br><span class="line">      <span class="keyword">let</span> pages = getCurrentPages();</span><br><span class="line">      <span class="keyword">let</span> prevPage = pages[pages.length - <span class="number">2</span>];  <span class="comment">//上一个页面</span></span><br><span class="line">      <span class="keyword">let</span> dialogList = prevPage.data.dialogList.slice(<span class="number">0</span>)</span><br><span class="line">      <span class="keyword">let</span> editItem = dialogList[dialogList.length - <span class="number">1</span>]</span><br><span class="line">      editItem.text = <span class="built_in">this</span>.data.edit_text</span><br><span class="line"></span><br><span class="line">      prevPage.setData(&#123;</span><br><span class="line">        <span class="attr">dialogList</span>: dialogList,</span><br><span class="line">        <span class="attr">recordStatus</span>: <span class="number">2</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      wx.navigateBack()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 处理输入文本为空的情况</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 点击输入框时改变底部按钮的高度，使得提示和按钮始终在键盘上方</span></span><br><span class="line">  <span class="attr">editFocus</span>: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;value, height&#125; = e.detail</span><br><span class="line">    <span class="built_in">console</span>.log(value, height)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isNaN</span>(height)) &#123;</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">bottomHeight</span>: height + initBottomHeight</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 输入框失去焦点事件处理</span></span><br><span class="line">  <span class="attr">editBlur</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">bottomHeight</span>: initBottomHeight</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 清空内容事件处理</span></span><br><span class="line">  <span class="attr">deleteContent</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setEditText(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">is_focus</span>: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生命周期函数--监听页面加载</span></span><br><span class="line">  <span class="attr">onLoad</span>: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setEditText(options.content)</span><br><span class="line">    <span class="keyword">let</span> index = <span class="built_in">parseInt</span>(options.index)</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">index</span>: index,</span><br><span class="line">        <span class="attr">oldText</span>: options.content,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="edit.json">2 edit.json</h5>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="edit.wxml">3 edit.wxml</h5>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- edit<span class="selector-class">.wxml</span> --&gt;</span><br><span class="line">&lt;!-- 定义了一个编辑文本的页面 --&gt;</span><br><span class="line">&lt;view class=&quot;container edit-container&quot;&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 编辑区域，使用<span class="selector-tag">textarea</span>组件 --&gt;</span><br><span class="line">  &lt;<span class="selector-tag">textarea</span> </span><br><span class="line">    maxlength=&quot;&#123;&#123;edit_text_max&#125;&#125;&quot;        &lt;!-- 设置最大输入长度 --&gt;</span><br><span class="line">    class=&quot;edit_textarea&quot;                &lt;!-- 指定样式 --&gt;</span><br><span class="line">    <span class="attribute">auto</span>-focus=&quot;&#123;&#123;true&#125;&#125;&quot;                 </span><br><span class="line">    focus=&quot;&#123;&#123;is_focus&#125;&#125;&quot;                  </span><br><span class="line">    bindinput=&quot;editInput&quot;                &lt;!-- 绑定输入事件 --&gt;</span><br><span class="line">    bindconfirm=&quot;editConfirm&quot;            &lt;!-- 绑定确定事件 --&gt;</span><br><span class="line">    value=&quot;&#123;&#123;edit_text&#125;&#125;&quot;                &lt;!-- 显示的文本 --&gt;</span><br><span class="line">    adjust-<span class="attribute">position</span>=&quot;&#123;&#123;true&#125;&#125;&quot;           &lt;!-- 自动调整输入框位置 --&gt;</span><br><span class="line">    bindfocus=&quot;editFocus&quot;                </span><br><span class="line">    bindblur=&quot;editBlur&quot;&gt;                  </span><br><span class="line">  &lt;/<span class="selector-tag">textarea</span>&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 底部区域，显示提示和删除按钮 --&gt;</span><br><span class="line">  &lt;view class=&quot;<span class="attribute">bottom</span>-wrap&quot; style=&quot;<span class="attribute">padding-bottom</span>: &#123;&#123;bottomHeight&#125;&#125;px&quot;&gt;</span><br><span class="line">    &lt;view class=&quot;tips-wrapper&quot;&gt;</span><br><span class="line">      &lt;!-- 显示提示信息 --&gt;</span><br><span class="line">      &lt;text class=&quot;edit-tips&quot;&gt;&#123;&#123;tips&#125;&#125;&lt;/text&gt;</span><br><span class="line">      &lt;!-- 删除按钮 --&gt;</span><br><span class="line">      &lt;view class=&quot;delete-<span class="attribute">content</span>&quot; capture-bind:tap=<span class="string">&quot;deleteContent&quot;</span>&gt;</span><br><span class="line">        &lt;!-- 使用图片作为删除按钮的图标 --&gt;</span><br><span class="line">        &lt;image src=<span class="string">&quot;../../imgs/delete_all.png&quot;</span> class=<span class="string">&quot;img-delete-all&quot;</span>&gt;&lt;/image&gt;</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/view&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="edit.wxss">3 edit.wxss</h5>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* pages/edit/edit.wxss */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 容器样式 */</span></span><br><span class="line"><span class="selector-class">.edit-container</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span> <span class="number">50</span>rpx <span class="number">20</span>rpx;          <span class="comment">/* 内边距设置 */</span></span><br><span class="line">  <span class="attribute">justify-content</span>: flex-start;         <span class="comment">/* 子元素沿主轴的对齐方式 */</span></span><br><span class="line">  -webkit-<span class="attribute">justify-content</span>: flex-start; <span class="comment">/* WebKit内核的浏览器兼容设置 */</span></span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#FAFAFA</span>;           <span class="comment">/* 背景色 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 文本输入框样式 */</span></span><br><span class="line"><span class="selector-class">.edit_textarea</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;                             <span class="comment">/* 弹性布局比例设置 */</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;                         <span class="comment">/* 宽度100% */</span></span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;              <span class="comment">/* 设置盒模型 */</span></span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">36</span>rpx;                    <span class="comment">/* 字体大小 */</span></span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">60</span>rpx;                  <span class="comment">/* 行高 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 底部提示和删除按钮容器样式 */</span></span><br><span class="line"><span class="selector-class">.tips-wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;                         <span class="comment">/* 宽度100% */</span></span><br><span class="line">  <span class="attribute">display</span>: flex;                       <span class="comment">/* 使用弹性布局 */</span></span><br><span class="line">  <span class="attribute">display</span>: -webkit-flex;               <span class="comment">/* WebKit内核的浏览器兼容设置 */</span></span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;      <span class="comment">/* 子元素之间的间距均匀分布 */</span></span><br><span class="line">  -webkit-<span class="attribute">justify-content</span>: space-between; <span class="comment">/* WebKit内核的浏览器兼容设置 */</span></span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;                          <span class="comment">/* 内边距设置 */</span></span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;              <span class="comment">/* 设置盒模型 */</span></span><br><span class="line">  <span class="attribute">align-items</span>: center;                 <span class="comment">/* 子元素沿交叉轴的对齐方式 */</span></span><br><span class="line">  -webkit-<span class="attribute">align-items</span>: center;         <span class="comment">/* WebKit内核的浏览器兼容设置 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 提示文字样式 */</span></span><br><span class="line"><span class="selector-class">.edit-tips</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">30</span>rpx;                    <span class="comment">/* 字体大小 */</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#B2B2B2</span>;                      <span class="comment">/* 字体颜色 */</span></span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">50</span>rpx;                  <span class="comment">/* 行高 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 删除按钮图标样式 */</span></span><br><span class="line"><span class="selector-class">.img-delete-all</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">32</span>rpx;                       <span class="comment">/* 高度 */</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">28</span>rpx;                        <span class="comment">/* 宽度 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 删除按钮容器样式 */</span></span><br><span class="line"><span class="selector-class">.delete-content</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;                  <span class="comment">/* 定位方式 */</span></span><br><span class="line">  <span class="attribute">right</span>: -<span class="number">20</span>rpx;                       <span class="comment">/* 向右偏移 */</span></span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx <span class="number">20</span>rpx;                <span class="comment">/* 内边距设置 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="pagesgetpic">4.1.4.3 pages/getPic</h4>
<h5 id="getpic.js">1 getPic.js</h5>
<p>这段代码的主要功能是：</p>
<ol type="1">
<li>拍照：用户可以点击按钮触发<code>takeShot</code>方法，调用微信的摄像头接口进行拍照，拍照成功后，会将图片转换为base64格式，并保存到全局变量中，然后跳转到OCR页面。</li>
<li>提示：用户可以点击按钮触发<code>onTap</code>方法，显示一个“只支持中译英”的提示。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入api模块，该模块可能包含了一些工具函数</span></span><br><span class="line"><span class="keyword">var</span> api = <span class="built_in">require</span>(<span class="string">&quot;../../utils/api.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取全局的app实例</span></span><br><span class="line"><span class="keyword">const</span> app = getApp();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个页面</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  <span class="comment">// 页面的初始数据</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义一个方法，用于拍照</span></span><br><span class="line">  <span class="attr">takeShot</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 创建一个摄像头的上下文</span></span><br><span class="line">    <span class="keyword">const</span> ctx = wx.createCameraContext()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用上下文来拍照</span></span><br><span class="line">    ctx.takePhoto(&#123;</span><br><span class="line">      <span class="comment">// 设置图片质量为高</span></span><br><span class="line">      <span class="attr">quality</span>: <span class="string">&#x27;high&#x27;</span>, <span class="comment">// 上传图片进行文字提取时，图片转换为base64后，大小不能超过300k</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 拍照成功后的回调函数</span></span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 打印图片的临时地址</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;图片的临时地址为：&quot;</span> + res.tempImagePath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用api模块的getPicBase64函数，将图片转换为base64格式</span></span><br><span class="line">        api.getPicBase64(res.tempImagePath).then(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 将转换后的base64图片保存到全局数据中</span></span><br><span class="line">          app.globalData.picBase64 = res.data;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 导航到OCR页面</span></span><br><span class="line">          wx.navigateTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;../OCR/OCR&#x27;</span>,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义一个方法，用于显示提示</span></span><br><span class="line">  <span class="attr">onTap</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 显示一个只支持中译英的提示</span></span><br><span class="line">    wx.showToast(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;只支持中译英&#x27;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;error&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="getpic.json">2 getPic.json</h5>
<p>缺省代码。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;usingComponents&quot;</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="getpic.wxml">3 getPic.wxml</h5>
<p>这段代码的主要功能是：</p>
<ol type="1">
<li>头部视图：包含了一个语言切换视图，用户可以点击中文或英文图标和文字来切换语言。</li>
<li>摄像头视图：显示一个摄像头，用户可以通过这个摄像头来拍照。</li>
<li>工具栏视图：包含了一个拍照图标，用户可以点击这个图标来拍照。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 头部视图 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;head&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 语言切换视图，点击时触发onTap事件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;language&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;onTap&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 中文图标，点击时触发onTap事件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">bindtap</span>=<span class="string">&quot;onTap&quot;</span> <span class="attr">class</span>=<span class="string">&quot;language_pic&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/Chinese.png&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 中文文字，点击时触发onTap事件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">bindtap</span>=<span class="string">&quot;onTap&quot;</span> <span class="attr">class</span>=<span class="string">&quot;language_text&quot;</span> <span class="attr">decode</span>&gt;</span><span class="symbol">&amp;nbsp;</span>中文<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 切换图标，点击时触发onTap事件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">bindtap</span>=<span class="string">&quot;onTap&quot;</span> <span class="attr">class</span>=<span class="string">&quot;switch&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/switch.png&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 英文图标，点击时触发onTap事件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">bindtap</span>=<span class="string">&quot;onTap&quot;</span> <span class="attr">class</span>=<span class="string">&quot;language_pic&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/English.png&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 英文文字，点击时触发onTap事件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">bindtap</span>=<span class="string">&quot;onTap&quot;</span> <span class="attr">class</span>=<span class="string">&quot;language_text&quot;</span> <span class="attr">decode</span>&gt;</span><span class="symbol">&amp;nbsp;</span>英语<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 摄像头视图 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">camera</span> <span class="attr">style</span>=<span class="string">&quot;margin-top:0rpx;width:100%;height:1100rpx&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">camera</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 工具栏视图 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;toolbar&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 拍照图标，点击时触发takeShot事件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;shot&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/takeshot.png&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;takeShot&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="getpic.wxss">4 getPic.wxss</h5>
<p>这段CSS样式表的主要功能是：</p>
<ol type="1">
<li><code>.head</code>：设置头部视图的样式，包括位置、大小和背景颜色。</li>
<li><code>.btn</code>：设置按钮的样式，包括背景颜色、大小、内边距、颜色、边框圆角、外边距和文本对齐方式。</li>
<li><code>.toolbar</code>：设置工具栏的样式，使用Flex布局，设置宽度、高度、主轴对齐方式和交叉轴对齐方式。</li>
<li><code>.shot</code>：设置拍照图标的样式，包括大小、文本对齐方式和上外边距。</li>
<li><code>image</code>：设置图片的样式，包括大小和垂直对齐方式。</li>
<li><code>.language</code>：设置语言切换视图的样式，使用Flex布局，设置上内边距、宽度、左内边距和垂直对齐方式。</li>
<li><code>.language_pic</code>：设置语言图标的样式，包括上内边距和垂直对齐方式。</li>
<li><code>.language_text</code>：设置语言文字的样式，包括上内边距、字体大小、字体家族、行高、颜色、上下左外边距、字体家族和行高。</li>
<li><code>.switch</code>：设置切换图标的样式，使用Flex布局，设置对齐方式、方向、边框圆角、大小和自动外边距。</li>
</ol>
<p>这些样式主要用于设置微信小程序中的元素样式，使得元素在页面上的布局和外观符合设计要求。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 头部视图样式 */</span></span><br><span class="line"><span class="selector-class">.head</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#1493FC</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 按钮样式 */</span></span><br><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#1493fc</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">15</span>rpx <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 工具栏样式 */</span></span><br><span class="line"><span class="selector-class">.toolbar</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">width</span>: auto;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 拍照图标样式 */</span></span><br><span class="line"><span class="selector-class">.shot</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">110</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">110</span>rpx;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">50</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 图片样式 */</span></span><br><span class="line">image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">vertical-align</span>: bottom;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 语言切换视图样式 */</span></span><br><span class="line"><span class="selector-class">.language</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300</span>rpx;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">80</span>rpx;</span><br><span class="line">  <span class="attribute">vertical-align</span>: bottom;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 语言图标样式 */</span></span><br><span class="line"><span class="selector-class">.language_pic</span> &#123;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">25</span>rpx;</span><br><span class="line">  <span class="attribute">vertical-align</span>: text-bottom;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 语言文字样式 */</span></span><br><span class="line"><span class="selector-class">.language_text</span> &#123;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">22</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 切换图标样式 */</span></span><br><span class="line"><span class="selector-class">.switch</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-start;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">72</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">72</span>rpx;</span><br><span class="line">  <span class="attribute">margin</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="pageshistory">4.1.4.4 pages/history</h4>
<h5 id="history.js">1 history.js</h5>
<p>这段代码的主要功能是：</p>
<ol type="1">
<li>显示历史记录：当页面显示时，会从本地存储中获取历史记录，并显示到页面上。</li>
<li>点击历史记录项：用户可以点击历史记录项，页面会重新加载首页，并将点击的历史记录项的查询参数传递给首页。</li>
<li>清除历史记录：用户可以点击按钮触发<code>onClearHistory</code>方法，清除页面数据中的历史记录数组，并清除本地存储中的历史记录。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入全局的app实例</span></span><br><span class="line"><span class="keyword">const</span> app = getApp()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个页面</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  <span class="comment">// 页面的初始数据</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">history</span>: [] <span class="comment">// 历史记录数组</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 页面显示时的回调函数</span></span><br><span class="line">  <span class="attr">onShow</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 从本地存储中获取历史记录，并设置到页面数据中</span></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">history</span>: wx.getStorageSync(<span class="string">&#x27;history&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 点击历史记录项时的回调函数</span></span><br><span class="line">  <span class="attr">onTapItem</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 重新加载首页，并传递点击的历史记录项的查询参数</span></span><br><span class="line">    wx.reLaunch(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/pages/index/index?query=<span class="subst">$&#123;e.currentTarget.dataset.query&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 清除历史记录的回调函数</span></span><br><span class="line">  <span class="attr">onClearHistory</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 将页面数据中的历史记录数组设置为空</span></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">history</span>: []</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清除本地存储中的历史记录</span></span><br><span class="line">    wx.clearStorage(<span class="string">&#x27;history&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="history.json">2 history.json</h5>
<p>缺省代码。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="history.wxml">3 history.wxml</h5>
<p>这段代码的主要功能是：</p>
<ol type="1">
<li>显示翻译历史：页面上有一个滚动视图，里面包含了一个历史记录列表视图，列表中的每一项都是一个历史记录项，显示了查询的语言、查询的文本、结果的语言和结果的文本。</li>
<li>清除历史记录：用户可以点击“清除历史记录”文本，触发<code>onClearHistory</code>事件，清除历史记录。</li>
<li>查看历史记录：用户可以点击历史记录项，触发<code>onTapItem</code>事件，查看历史记录的详细信息。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 可滚动视图，设置为纵向滚动 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">scroll-y</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 历史记录列表视图 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;history-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 头部视图 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 标题文本 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>翻译历史<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 清除历史记录文本，点击时触发onClearHistory事件 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">bindtap</span>=<span class="string">&#x27;onClearHistory&#x27;</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-close&quot;</span>&gt;</span>清除历史记录<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 历史记录项视图，遍历历史记录数组，点击时触发onTapItem事件，传递查询参数和语言索引 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;history&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;index&quot;</span> <span class="attr">bindtap</span>=<span class="string">&#x27;onTapItem&#x27;</span> <span class="attr">data-query</span>=<span class="string">&quot;&#123;&#123;item.query&#125;&#125;&quot;</span> <span class="attr">data-langId</span>=<span class="string">&quot;&#123;&#123;item.langIndex&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 查询视图 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;query&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 语言视图 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;language&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 语言图标 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/Chinese.png&quot;</span> /&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 语言文本 --&gt;</span></span><br><span class="line">          中文</span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 查询文本 --&gt;</span></span><br><span class="line">        &#123;&#123;item.query&#125;&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 结果视图 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;result&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 语言视图 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;language&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 语言图标 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/English.png&quot;</span> /&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 语言文本 --&gt;</span></span><br><span class="line">          英语</span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 结果文本 --&gt;</span></span><br><span class="line">        &#123;&#123;item.result&#125;&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="history.wxss">4 history.wxss</h5>
<p>这些样式主要用于设置微信小程序中的元素样式，使得元素在页面上的布局和外观符合设计要求。具体包括：</p>
<ol type="1">
<li><code>.history-list</code>：设置历史记录列表的样式，使用Flex布局，设置为列方向，设置内边距。</li>
<li><code>.header</code>：设置头部视图的样式，使用Flex布局，设置上外边距。</li>
<li><code>.title</code>：设置标题文本的样式，设置字体大小和颜色。</li>
<li><code>.icon-close</code>：设置清除历史记录图标的样式，设置左外边距为自动，设置字体大小和颜色。</li>
<li><code>.item</code>：设置历史记录项的样式，包括上外边距、内边距、背景颜色、边框圆角和阴影。</li>
<li><code>.item
.query</code>：设置查询视图的样式，包括内边距、底部边框、字体大小、字体家族、行高和颜色。</li>
<li><code>.item .query
.language</code>：设置查询语言的样式，包括字体大小、字体家族、行高、颜色、上下外边距。</li>
<li><code>.item
.result</code>：设置结果视图的样式，包括上外边距、内边距、字体大小、字体家族、行高和颜色。</li>
<li><code>.item .result
.language</code>：设置结果语言的样式，包括字体大小、字体家族、行高、颜色和下外边距。</li>
<li><code>image</code>：设置图片的样式，包括宽度、高度和垂直对齐方式。</li>
</ol>
<p>这些样式主要用于设置微信小程序中的元素样式，使得元素在页面上的布局和外观符合设计要求。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 历史记录列表样式 */</span></span><br><span class="line"><span class="selector-class">.history-list</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">40</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 头部视图样式 */</span></span><br><span class="line"><span class="selector-class">.header</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">100</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 标题文本样式 */</span></span><br><span class="line"><span class="selector-class">.title</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#8995a1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 清除历史记录图标样式 */</span></span><br><span class="line"><span class="selector-class">.icon-close</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: auto;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#aaa</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">26</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 历史记录项样式 */</span></span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16</span>rpx;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">2</span>rpx <span class="number">#000000</span>0a, <span class="number">0px</span> <span class="number">0px</span> <span class="number">4</span>rpx <span class="number">#000000</span>0f, <span class="number">0px</span> <span class="number">8</span>rpx <span class="number">16</span>rpx <span class="number">#000000</span>0a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 查询视图样式 */</span></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-class">.query</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">border-bottom</span>: solid <span class="number">2</span>rpx <span class="number">#e7e7e7</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">50</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1e3163</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 查询语言样式 */</span></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-class">.query</span> <span class="selector-class">.language</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#a8abb0</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 结果视图样式 */</span></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-class">.result</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">16</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">50</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1e3163</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 结果语言样式 */</span></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-class">.result</span> <span class="selector-class">.language</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#909dbd</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 图片样式 */</span></span><br><span class="line">image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">vertical-align</span>: bottom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="pagesindex">4.1.4.5 pages/index</h4>
<h5 id="index.js">1 index.js</h5>
<p>这段代码的主要功能包括：</p>
<ol type="1">
<li>用户输入文本进行翻译，翻译结果会保存在历史记录中。</li>
<li>用户可以点击清除图标清除输入的文本和翻译结果。</li>
<li>用户可以复制输入的文本和翻译结果。</li>
<li>用户可以播放翻译的语音。</li>
<li>用户可以查看翻译的历史记录。</li>
</ol>
<p>以下是代码的流程图：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">  Page --|&gt; data : contains</span><br><span class="line">  Page --|&gt; onLoad : function</span><br><span class="line">  Page --|&gt; onShow : function</span><br><span class="line">  Page --|&gt; onInput : function</span><br><span class="line">  Page --|&gt; onTapClose : function</span><br><span class="line">  Page --|&gt; onConfirm : function</span><br><span class="line">  Page --|&gt; copyTextIN : function</span><br><span class="line">  Page --|&gt; copyTextOUT : function</span><br><span class="line">  Page --|&gt; playTranslateVoice : function</span><br><span class="line">  Page --|&gt; onTapItem : function</span><br><span class="line">  data : query</span><br><span class="line">  data : hideClearIcon</span><br><span class="line">  data : result</span><br><span class="line">  data : curLang</span><br><span class="line">  data : currentTranslateVoice</span><br><span class="line">  data : currentsound</span><br><span class="line">  data : history</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入翻译工具和全局应用实例</span></span><br><span class="line"><span class="keyword">import</span> &#123; translate &#125; <span class="keyword">from</span> <span class="string">&#x27;../../utils/api.js&#x27;</span></span><br><span class="line"><span class="keyword">const</span> app = getApp()</span><br><span class="line"><span class="keyword">const</span> plugin = requirePlugin(<span class="string">&quot;WechatSI&quot;</span>)</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">query</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 用户输入的查询文本</span></span><br><span class="line">    <span class="attr">hideClearIcon</span>: <span class="literal">false</span>, <span class="comment">// 控制清除图标的显示与隐藏</span></span><br><span class="line">    <span class="attr">result</span>: [], <span class="comment">// 翻译结果</span></span><br><span class="line">    <span class="attr">curLang</span>: &#123;&#125;, <span class="comment">// 当前选择的语言</span></span><br><span class="line">    <span class="attr">fromLang</span>:&#123;&#125;,</span><br><span class="line">    <span class="attr">currentTranslateVoice</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 当前播放的语音路径</span></span><br><span class="line">    <span class="attr">currentsound</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 当前语音合成语言</span></span><br><span class="line">    <span class="attr">history</span>: [] <span class="comment">// 翻译历史记录</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 页面加载时的处理函数</span></span><br><span class="line">  <span class="attr">onLoad</span>: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (options.query) &#123;</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">query</span>: options.query,</span><br><span class="line">        <span class="string">&#x27;hideClearIcon&#x27;</span>: <span class="literal">false</span> <span class="comment">// 显示清除图标</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 页面显示时的处理函数</span></span><br><span class="line">  <span class="attr">onShow</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">history</span>: wx.getStorageSync(<span class="string">&#x27;history&#x27;</span>) <span class="comment">// 从本地存储获取历史记录</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.data.curLang.lang !== app.globalData.curLang.lang) &#123;</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">curLang</span>: app.globalData.curLang</span><br><span class="line">      &#125;)</span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">this</span>.data.fromLang.lang !== app.globalData.fromLang.lang) &#123;</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">fromLang</span>: app.globalData.fromLang</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="built_in">this</span>.onConfirm() <span class="comment">// 执行翻译</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理用户输入的函数</span></span><br><span class="line">  <span class="attr">onInput</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="string">&#x27;query&#x27;</span>: e.detail.value,</span><br><span class="line">      <span class="string">&#x27;hideClearIcon&#x27;</span>: <span class="built_in">this</span>.data.query.length &gt; <span class="number">0</span> ? <span class="literal">false</span> : <span class="literal">true</span> <span class="comment">// 根据输入内容是否为空来决定是否显示清除图标</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理用户点击清除图标的函数</span></span><br><span class="line">  <span class="attr">onTapClose</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">query</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">hideClearIcon</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">result</span>: <span class="string">&#x27;&#x27;</span> <span class="comment">// 清除翻译结果</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行翻译的函数</span></span><br><span class="line">  <span class="attr">onConfirm</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.data.query) <span class="keyword">return</span> <span class="comment">// 如果查询文本为空，则不执行翻译</span></span><br><span class="line">    translate(<span class="built_in">this</span>.data.query, &#123;</span><br><span class="line">      <span class="attr">from</span>: <span class="built_in">this</span>.data.fromLang.lang || <span class="string">&#x27;auto&#x27;</span>,</span><br><span class="line">      <span class="attr">to</span>: <span class="built_in">this</span>.data.curLang.lang</span><br><span class="line">    &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="string">&#x27;result&#x27;</span>: res.trans_result</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 更新历史记录</span></span><br><span class="line">      <span class="keyword">let</span> history = wx.getStorageSync(<span class="string">&#x27;history&#x27;</span>) || []</span><br><span class="line">      history.unshift(&#123;</span><br><span class="line">        <span class="attr">query</span>: <span class="built_in">this</span>.data.query,</span><br><span class="line">        <span class="attr">result</span>: res.trans_result[<span class="number">0</span>].dst,</span><br><span class="line">        <span class="attr">from</span>: res.from,</span><br><span class="line">        <span class="attr">to</span>: res.to</span><br><span class="line">      &#125;)</span><br><span class="line">      history.length = history.length &gt; <span class="number">10</span> ? <span class="number">10</span> : history.length</span><br><span class="line">      wx.setStorageSync(<span class="string">&#x27;history&#x27;</span>, history)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 复制输入文本的函数</span></span><br><span class="line">  <span class="attr">copyTextIN</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    wx.setClipboardData(&#123;</span><br><span class="line">      <span class="attr">data</span>: <span class="built_in">this</span>.data.query,</span><br><span class="line">      <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        wx.showToast(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;复制成功&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 复制翻译结果的函数</span></span><br><span class="line">  <span class="attr">copyTextOUT</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    wx.setClipboardData(&#123;</span><br><span class="line">      <span class="attr">data</span>: <span class="built_in">this</span>.data.result[<span class="number">0</span>].dst,</span><br><span class="line">      <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        wx.showToast(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;复制成功&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">     &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 播放翻译语音的函数</span></span><br><span class="line">  <span class="attr">playTranslateVoice</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> componentId = e.currentTarget.dataset.id;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">currentsound</span>: wx.getStorageSync(<span class="string">&#x27;currentsound&#x27;</span>) || <span class="string">&#x27;en_US&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> lto = <span class="built_in">this</span>.data.currentsound</span><br><span class="line">    <span class="keyword">let</span> content = (componentId === <span class="string">&#x27;src&#x27;</span>) ? <span class="built_in">this</span>.data.result[<span class="number">0</span>].src : <span class="built_in">this</span>.data.result[<span class="number">0</span>].dst</span><br><span class="line">    plugin.textToSpeech(&#123;</span><br><span class="line">      <span class="attr">lang</span>: lto,</span><br><span class="line">      <span class="attr">content</span>: content,</span><br><span class="line">      <span class="attr">success</span>: <span class="function"><span class="params">resTrans</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resTrans.retcode == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="attr">currentTranslateVoice</span>: resTrans.filename,</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">let</span> play_path = <span class="built_in">this</span>.data.currentTranslateVoice</span><br><span class="line">          <span class="keyword">if</span> (!play_path) &#123;</span><br><span class="line">            <span class="built_in">console</span>.warn(<span class="string">&quot;no translate voice path&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">let</span> audio = wx.createInnerAudioContext()</span><br><span class="line">          audio.src = play_path <span class="comment">// 设置音频的源</span></span><br><span class="line">          audio.play() <span class="comment">// 播放音频</span></span><br><span class="line">          audio.onError(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res.errMsg)</span><br><span class="line">            <span class="built_in">console</span>.log(res.errCode)</span><br><span class="line">          &#125;)</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.warn(<span class="string">&quot;语音合成失败&quot;</span>, resTrans)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span> (<span class="params">resTrans</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&quot;语音合成失败&quot;</span>, resTrans)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 跳转到历史记录页面的函数</span></span><br><span class="line">  <span class="attr">onTapItem</span>: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    wx.reLaunch(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/pages/history/history`</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="index.json">2 index.json</h5>
<p>缺省代码。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="index.wxml">3 index.wxml</h5>
<p>这段代码是微信小程序的WXML模板，用于构建用户界面。主要包括以下部分：</p>
<ol type="1">
<li><strong>container</strong>：这是页面的主容器。</li>
<li><strong>background</strong>：包含logo和背景图片。</li>
<li><strong>change</strong>：这部分包含语言切换部分，用户可以在这里选择翻译的源语言和目标语言。</li>
<li><strong>input-area</strong>：这是用户输入要翻译的文本的地方。输入区域包含一个文本框和一个语音按钮，用户可以通过输入或语音输入文本。</li>
<li><strong>output-area</strong>：这是显示翻译结果的地方。输出区域包含一个文本结果区域和一个语音按钮，用户可以听到翻译的结果。</li>
<li><strong>trans_history_area</strong>：这部分显示用户的翻译历史。用户可以看到他们过去翻译的文本和结果。</li>
</ol>
<p>这是该代码的框架图：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">  A[&quot;container&quot;]</span><br><span class="line">  A --&gt; B1[&quot;background&quot;]</span><br><span class="line">  B1 --&gt; C1[&quot;logo&quot;]</span><br><span class="line">  B1 --&gt; C2[&quot;background image&quot;]</span><br><span class="line">  A --&gt; B2[&quot;change&quot;]</span><br><span class="line">  B2 --&gt; C3[&quot;switch_language_from&quot;]</span><br><span class="line">  B2 --&gt; C4[&quot;switch&quot;]</span><br><span class="line">  B2 --&gt; C5[&quot;switch_language_to&quot;]</span><br><span class="line">  A --&gt; B3[&quot;input-area&quot;]</span><br><span class="line">  B3 --&gt; C6[&quot;textarea-wrap&quot;]</span><br><span class="line">  C6 --&gt; D1[&quot;textarea&quot;]</span><br><span class="line">  C6 --&gt; D2[&quot;language_from&quot;]</span><br><span class="line">  D2 --&gt; E1[&quot;voice&quot;]</span><br><span class="line">  D2 --&gt; E2[&quot;copy&quot;]</span><br><span class="line">  B3 --&gt; C7[&quot;output-area&quot;]</span><br><span class="line">  C7 --&gt; D3[&quot;result&quot;]</span><br><span class="line">  D3 --&gt; E3[&quot;text-result&quot;]</span><br><span class="line">  C7 --&gt; D4[&quot;language_to&quot;]</span><br><span class="line">  D4 --&gt; E4[&quot;voice&quot;]</span><br><span class="line">  D4 --&gt; E5[&quot;copy&quot;]</span><br><span class="line">  A --&gt; B4[&quot;trans_history_area&quot;]</span><br><span class="line">  B4 --&gt; C8[&quot;trans_history_title&quot;]</span><br><span class="line">  B4 --&gt; C9[&quot;trans_history_list&quot;]</span><br><span class="line">  C9 --&gt; D5[&quot;item&quot;]</span><br><span class="line">  D5 --&gt; E6[&quot;query&quot;]</span><br><span class="line">  D5 --&gt; E7[&quot;result&quot;]</span><br><span class="line">  linkStyle 0 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 1 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 2 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 3 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 4 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 5 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 6 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 7 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 8 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 9 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 10 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 11 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 12 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 13 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 14 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 15 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 16 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 17 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 18 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 19 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 20 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 21 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 22 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 23 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line">  linkStyle 24 stroke:#2ecd71,stroke-width:2px;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--index.wxml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 背景图片和logo --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;background&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/logo.png&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;background&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/background.png&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 语言切换部分 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;change&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;/pages/choose_language/choose_language&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;navigator-hover&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;switch_language_from&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;switch_language_pic&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;fromLang.src&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;switch_language_from_text&quot;</span> <span class="attr">decode</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>&#123;&#123;from.chs&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-down&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;switch&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/switch.png&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;switch_language_to&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;switch_language_pic&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;curLang.src&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;switch_language_to_text&quot;</span> <span class="attr">decode</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>&#123;&#123;curLang.chs&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-down&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 输入区域 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;input-area&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;textarea-wrap&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入要翻译的文本&#x27;</span> <span class="attr">placeholder-style</span>=<span class="string">&#x27; color: #1e3163;line-height: 34rpx;font-size: 36rpx;font-family: Poppins;&#x27;</span> <span class="attr">bindinput</span>=<span class="string">&#x27;onInput&#x27;</span> <span class="attr">bindconfirm</span>=<span class="string">&#x27;onConfirm&#x27;</span> <span class="attr">bindblur</span>=<span class="string">&#x27;onConfirm&#x27;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;query&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;language_from&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;language_pic&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;fromLang.src&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;language_from_text&quot;</span>&gt;</span>&#123;&#123;from.chs&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">data-id</span>=<span class="string">&quot;src&quot;</span> <span class="attr">catchtap</span>=<span class="string">&quot;playTranslateVoice&quot;</span> <span class="attr">catchtouchstart</span>=<span class="string">&quot;playTranslateVoice&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;voice&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/voice.png&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;copy&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;copyTextIN&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/copy.png&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 输出区域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;output-area&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;result&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;text-result&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;result&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">text</span> <span class="attr">selectable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">decode</span>=<span class="string">&quot;true&quot;</span>&gt;</span>&#123;&#123;item.dst&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;language_to&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;language_pic&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;curLang.src&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;language_to_text&quot;</span>&gt;</span>&#123;&#123;curLang.chs&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">data-id</span>=<span class="string">&quot;tar&quot;</span> <span class="attr">catchtap</span>=<span class="string">&quot;playTranslateVoice&quot;</span> <span class="attr">catchtouchstart</span>=<span class="string">&quot;playTranslateVoice&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;voice&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/voice_white.png&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;copy&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;copyTextOUT&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/copy_white.png&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 翻译历史模块 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;trans_history_area&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;trans_history_title&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;trans_history_title_chi&quot;</span>&gt;</span>翻译历史<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;trans_history_title_eng&quot;</span>&gt;</span>Translation History<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;trans_history_list&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;history&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;index&quot;</span> <span class="attr">bindtap</span>=<span class="string">&#x27;onTapItem&#x27;</span> <span class="attr">data-query</span>=<span class="string">&quot;&#123;&#123;item.query&#125;&#125;&quot;</span> <span class="attr">data-langId</span>=<span class="string">&quot;&#123;&#123;item.langIndex&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;query&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;language&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/Chinese.png&quot;</span> /&gt;</span></span><br><span class="line">              中文</span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            &#123;&#123;item.query&#125;&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;result&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;language&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/English.png&quot;</span> /&gt;</span></span><br><span class="line">              英语</span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            &#123;&#123;item.result&#125;&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="index.wxss">4 index.wxss</h5>
<p>这段代码是微信小程序的WXSS样式表，用于设置页面的样式。主要包括以下部分：</p>
<ol type="1">
<li><strong>container</strong>：设置页面的主容器的位置、大小和背景颜色。</li>
<li><strong>logo和background</strong>：设置logo和背景图片的位置、大小和显示方式。</li>
<li><strong>change</strong>：设置语言切换部分的样式，包括颜色、字体大小、内外边距、显示方式、对齐方式等。</li>
<li><strong>input-area和textarea-wrap</strong>：设置用户输入要翻译的文本的区域的样式，包括位置、背景颜色、边距、边框、阴影等。</li>
<li><strong>output-area</strong>：设置显示翻译结果的区域的样式，包括显示方式、最小高度、边距、边框、背景颜色、阴影等。</li>
<li><strong>trans_history_area</strong>：设置显示用户的翻译历史的区域的样式，包括边距、标题的样式、列表项的样式等。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="comment">/* height: 100%; */</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500</span>rpx;</span><br><span class="line">  <span class="comment">/* background: linear-gradient(to bottom, #1493FC 40%, #FFFFFF 60%); */</span></span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#1493FC</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-class">.logo</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">387</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">211</span>rpx;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-class">.background</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">312</span>rpx;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">288</span>rpx;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">60</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.change</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#8995a1</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">24</span> rpx;</span><br><span class="line">  <span class="comment">/* padding: 20rpx 40rpx; */</span></span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">30</span>rpx <span class="number">50</span>rpx <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">220</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">32</span>rpx <span class="number">18</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#1265dd</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.change</span> <span class="selector-class">.icon-right</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#888</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.change</span> <span class="selector-class">.icon-down</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#8995a1</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.change</span> <span class="selector-class">.switch_language_from</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">6</span>rpx;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">265</span>rpx;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.change</span> <span class="selector-class">.switch</span> &#123;</span><br><span class="line">  <span class="comment">/* display: flex; */</span></span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-start;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">72</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">72</span>rpx;</span><br><span class="line">  <span class="attribute">margin</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.change</span> <span class="selector-class">.switch_language_to</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">265</span>rpx;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">vertical-align</span>: text-bottom;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.input-area</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.textarea-wrap</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">50</span>rpx;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#c7cee0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16</span>rpx;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">2</span>rpx <span class="number">#000000</span>0a, <span class="number">0px</span> <span class="number">0px</span> <span class="number">4</span>rpx <span class="number">#000000</span>0f, <span class="number">0px</span> <span class="number">8</span>rpx <span class="number">16</span>rpx <span class="number">#000000</span>0a;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">300</span>rpx;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">6.13%</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">6.67%</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">53.72%</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0.55%</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1e3163</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">34</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">36</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.language_from</span> &#123;</span><br><span class="line">  <span class="attribute">bottom</span>: auto;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#a8abb0</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">22</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.language_pic</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">vertical-align</span>: text-bottom;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.language_from_text</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#a8abb0</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">22</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.input-area</span> <span class="selector-tag">textarea</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">30</span>rpx <span class="number">0</span> <span class="number">30</span>rpx <span class="number">10</span>rpx;</span><br><span class="line">  <span class="comment">/* width: calc(100% - 48rpx); */</span></span><br><span class="line">  <span class="attribute">width</span>: auto;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">210</span>rpx;</span><br><span class="line">  <span class="attribute">border-bottom</span>: solid <span class="number">2</span>rpx <span class="number">#e7e7e7</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.input-area</span> <span class="selector-class">.icon-close</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">12</span>rpx;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">100</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#888</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.voice</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">vertical-align</span>: text-bottom;</span><br><span class="line">  <span class="attribute">text-align</span>: end;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">150</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.copy</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">45</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">50</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50</span>rpx;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.play-icon</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">3</span>rpx;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">7</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">8</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.edit-icon</span><span class="selector-pseudo">::before</span> <span class="selector-class">.play-icon</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolete;</span><br><span class="line">  <span class="attribute">top</span>: -<span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">left</span>: -<span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">bottom</span>: -<span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">right</span>: -<span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.input-area</span> <span class="selector-class">.output-area</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">150</span>rpx;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">50</span>rpx;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#c7cee0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#1493FC</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16</span>rpx;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">2</span>rpx <span class="number">#000000</span>0a, <span class="number">0px</span> <span class="number">0px</span> <span class="number">4</span>rpx <span class="number">#000000</span>0f, <span class="number">0px</span> <span class="number">8</span>rpx <span class="number">16</span>rpx <span class="number">#000000</span>0a;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">300</span>rpx;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">384px</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">262px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.output-area</span> <span class="selector-class">.text-result</span> &#123;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">150</span>rpx;</span><br><span class="line">  <span class="comment">/* margin-top: 20rpx; */</span></span><br><span class="line">  <span class="comment">/* padding: 20rpx 0; */</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">150</span>rpx;</span><br><span class="line">  <span class="comment">/* border-bottom: solid 2rpx #e7e7e7; */</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">36</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">33</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.output-area</span> <span class="selector-class">.result</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="comment">/* 这里的值可以根据你的需求来调整 */</span></span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">150</span>rpx;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">150</span>rpx;</span><br><span class="line">  <span class="attribute">border-bottom</span>: solid <span class="number">2</span>rpx <span class="number">#e7e7e7</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">36</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">33</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.language_to</span> &#123;</span><br><span class="line">  <span class="comment">/* bottom: auto; */</span></span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#a8abb0</span>;</span><br><span class="line">  <span class="comment">/* margin-top: 10rpx; */</span></span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">22</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.language_to_text</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">22</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.trans_history_area</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">55</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.trans_history_area</span> <span class="selector-class">.trans_history_title</span> &#123;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.trans_history_area</span> <span class="selector-class">.trans_history_title</span> <span class="selector-class">.trans_history_title_chi</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: transparent;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(<span class="number">180deg</span>, <span class="number">#0064e1</span> <span class="number">0%</span>, <span class="number">#0845c2</span> <span class="number">100%</span>);</span><br><span class="line">  -webkit-<span class="attribute">background-clip</span>: text;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.trans_history_area</span> <span class="selector-class">.trans_history_title</span> <span class="selector-class">.trans_history_title_eng</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#949494</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">24</span>rpx;</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">22</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16</span>rpx;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">2</span>rpx <span class="number">#000000</span>0a, <span class="number">0px</span> <span class="number">0px</span> <span class="number">4</span>rpx <span class="number">#000000</span>0f, <span class="number">0px</span> <span class="number">8</span>rpx <span class="number">16</span>rpx <span class="number">#000000</span>0a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-class">.query</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">border-bottom</span>: solid <span class="number">2</span>rpx <span class="number">#e7e7e7</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">50</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1e3163</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-class">.query</span> <span class="selector-class">.language</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#a8abb0</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-class">.result</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">16</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">50</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1e3163</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-class">.result</span> <span class="selector-class">.language</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#909dbd</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">vertical-align</span>: bottom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="pagesocr">4.1.4.6 pages/OCR</h4>
<h5 id="ocr.js">1 OCR.js</h5>
<p>这段代码的主要功能是：</p>
<ol type="1">
<li>上传图片：用户可以通过点击按钮上传图片，然后跳转到另一个页面进行图片的选择和处理。</li>
<li>获取OCR：通过调用API，将上传的图片进行OCR识别，提取出图片中的文字，并将识别结果进行翻译。</li>
<li>返回按钮：用户可以通过点击返回按钮返回到上一个页面。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入翻译工具</span></span><br><span class="line"><span class="keyword">import</span> &#123; translate &#125; <span class="keyword">from</span> <span class="string">&#x27;../../utils/api.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取全局应用程序实例对象</span></span><br><span class="line"><span class="keyword">const</span> app = getApp();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义页面</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">src</span>: <span class="string">&quot;&quot;</span>,  <span class="comment">// 图片源</span></span><br><span class="line">    <span class="attr">sourceText</span>: [],  <span class="comment">// 原始文本</span></span><br><span class="line">    <span class="attr">resultText</span>: <span class="string">&#x27;&#x27;</span>,  <span class="comment">// 翻译结果</span></span><br><span class="line">    <span class="attr">imgList</span>: [],  <span class="comment">// 图片列表</span></span><br><span class="line">    <span class="attr">filePath</span>: <span class="string">&#x27;&#x27;</span>,  <span class="comment">// 文件路径</span></span><br><span class="line">    <span class="attr">picBase64</span>: <span class="string">&#x27;&#x27;</span>,  <span class="comment">// 图片的base64编码</span></span><br><span class="line">    <span class="attr">textSrc</span>: <span class="string">&#x27;&#x27;</span>,  <span class="comment">// 原文本</span></span><br><span class="line">    <span class="attr">textDst</span>: <span class="string">&#x27;&#x27;</span>  <span class="comment">// 目标文本</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 页面显示时的回调函数</span></span><br><span class="line">  <span class="attr">onShow</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 如果全局变量中的图片base64编码不为空</span></span><br><span class="line">    <span class="keyword">if</span> (app.globalData.picBase64 != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// 更新数据</span></span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">src</span>: app.globalData.picBase64,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上传图片的函数</span></span><br><span class="line">  <span class="attr">uploadImg</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 导航到获取图片的页面</span></span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;../getPic/getPic&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取OCR的函数</span></span><br><span class="line">  <span class="attr">getOCR</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 提取图片里的文字</span></span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">    wx.request(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;https://api.jisuapi.com/generalrecognition/recognize?appkey=993bfd80d8ac15c6&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">pic</span>: <span class="built_in">this</span>.data.src,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;cnen&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">header</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span> <span class="comment">// 默认值</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res);</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          <span class="attr">sourceText</span>: res.data.result</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">let</span> str = that.data.sourceText.join()</span><br><span class="line">        <span class="built_in">console</span>.log(str)</span><br><span class="line">        translate(str, &#123;</span><br><span class="line">          <span class="attr">from</span>: <span class="string">&#x27;zh&#x27;</span>,</span><br><span class="line">          <span class="attr">to</span>: <span class="string">&#x27;en&#x27;</span></span><br><span class="line">        &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(res)</span><br><span class="line">          that.setData(&#123;</span><br><span class="line">            <span class="attr">resultText</span>: res.trans_result[<span class="number">0</span>].dst</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回按钮的点击事件处理函数</span></span><br><span class="line">  <span class="attr">onBackIconTap</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 导航回上一页</span></span><br><span class="line">    wx.navigateBack(&#123;</span><br><span class="line">      <span class="attr">delta</span>: <span class="number">1</span>, <span class="comment">// 返回的页面层数</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="ocr.json">2 OCR.json</h5>
<p>缺省代码。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;usingComponents&quot;</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ocr.wxml">3 OCR.wxml</h5>
<p>这段代码的主要功能是：</p>
<ol type="1">
<li>显示一个返回按钮，用户可以通过点击返回按钮返回到上一个页面。</li>
<li>显示一个图片，图片的源数据是base64编码的。</li>
<li>提供一个按钮，用户可以通过点击按钮触发OCR识别和翻译的功能。</li>
<li>显示OCR识别和翻译的结果，包括源语言（中文）的文本和目标语言（英语）的文本。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 头部视图 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;head&quot;</span>&gt;</span> </span><br><span class="line">  <span class="comment">&lt;!-- 返回图标视图，点击时触发onBackIconTap事件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">id</span>=<span class="string">&quot;back-icon&quot;</span> <span class="attr">class</span>=<span class="string">&quot;back-icon&quot;</span>  <span class="attr">bindtap</span>=<span class="string">&quot;onBackIconTap&quot;</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 返回箭头图标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/arrow-left.png&quot;</span> <span class="attr">class</span>=<span class="string">&quot;arrow-icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 容器视图 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 图片视图，图片源为base64编码的数据，宽度为100%，高度为1000rpx --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;data:image/png;base64,&#123;&#123;src&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:100%;height:1000rpx&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- 翻译图片按钮，点击时触发getOCR事件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">bindtap</span>=<span class="string">&quot;getOCR&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span></span><br><span class="line">    翻译图片</span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- 项目视图 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 查询视图 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;query&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 语言视图，包含一个图标和文本“中文” --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;language&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/Chinese.png&quot;</span> /&gt;</span></span><br><span class="line">        中文</span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 显示源文本 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;sourceText&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 结果视图 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;result&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 语言视图，包含一个图标和文本“英语” --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;language&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../../imgs/English.png&quot;</span> /&gt;</span></span><br><span class="line">        英语</span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 显示翻译结果文本 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;resultText&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="ocr.wxss">4 OCR.wxss</h5>
<p>这段代码定义了一些样式规则，用于美化小程序中的各个元素的外观和布局。</p>
<p>其中包括头部视图、返回图标、箭头图标、按钮、项目视图、查询视图、查询语言、结果视图、结果语言和图片的样式。</p>
<p>通过设置不同的样式属性，如位置、大小、颜色等，可以使页面元素呈现出不同的效果，增强用户体验。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 容器样式 */</span></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="comment">/* 居中对齐 */</span></span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 头部样式 */</span></span><br><span class="line"><span class="selector-class">.head</span> &#123;</span><br><span class="line">  <span class="comment">/* 相对定位 */</span></span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="comment">/* 顶部和左侧边距为0，宽度为100%，高度为200rpx */</span></span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200</span>rpx;</span><br><span class="line">  <span class="comment">/* 背景颜色为#1493FC */</span></span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#1493FC</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 返回图标样式 */</span></span><br><span class="line"><span class="selector-class">.back-icon</span> &#123;</span><br><span class="line">  <span class="comment">/* 绝对定位，位于头部视图的左上角 */</span></span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="comment">/* z-index用于控制元素的层叠顺序 */</span></span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="comment">/* 背景颜色为#1493FC */</span></span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#1493fc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 箭头图标样式 */</span></span><br><span class="line"><span class="selector-class">.arrow-icon</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 按钮样式 */</span></span><br><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">  <span class="comment">/* 背景颜色为#1493FC */</span></span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#1493fc</span>;</span><br><span class="line">  <span class="comment">/* 上下内边距为15rpx，左右内边距为20rpx */</span></span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">15</span>rpx <span class="number">20</span>rpx;</span><br><span class="line">  <span class="comment">/* 文本颜色为白色 */</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="comment">/* 圆角半径为20rpx */</span></span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="comment">/* 外边距为40rpx */</span></span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">40</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 项目样式 */</span></span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="comment">/* 上外边距为40rpx，左右内边距为10rpx */</span></span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10</span>rpx;</span><br><span class="line">  <span class="comment">/* 背景颜色为白色 */</span></span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="comment">/* 圆角半径为16rpx */</span></span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16</span>rpx;</span><br><span class="line">  <span class="comment">/* 阴影效果 */</span></span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">2</span>rpx <span class="number">#000000</span>0a, <span class="number">0px</span> <span class="number">0px</span> <span class="number">4</span>rpx <span class="number">#000000</span>0f, <span class="number">0px</span> <span class="number">8</span>rpx <span class="number">16</span>rpx <span class="number">#000000</span>0a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 查询样式 */</span></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-class">.query</span> &#123;</span><br><span class="line">  <span class="comment">/* 内边距为20rpx */</span></span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="comment">/* 底部边框为实线，宽度为2rpx，颜色为#e7e7e7 */</span></span><br><span class="line">  <span class="attribute">border-bottom</span>: solid <span class="number">2</span>rpx <span class="number">#e7e7e7</span>;</span><br><span class="line">  <span class="comment">/* 字体大小为32rpx */</span></span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="comment">/* 字体家族为Poppins */</span></span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="comment">/* 行高为50rpx */</span></span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">50</span>rpx;</span><br><span class="line">  <span class="comment">/* 字体颜色为#1e3163 */</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1e3163</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 查询语言样式 */</span></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-class">.query</span> <span class="selector-class">.language</span> &#123;</span><br><span class="line">  <span class="comment">/* 字体大小为28rpx */</span></span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28</span>rpx;</span><br><span class="line">  <span class="comment">/* 字体家族为Poppins */</span></span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="comment">/* 行高为26rpx */</span></span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="comment">/* 字体颜色为#a8abb0 */</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#a8abb0</span>;</span><br><span class="line">  <span class="comment">/* 上外边距为10rpx，下外边距为10rpx */</span></span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 结果样式 */</span></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-class">.result</span> &#123;</span><br><span class="line">  <span class="comment">/* 上外边距为16rpx */</span></span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">16</span>rpx;</span><br><span class="line">  <span class="comment">/* 内边距为20rpx */</span></span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="comment">/* 字体大小为32rpx */</span></span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="comment">/* 字体家族为Poppins */</span></span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="comment">/* 行高为50rpx */</span></span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">50</span>rpx;</span><br><span class="line">  <span class="comment">/* 字体颜色为#1e3163 */</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1e3163</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 结果语言样式 */</span></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-class">.result</span> <span class="selector-class">.language</span> &#123;</span><br><span class="line">  <span class="comment">/* 字体大小为28rpx */</span></span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28</span>rpx;</span><br><span class="line">  <span class="comment">/* 字体家族为Poppins */</span></span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="comment">/* 行高为26rpx */</span></span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="comment">/* 字体颜色为#909dbd */</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#909dbd</span>;</span><br><span class="line">  <span class="comment">/* 下外边距为10rpx */</span></span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 图片样式 */</span></span><br><span class="line">image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="comment">/* 垂直对齐方式为底部对齐 */</span></span><br><span class="line">  <span class="attribute">vertical-align</span>: bottom;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="pagesvoice_translation">4.1.4.7 pages/voice_translation</h4>
<p>语音翻译页面，主要功能是通过微信的语音插件实现语音的录制、识别和翻译。</p>
<p>以下代码的主要功能：</p>
<ol type="1">
<li>语音录制：用户按下按钮时，开始进行语音录制，录制过程中会实时显示识别结果。当用户松开按钮时，结束录制，并进行语音识别。</li>
<li>语音识别：语音识别的结果会添加到对话列表中，显示在页面上。如果识别结果为空，则会显示提示信息。</li>
<li>语音翻译：识别后的文字会被发送到插件进行翻译，翻译的结果会被更新到对话列表中的相应位置。</li>
<li>语音播放：当翻译完成后，页面会自动播放翻译后的语音。如果语音文件过期，会重新进行语音合成。</li>
<li>语言切换：用户可以点击按钮切换输入语言，支持中英文切换。</li>
<li>历史记录：用户的历史录音和翻译记录会被保存，在用户再次进入页面时可以查看。</li>
<li>滚动显示：当识别或翻译的内容添加到对话列表时，页面会自动滚动到最新的内容。</li>
</ol>
<h5 id="voice_translation.js">1 voice_translation.js</h5>
<p>页面数据的配置 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取应用实例</span></span><br><span class="line"><span class="keyword">const</span> app = getApp()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入工具库</span></span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;../../utils/util.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入微信语音插件</span></span><br><span class="line"><span class="keyword">const</span> plugin = requirePlugin(<span class="string">&quot;WechatSI&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入语言配置文件</span></span><br><span class="line"><span class="keyword">import</span> &#123; language &#125; <span class="keyword">from</span> <span class="string">&#x27;../../utils/conf.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取全局唯一的语音识别管理器</span></span><br><span class="line"><span class="keyword">const</span> manager = plugin.getRecordRecognitionManager()</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">  <span class="comment">// 页面的初始数据</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">dialogList</span>: [],  <span class="comment">// 对话列表，初始为空</span></span><br><span class="line">    <span class="attr">lan_type</span>: <span class="literal">true</span>,  <span class="comment">// 语言类型</span></span><br><span class="line">    <span class="attr">scroll_top</span>: <span class="number">10000</span>,  <span class="comment">// 竖向滚动条位置</span></span><br><span class="line">    <span class="attr">bottomButtonDisabled</span>: <span class="literal">false</span>,  <span class="comment">// 底部按钮是否禁用</span></span><br><span class="line">    <span class="attr">tips_language</span>: language[<span class="number">0</span>],  <span class="comment">// 提示语言，初始为中文</span></span><br><span class="line">    <span class="comment">// 初始时的翻译卡片</span></span><br><span class="line">    <span class="attr">initTranslate</span>: &#123;</span><br><span class="line">      <span class="attr">create</span>: <span class="string">&#x27;04/27 15:37&#x27;</span>,</span><br><span class="line">      <span class="attr">text</span>: <span class="string">&#x27;等待说话&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 当前的翻译卡片</span></span><br><span class="line">    <span class="attr">currentTranslate</span>: &#123;</span><br><span class="line">      <span class="attr">create</span>: <span class="string">&#x27;04/27 15:37&#x27;</span>,</span><br><span class="line">      <span class="attr">text</span>: <span class="string">&#x27;等待说话&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">recording</span>: <span class="literal">false</span>,  <span class="comment">// 是否正在录音</span></span><br><span class="line">    <span class="attr">recordStatus</span>: <span class="number">0</span>,   <span class="comment">// 录音状态： 0 - 录音中 1- 翻译中 2 - 翻译完成/二次翻译</span></span><br><span class="line">    <span class="attr">toView</span>: <span class="string">&#x27;fake&#x27;</span>,  <span class="comment">// 滚动位置</span></span><br><span class="line">    <span class="attr">lastId</span>: -<span class="number">1</span>,    <span class="comment">// dialogList 最后一个item的 id</span></span><br><span class="line">    <span class="attr">currentTranslateVoice</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 当前播放语音路径</span></span><br><span class="line">    <span class="comment">// 图片路径</span></span><br><span class="line">    <span class="attr">image_c</span>:<span class="string">&#x27;https://codefun-proj-user-res-1256085488.cos.ap-guangzhou.myqcloud.com/644bb0005a7e3f03102917b5/644bb06fb98f5d0011665f39/153cd789341a2b9a6a2d1ac163978ba0.png&#x27;</span>,</span><br><span class="line">    <span class="attr">image_e</span>:<span class="string">&#x27;https://codefun-proj-user-res-1256085488.cos.ap-guangzhou.myqcloud.com/644bb0005a7e3f03102917b5/644bb06fb98f5d0011665f39/e9fc70c625980d75443bf2ae1516d24f.png&#x27;</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
录音按钮函数streamRecord，streamRecordEnd，当用户松开按钮后，结束语音识别。函数首先检查是否已经在录音，如果没有，或者已经在录音但录音状态不为0（这可能意味着录音已经被停止），则返回。否则，它会停止录音，并禁用底部按钮以防止重复停止。</p>
<pre><code>    接着是一个函数changelanguage，该函数用于切换语音识别的语言。它首先切换lan_type的值（这可能是一个布尔值，表示使用的是哪种语言）。然后，根据新的lan_type的值，设置适当的初始化翻译文本。</code></pre>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按住按钮开始语音识别</span></span><br><span class="line"><span class="attr">streamRecord</span>: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 开始语音识别</span></span><br><span class="line">  manager.start(&#123;</span><br><span class="line">    <span class="attr">lang</span>: e.detail.buttonItem.lang,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据语言类型设置翻译卡片内容</span></span><br><span class="line">  <span class="keyword">let</span> lan_type = <span class="built_in">this</span>.data.lan_type</span><br><span class="line">  <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">    <span class="attr">recordStatus</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">recording</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">currentTranslate</span>: &#123;</span><br><span class="line">      <span class="attr">create</span>: util.recordTime(<span class="keyword">new</span> <span class="built_in">Date</span>()),</span><br><span class="line">      <span class="attr">text</span>:  lan_type ?<span class="string">&#x27;正在聆听中&#x27;</span>:<span class="string">&#x27;listening&#x27;</span>,</span><br><span class="line">      <span class="attr">lfrom</span>: lan_type ? e.detail.buttonItem.lang : e.detail.buttonItem.lto,</span><br><span class="line">      <span class="attr">lto</span>: lan_type ? e.detail.buttonItem.lto : e.detail.buttonItem.lang,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">     <span class="built_in">this</span>.scrollToNew();</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 松开按钮结束语音识别</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">streamRecordEnd</span>: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> detail = e.detail || &#123;&#125;  <span class="comment">// 自定义组件触发事件时提供的detail对象</span></span><br><span class="line">  <span class="keyword">let</span> buttonItem = detail.buttonItem || &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 防止重复触发stop函数</span></span><br><span class="line">  <span class="keyword">if</span>(!<span class="built_in">this</span>.data.recording || <span class="built_in">this</span>.data.recordStatus != <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.warn(<span class="string">&quot;has finished!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 停止录音识别</span></span><br><span class="line">  manager.stop()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 禁用底部按钮</span></span><br><span class="line">  <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">    <span class="attr">bottomButtonDisabled</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 切换语言</span></span><br><span class="line"><span class="attr">changelanguage</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">    <span class="attr">lan_type</span>:!<span class="built_in">this</span>.data.lan_type,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">this</span>.data.lan_type) &#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">initTranslate</span>: &#123;</span><br><span class="line">        <span class="attr">create</span>: util.recordTime(<span class="keyword">new</span> <span class="built_in">Date</span>()),</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;等待说话&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">initTranslate</span>: &#123;</span><br><span class="line">        <span class="attr">create</span>: util.recordTime(<span class="keyword">new</span> <span class="built_in">Date</span>()),</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;Please Speaking&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<pre><code>    以下代码定义了函数 translateText ，该函数用于翻译文本。它接受两个参数：一个是要翻译的文本项，另一个是该项在对话列表中的索引。
    这个函数首先确定源语言和目标语言，默认为从中文到英文。然后，它调用翻译插件，传入要翻译的文本，并启用文本到语音功能。
    如果翻译失败， fail 回调函数会被调用，并记录一个错误。无论成功或失败， complete 回调函数都会被调用，用来更新录音状态，并隐藏加载提示。</code></pre>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 翻译</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">translateText</span>: <span class="function"><span class="keyword">function</span>(<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> lfrom =  item.lfrom || <span class="string">&#x27;zh_CN&#x27;</span>  <span class="comment">// 原语言，默认为中文</span></span><br><span class="line">  <span class="keyword">let</span> lto = item.lto || <span class="string">&#x27;en_US&#x27;</span>  <span class="comment">// 目标语言，默认为英文</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 调用翻译插件</span></span><br><span class="line">  plugin.translate(&#123;</span><br><span class="line">    <span class="attr">lfrom</span>: lfrom,</span><br><span class="line">    <span class="attr">lto</span>: lto,</span><br><span class="line">    <span class="attr">content</span>: item.text,  <span class="comment">// 要翻译的文本</span></span><br><span class="line">    <span class="attr">tts</span>: <span class="literal">true</span>,  <span class="comment">// 启用文本到语音</span></span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">resTrans</span>)=&gt;</span>&#123;  <span class="comment">// 翻译成功的回调函数</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> passRetcode = [</span><br><span class="line">        <span class="number">0</span>,  <span class="comment">// 翻译合成成功</span></span><br><span class="line">        -<span class="number">10006</span>,  <span class="comment">// 翻译成功，合成失败</span></span><br><span class="line">        -<span class="number">10007</span>,  <span class="comment">// 翻译成功，传入了不支持的语音合成语言</span></span><br><span class="line">        -<span class="number">10008</span>  <span class="comment">// 翻译成功，语音合成达到频率限制</span></span><br><span class="line">      ]</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果返回的结果是可接受的</span></span><br><span class="line">      <span class="keyword">if</span>(passRetcode.indexOf(resTrans.retcode) &gt;= <span class="number">0</span> ) &#123;</span><br><span class="line">        <span class="keyword">let</span> tmpDialogList = <span class="built_in">this</span>.data.dialogList.slice(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果索引有效</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">isNaN</span>(index)) &#123;</span><br><span class="line">          <span class="comment">// 更新当前条目的翻译结果</span></span><br><span class="line">          <span class="keyword">let</span> tmpTranslate = <span class="built_in">Object</span>.assign(&#123;&#125;, item, &#123;</span><br><span class="line">            <span class="attr">autoPlay</span>: <span class="literal">true</span>,  <span class="comment">// 自动播放背景音乐</span></span><br><span class="line">            <span class="attr">translateText</span>: resTrans.result,  <span class="comment">// 翻译结果</span></span><br><span class="line">            <span class="attr">translateVoicePath</span>: resTrans.filename || <span class="string">&quot;&quot;</span>,  <span class="comment">// 语音文件路径</span></span><br><span class="line">            <span class="attr">translateVoiceExpiredTime</span>: resTrans.expired_time || <span class="number">0</span>  <span class="comment">// 语音文件过期时间</span></span><br><span class="line">          &#125;)</span><br><span class="line"></span><br><span class="line">          tmpDialogList[index] = tmpTranslate</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 更新对话列表和底部按钮状态</span></span><br><span class="line">          <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="attr">dialogList</span>: tmpDialogList,</span><br><span class="line">            <span class="attr">bottomButtonDisabled</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">recording</span>: <span class="literal">false</span>,</span><br><span class="line">          &#125;)</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 滚动到新的位置</span></span><br><span class="line">          <span class="built_in">this</span>.scrollToNew();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.error(<span class="string">&quot;index error&quot;</span>, resTrans, item)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&quot;翻译失败&quot;</span>, resTrans, item)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span>(<span class="params">resTrans</span>) </span>&#123;  <span class="comment">// 翻译失败的回调函数</span></span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">&quot;调用失败&quot;</span>,resTrans, item)</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">bottomButtonDisabled</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">recording</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">complete</span>: <span class="function"><span class="params">resTrans</span> =&gt;</span> &#123;  <span class="comment">// 翻译完成的回调函数，无论成功或失败</span></span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">recordStatus</span>: <span class="number">1</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      wx.hideLoading()  <span class="comment">// 隐藏加载提示</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>    在下面的代码段中，定义了函数translateTextAction，这个函数会在修改文本信息后触发，它调用translateText函数进行翻译。
    定义了expiredAction函数，这个函数用于处理语音文件过期的情况，它会调用插件的文本到语音功能重新生成语音文件。</code></pre>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改文本信息后触发翻译操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">translateTextAction</span>: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取由自定义组件触发事件提供的detail对象</span></span><br><span class="line">  <span class="keyword">let</span> detail = e.detail</span><br><span class="line">  <span class="keyword">let</span> item = detail.item</span><br><span class="line">  <span class="keyword">let</span> index = detail.index</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 调用翻译函数</span></span><br><span class="line">  <span class="built_in">this</span>.translateText(item, index)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 语音文件过期，重新合成语音文件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">expiredAction</span>: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取由自定义组件触发事件提供的detail对象</span></span><br><span class="line">  <span class="keyword">let</span> detail = e.detail || &#123;&#125;</span><br><span class="line">  <span class="keyword">let</span> item = detail.item || &#123;&#125;</span><br><span class="line">  <span class="keyword">let</span> index = detail.index</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查索引是否有效</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">isNaN</span>(index) || index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设定目标语言，默认为英语</span></span><br><span class="line">  <span class="keyword">let</span> lto = item.lto || <span class="string">&#x27;en_US&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 调用插件的文本到语音功能</span></span><br><span class="line">  plugin.textToSpeech(&#123;</span><br><span class="line">    <span class="attr">lang</span>: lto,</span><br><span class="line">    <span class="attr">content</span>: item.translateText,</span><br><span class="line">    <span class="attr">success</span>: <span class="function"><span class="params">resTrans</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(resTrans.retcode == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> tmpDialogList = <span class="built_in">this</span>.data.dialogList.slice(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 用新的属性更新对应的条目</span></span><br><span class="line">        <span class="keyword">let</span> tmpTranslate = <span class="built_in">Object</span>.assign(&#123;&#125;, item, &#123;</span><br><span class="line">          <span class="attr">autoPlay</span>: <span class="literal">true</span>,  <span class="comment">// 自动播放背景音乐</span></span><br><span class="line">          <span class="attr">translateVoicePath</span>: resTrans.filename,  <span class="comment">// 语音文件路径</span></span><br><span class="line">          <span class="attr">translateVoiceExpiredTime</span>: resTrans.expired_time || <span class="number">0</span>  <span class="comment">// 语音文件过期时间</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        tmpDialogList[index] = tmpTranslate</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更新对话列表</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">          <span class="attr">dialogList</span>: tmpDialogList,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&quot;语音合成失败&quot;</span>, resTrans, item)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span>(<span class="params">resTrans</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.warn(<span class="string">&quot;语音合成失败&quot;</span>, resTrans, item)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<pre><code>    定义了initCard函数，这个函数用于初始化一张空白的卡片。
    然后定义了deleteItem函数，用于删除某一条目。
    当列表为空时，deleteItem函数将会调用initCard函数创建一张空白的卡片。</code></pre>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化为空时的卡片</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">initCard</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 创建新的初始化翻译对象，并添加当前时间</span></span><br><span class="line">  <span class="keyword">let</span> initTranslateNew = <span class="built_in">Object</span>.assign(&#123;&#125;, <span class="built_in">this</span>.data.initTranslate, &#123;</span><br><span class="line">    <span class="attr">create</span>: util.recordTime(<span class="keyword">new</span> <span class="built_in">Date</span>()),</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新数据</span></span><br><span class="line">  <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">    <span class="attr">initTranslate</span>: initTranslateNew</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除卡片</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">deleteItem</span>: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取由自定义组件触发事件提供的detail对象</span></span><br><span class="line">  <span class="keyword">let</span> detail = e.detail</span><br><span class="line">  <span class="keyword">let</span> item = detail.item</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建一个新的对话列表副本</span></span><br><span class="line">  <span class="keyword">let</span> tmpDialogList = <span class="built_in">this</span>.data.dialogList.slice(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">let</span> arrIndex = detail.index</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除对应索引的元素</span></span><br><span class="line">  tmpDialogList.splice(arrIndex, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用setTimeout来避免可能的错误：Expect END descriptor with depth 0 but get another</span></span><br><span class="line">  <span class="built_in">setTimeout</span>( <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">dialogList</span>: tmpDialogList</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 如果列表为空，则初始化卡片</span></span><br><span class="line">    <span class="keyword">if</span>(tmpDialogList.length == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.initCard()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 识别内容为空时的反馈</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">showRecordEmptyTip</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 更新数据</span></span><br><span class="line">  <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">    <span class="attr">recording</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">bottomButtonDisabled</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 显示提示</span></span><br><span class="line">  wx.showToast(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="built_in">this</span>.data.tips_language.recognize_nothing,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">    <span class="attr">image</span>: <span class="string">&#x27;/image/no_voice.png&#x27;</span>,</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化语音识别回调</span></span><br><span class="line"><span class="comment"> * 绑定语音播放开始事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">initRecord</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 有新的识别内容返回，则会调用此事件</span></span><br><span class="line">  manager.onRecognize = <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> currentData = <span class="built_in">Object</span>.assign(&#123;&#125;, <span class="built_in">this</span>.data.currentTranslate, &#123;</span><br><span class="line">                      <span class="attr">text</span>: res.result,</span><br><span class="line">                    &#125;)</span><br><span class="line">    <span class="comment">// 更新当前翻译内容</span></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">currentTranslate</span>: currentData,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 滚动到新的内容</span></span><br><span class="line">    <span class="built_in">this</span>.scrollToNew();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 识别结束事件</span></span><br><span class="line">  manager.onStop = <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> text = res.result</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果结果为空，显示提示信息</span></span><br><span class="line">    <span class="keyword">if</span>(text == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.showRecordEmptyTip()</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> lastId = <span class="built_in">this</span>.data.lastId + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> currentData = <span class="built_in">Object</span>.assign(&#123;&#125;, <span class="built_in">this</span>.data.currentTranslate, &#123;</span><br><span class="line">                      <span class="attr">text</span>: res.result,</span><br><span class="line">                      <span class="attr">translateText</span>: <span class="string">&#x27;正在翻译中&#x27;</span>,</span><br><span class="line">                      <span class="attr">id</span>: lastId,</span><br><span class="line">                      <span class="attr">voicePath</span>: res.tempFilePath</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新当前翻译和记录状态</span></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">currentTranslate</span>: currentData,</span><br><span class="line">      <span class="attr">recordStatus</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">lastId</span>: lastId,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 滚动到新的内容</span></span><br><span class="line">    <span class="built_in">this</span>.scrollToNew();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始翻译</span></span><br><span class="line">    <span class="built_in">this</span>.translateText(currentData, <span class="built_in">this</span>.data.dialogList.length)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 识别错误事件</span></span><br><span class="line">  manager.onError = <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 如果发生错误，停止录音并启用底部按钮</span></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">recording</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">bottomButtonDisabled</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 语音播放开始事件</span></span><br><span class="line">  wx.getBackgroundAudioManager (<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> backgroundAudioManager = wx.getBackgroundAudioManager()</span><br><span class="line">    <span class="keyword">let</span> src = backgroundAudioManager.src</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新当前播放的音频源</span></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">currentTranslateVoice</span>: src</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>    以下代码包含了对历史记录的获取和设置。</code></pre>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 设置语音识别历史记录</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">setHistory</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> dialogList = <span class="built_in">this</span>.data.dialogList</span><br><span class="line">      dialogList.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        item.autoPlay = <span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// 尝试将对话列表存储在本地</span></span><br><span class="line">      wx.setStorageSync(<span class="string">&#x27;history&#x27;</span>,dialogList)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">&quot;setStorageSync setHistory failed&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 得到历史记录</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">getHistory</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 尝试从本地获取历史记录</span></span><br><span class="line">      <span class="keyword">let</span> history = wx.getStorageSync(<span class="string">&#x27;history&#x27;</span>)</span><br><span class="line">      <span class="keyword">if</span> (history) &#123;</span><br><span class="line">          <span class="keyword">let</span> len = history.length;</span><br><span class="line">          <span class="keyword">let</span> lastId = <span class="built_in">this</span>.data.lastId</span><br><span class="line">          <span class="keyword">if</span>(len &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            lastId = history[len-<span class="number">1</span>].id || -<span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// 如果历史记录存在，将其设置到dialogList中</span></span><br><span class="line">          <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="attr">dialogList</span>: history,</span><br><span class="line">            <span class="attr">toView</span>: <span class="built_in">this</span>.data.toView,</span><br><span class="line">            <span class="attr">lastId</span>: lastId,</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="comment">// 如果出现错误，将dialogList设置为空列表</span></span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">dialogList</span>: []</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 重新滚动到底部</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">scrollToNew</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 更新视图到最新的位置</span></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">toView</span>: <span class="built_in">this</span>.data.toView</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">onShow</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 当页面显示时，滚动到最新的位置，并初始化卡片</span></span><br><span class="line">    <span class="built_in">this</span>.scrollToNew();</span><br><span class="line">    <span class="built_in">this</span>.initCard()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">this</span>.data.recordStatus == <span class="number">2</span>) &#123;</span><br><span class="line">      wx.showLoading(&#123;</span><br><span class="line">        <span class="comment">// title: &#x27;&#x27;,</span></span><br><span class="line">        <span class="attr">mask</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">onLoad</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 页面加载时，获取历史记录并初始化语音识别</span></span><br><span class="line">    <span class="built_in">this</span>.getHistory()</span><br><span class="line">    <span class="built_in">this</span>.initRecord()</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;<span class="attr">toView</span>: <span class="built_in">this</span>.data.toView&#125;)</span><br><span class="line">    app.getRecordAuth()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">onHide</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 页面隐藏时，设置历史记录</span></span><br><span class="line">    <span class="built_in">this</span>.setHistory()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 定义一个点击事件处理函数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">onBackIconTap</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 返回上一页</span></span><br><span class="line">    wx.navigateBack(&#123;</span><br><span class="line">      <span class="attr">delta</span>: <span class="number">1</span>, <span class="comment">// 返回的页面层数</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  </span><br></pre></td></tr></table></figure>
<h5 id="voice_translation.json">2 voice_translation.json</h5>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;usingComponents&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;bottom-button&quot;</span>: <span class="string">&quot;/components/bottom-button/index&quot;</span>,</span><br><span class="line">    <span class="string">&quot;result-bubble&quot;</span>: <span class="string">&quot;/components/result-bubble/index&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="voice_translationt.wxml">3 voice_translationt.wxml</h5>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--index<span class="selector-class">.wxml--</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 页面背景部分 --&gt;</span><br><span class="line">&lt;view class=&quot;page-<span class="attribute">background</span>&quot;&gt;</span><br><span class="line">  &lt;image class=&quot;image self-center&quot; <span class="attribute">src</span>=&quot;../../imgs/voice_background<span class="selector-class">.png</span>&quot;&gt;&lt;/image&gt;</span><br><span class="line">&lt;/view&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 主体部分，包含对话框和底部按钮 --&gt;</span><br><span class="line">&lt;view class=&quot;container&quot;&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 对话框部分 --&gt;</span><br><span class="line">  &lt;scroll-view id=&quot;scroll-<span class="attribute">content</span>&quot;</span><br><span class="line">    scroll-<span class="attribute">top</span>=&quot;&#123;&#123;scroll_top&#125;&#125;&quot;</span><br><span class="line">    scroll-y=&quot;true&quot;</span><br><span class="line">    class=&quot;dialog-part&quot;</span><br><span class="line">    scroll-into-view=&quot;translate-&#123;&#123;toView&#125;&#125;&quot;</span><br><span class="line">    enable-back-<span class="selector-tag">to</span>-<span class="attribute">top</span>=&quot;true&quot;</span><br><span class="line">    scroll-with-<span class="attribute">animation</span>=&quot;true&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 空白间隔部分 --&gt;</span><br><span class="line">    &lt;view class=&quot;spacer&quot;&gt;&lt;/view&gt; </span><br><span class="line">    </span><br><span class="line">    &lt;!-- 返回图标，点击触发 onBackIconTap 函数 --&gt;</span><br><span class="line">    &lt;view id=&quot;back-<span class="attribute">icon</span>&quot; class=&quot;back-<span class="attribute">icon</span>&quot; bindtap=&quot;onBackIconTap&quot; &gt;</span><br><span class="line">      &lt;image <span class="attribute">src</span>=&quot;../../imgs/arrow-<span class="attribute">left</span><span class="selector-class">.png</span>&quot; class=&quot;arrow-<span class="attribute">icon</span>&quot;&gt;&lt;/image&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 语言切换部分 --&gt;</span><br><span class="line">    &lt;view class=&quot;<span class="attribute">flex</span>-row justify-between items-center relative group_2&quot;&gt;</span><br><span class="line">      &lt;view class=&quot;<span class="attribute">flex</span>-row items-center self-stretch group_3 space-x-<span class="number">8</span>&quot;&gt;</span><br><span class="line">        &lt;!-- 根据 lan_type 的值，显示不同的图片和文本 --&gt;</span><br><span class="line">        &lt;image wx:if=<span class="string">&quot;&#123;&#123;lan_type&#125;&#125;&quot;</span> class=<span class="string">&quot;shrink-0 image_1&quot;</span> src=<span class="string">&quot;&#123;&#123;image_c&#125;&#125;&quot;</span> /&gt;</span><br><span class="line">        &lt;image wx:else class=<span class="string">&quot;shrink-0 image_1&quot;</span> src=<span class="string">&quot;&#123;&#123;image_e&#125;&#125;&quot;</span> /&gt;</span><br><span class="line">        &lt;text class=<span class="string">&quot;text&quot;</span> wx:if=<span class="string">&quot;&#123;&#123;lan_type&#125;&#125;&quot;</span>&gt;中文&lt;/text&gt;</span><br><span class="line">        &lt;text class=<span class="string">&quot;text&quot;</span> wx:else&gt;英文&lt;/text&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 语言切换按钮，点击触发 changelanguage 函数 --&gt;</span><br><span class="line">        &lt;view bindtap=<span class="string">&quot;changelanguage&quot;</span> style=<span class="string">&quot;display: inline-block&quot;</span>&gt;</span><br><span class="line">          &lt;image class=<span class="string">&quot;image_1 image_2&quot;</span> src=<span class="string">&quot;../../imgs/Vector.png&quot;</span>/&gt;</span><br><span class="line">        &lt;/view&gt;</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 列表部分 --&gt;</span><br><span class="line">    &lt;!-- 列表为空时显示的部分 --&gt;</span><br><span class="line">    &lt;view class=<span class="string">&quot;dialog-wrap&quot;</span> id=<span class="string">&quot;translate-empty&quot;</span> wx:if=<span class="string">&quot;&#123;&#123;!recording &amp;&amp; dialogList.length == 0&#125;&#125;&quot;</span>&gt;</span><br><span class="line">      &lt;result-bubble item=<span class="string">&quot;&#123;&#123;initTranslate&#125;&#125;&quot;</span> record-status=<span class="string">&quot;0&quot;</span>&gt;&lt;/result-bubble&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 列表部分 --&gt;</span><br><span class="line">    &lt;view wx:for=<span class="string">&quot;&#123;&#123;dialogList&#125;&#125;&quot;</span> wx:key=<span class="string">&quot;id&quot;</span> class=<span class="string">&quot;dialog-wrap&quot;</span> data-index=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span> catchmodaldelete=<span class="string">&quot;deleteItem&quot;</span>&gt;</span><br><span class="line">      &lt;result-bubble item=<span class="string">&quot;&#123;&#123;item&#125;&#125;&quot;</span></span><br><span class="line">        edit-show=<span class="string">&quot;&#123;&#123;index==dialogList.length-1&#125;&#125;&quot;</span></span><br><span class="line">        index=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span></span><br><span class="line">        current-translate-voice=<span class="string">&quot;&#123;&#123;currentTranslateVoice&#125;&#125;&quot;</span></span><br><span class="line">        bindtranslate=<span class="string">&quot;translateTextAction&quot;</span></span><br><span class="line">        bindexpired=<span class="string">&quot;expiredAction&quot;</span>&gt;&lt;/result-bubble&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 正在录音时显示的部分 --&gt;</span><br><span class="line">    &lt;view class=<span class="string">&quot;dialog-wrap&quot;</span> id=<span class="string">&quot;translate-recording&quot;</span> wx:if=<span class="string">&quot;&#123;&#123;recording&#125;&#125;&quot;</span>&gt;</span><br><span class="line">      &lt;result-bubble item=<span class="string">&quot;&#123;&#123;currentTranslate&#125;&#125;&quot;</span> record-status=<span class="string">&quot;&#123;&#123;recordStatus&#125;&#125;&quot;</span>&gt;&lt;/result-bubble&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line"></span><br><span class="line">    &lt;view id=<span class="string">&quot;translate-fake&quot;</span>&gt;&lt;/view&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/scroll-view&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 底部按钮部分 --&gt;</span><br><span class="line">  &lt;view class=<span class="string">&quot;foot-group&quot;</span> catchlongpress=<span class="string">&quot;catchTapEvent&quot;</span>&gt;</span><br><span class="line">    &lt;bottom-button button-disabled=<span class="string">&quot;&#123;&#123;bottomButtonDisabled&#125;&#125;&quot;</span></span><br><span class="line">      bindrecordstart=<span class="string">&quot;streamRecord&quot;</span></span><br><span class="line">      bindrecordend=<span class="string">&quot;streamRecordEnd&quot;</span>&gt;&lt;/bottom-button&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/view&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="voice_translation.wxss">3 voice_translation.wxss</h5>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 主容器样式 */</span></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&quot;PingFang-SC-Regular&quot;</span>, <span class="string">&quot;SimSun&quot;</span>, <span class="string">&quot;Microsoft Yahei&quot;</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#1494fc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 页面样式 */</span></span><br><span class="line">page &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#FAFAFA</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 输入框样式 */</span></span><br><span class="line"><span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&quot;PingFang-SC-Regular&quot;</span>, <span class="string">&quot;SimSun&quot;</span>, <span class="string">&quot;Microsoft Yahei&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* flex布局，列方向 */</span></span><br><span class="line"><span class="selector-class">.flex-column</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* spacer元素样式 */</span></span><br><span class="line"><span class="selector-class">.spacer</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">246</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 页面背景样式 */</span></span><br><span class="line"><span class="selector-class">.page-background</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">345px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-position</span>: center;</span><br><span class="line">  <span class="attribute">background-size</span>: cover;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 图片样式 */</span></span><br><span class="line"><span class="selector-class">.image</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">750</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">348</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设置元素相对于其父元素的位置为中心 */</span></span><br><span class="line"><span class="selector-class">.self-center</span> &#123;</span><br><span class="line">  <span class="attribute">align-self</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 对话框包裹样式 */</span></span><br><span class="line"><span class="selector-class">.dialog-wrap</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx <span class="number">40</span>rpx <span class="number">50</span>rpx <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 消息详情文字样式 */</span></span><br><span class="line"><span class="selector-class">.send-message</span> <span class="selector-class">.text-detail</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#9B9B9B</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 对话部分样式 */</span></span><br><span class="line"><span class="selector-class">.dialog-part</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">257</span>rpx;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">z-index</span>:<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 用户输入样式 */</span></span><br><span class="line"><span class="selector-class">.user-input</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">60</span>rpx;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 文本内容样式 */</span></span><br><span class="line"><span class="selector-class">.text-content</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">48px</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 编辑图标样式 */</span></span><br><span class="line"><span class="selector-class">.edit-icon</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">8</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 播放图标样式 */</span></span><br><span class="line"><span class="selector-class">.play-icon</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">14</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">8</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 声音图标样式 */</span></span><br><span class="line"><span class="selector-class">.play-loud-icon</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">14</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">8</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 文字详情样式 */</span></span><br><span class="line"><span class="selector-class">.text-detail</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&quot;PingFang-SC-Regular&quot;</span>, <span class="string">&quot;SimSun&quot;</span>, <span class="string">&quot;Microsoft Yahei&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 返回图标样式 */</span></span><br><span class="line"><span class="selector-class">.back-icon</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">z-index</span>:<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 箭头图标样式 */</span></span><br><span class="line"><span class="selector-class">.arrow-icon</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 翻译消息样式 */</span></span><br><span class="line"><span class="selector-class">.translate-message</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 发送消息样式 */</span></span><br><span class="line"><span class="selector-class">.send-message</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 创建时间样式 */</span></span><br><span class="line"><span class="selector-class">.create-time</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#B2B2B2</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 模糊滤镜样式 */</span></span><br><span class="line"><span class="selector-class">.filter-blur</span> &#123;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">5px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 空提示样式 */</span></span><br><span class="line"><span class="selector-class">.empty-tip</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">margin</span>: auto;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#000000</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 伪翻译样式 */</span></span><br><span class="line"><span class="selector-class">.translate-fake</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>:<span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 底部分组样式 */</span></span><br><span class="line"><span class="selector-class">.foot-group</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">40</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 分组样式 */</span></span><br><span class="line"><span class="selector-class">.group_2</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">76</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.group_3</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">220</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 空间间隔样式 */</span></span><br><span class="line"><span class="selector-class">.space-x-8</span> &gt; view<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-x-8</span> &gt; text<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child),</span><br><span class="line"><span class="selector-class">.space-x-8</span> &gt; image<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child) &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">16</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 图片样式 */</span></span><br><span class="line"><span class="selector-class">.image_1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">32</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 文本样式 */</span></span><br><span class="line"><span class="selector-class">.text</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">font-family</span>: Poppins;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">29</span>rpx;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">50</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 第二张图片样式 */</span></span><br><span class="line"><span class="selector-class">.image_2</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">230</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="tdd_test_cdt">4.1.5 TDD_test_cdt/</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">translateText: <span class="function"><span class="keyword">function</span>(<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> lfrom =  item.lfrom || <span class="string">&#x27;zh_CN&#x27;</span></span><br><span class="line">   <span class="keyword">let</span> lto = item.lto || <span class="string">&#x27;en_US&#x27;</span></span><br><span class="line"></span><br><span class="line">   plugin.translate(&#123;</span><br><span class="line">     <span class="attr">lfrom</span>: lfrom,</span><br><span class="line">     <span class="attr">lto</span>: lto,</span><br><span class="line">     <span class="attr">content</span>: item.text,</span><br><span class="line">     <span class="attr">tts</span>: <span class="literal">true</span>,</span><br><span class="line">     <span class="attr">success</span>: <span class="function">(<span class="params">resTrans</span>)=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">let</span> passRetcode = [</span><br><span class="line">         <span class="number">0</span>, <span class="comment">// 翻译合成成功</span></span><br><span class="line">         -<span class="number">10006</span>, <span class="comment">// 翻译成功，合成失败</span></span><br><span class="line">         -<span class="number">10007</span>, <span class="comment">// 翻译成功，传入了不支持的语音合成语言</span></span><br><span class="line">         -<span class="number">10008</span>, <span class="comment">// 翻译成功，语音合成达到频率限制</span></span><br><span class="line">       ]</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>(passRetcode.indexOf(resTrans.retcode) &gt;= <span class="number">0</span> ) &#123;</span><br><span class="line">         <span class="keyword">let</span> tmpDialogList = <span class="built_in">this</span>.data.dialogList.slice(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span>(!<span class="built_in">isNaN</span>(index)) &#123;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">let</span> tmpTranslate = <span class="built_in">Object</span>.assign(&#123;&#125;, item, &#123;</span><br><span class="line">             <span class="attr">autoPlay</span>: <span class="literal">true</span>, <span class="comment">// 自动播放背景音乐</span></span><br><span class="line">             <span class="attr">translateText</span>: resTrans.result,</span><br><span class="line">             <span class="attr">translateVoicePath</span>: resTrans.filename || <span class="string">&quot;&quot;</span>,</span><br><span class="line">             <span class="attr">translateVoiceExpiredTime</span>: resTrans.expired_time || <span class="number">0</span></span><br><span class="line">           &#125;)</span><br><span class="line"></span><br><span class="line">           tmpDialogList[index] = tmpTranslate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">             <span class="attr">dialogList</span>: tmpDialogList,</span><br><span class="line">             <span class="attr">bottomButtonDisabled</span>: <span class="literal">false</span>,</span><br><span class="line">             <span class="attr">recording</span>: <span class="literal">false</span>,</span><br><span class="line">           &#125;)</span><br><span class="line"></span><br><span class="line">           <span class="built_in">this</span>.scrollToNew();</span><br><span class="line"></span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="built_in">console</span>.error(<span class="string">&quot;index error&quot;</span>, resTrans, item)</span><br><span class="line">         &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="built_in">console</span>.warn(<span class="string">&quot;翻译失败&quot;</span>, resTrans, item)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span>(<span class="params">resTrans</span>) </span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.error(<span class="string">&quot;调用失败&quot;</span>,resTrans, item)</span><br><span class="line">       <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">         <span class="attr">bottomButtonDisabled</span>: <span class="literal">false</span>,</span><br><span class="line">         <span class="attr">recording</span>: <span class="literal">false</span>,</span><br><span class="line">       &#125;)</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="attr">complete</span>: <span class="function"><span class="params">resTrans</span> =&gt;</span> &#123;</span><br><span class="line">       <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">         <span class="attr">recordStatus</span>: <span class="number">1</span>,</span><br><span class="line">       &#125;)</span><br><span class="line">       wx.hideLoading()</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
<h3 id="tdd_test_zxk">4.1.6 TDD_test_zxk/</h3>
<h4 id="node_modules">4.1.6.1 node_modules</h4>
<blockquote>
<p>Mocha 测试框架调用的npm组件</p>
</blockquote>
<h4 id="translate.js">4.1.6.2 translate.js</h4>
<p>基于TDD测试开发的获取文本翻译内容的JavaScript代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// translate.js</span></span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> md5 = <span class="built_in">require</span>(<span class="string">&#x27;md5&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">translate</span>(<span class="params">inputText, sourceLang, targetLang</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!inputText) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Invalid input&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> appid = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> secretKey = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> salt = (<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime();</span><br><span class="line">    <span class="keyword">const</span> text_encode = <span class="built_in">encodeURIComponent</span>(inputText);</span><br><span class="line">    <span class="keyword">const</span> str1 = appid + text_encode + salt + secretKey;</span><br><span class="line">    <span class="keyword">const</span> sign = md5(str1);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> axios.post(<span class="string">&#x27;https://fanyi-api.baidu.com/api/trans/vip/translate&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">q</span>: text_encode,</span><br><span class="line">        <span class="attr">from</span>: sourceLang,</span><br><span class="line">        <span class="attr">to</span>: targetLang,</span><br><span class="line">        <span class="attr">appid</span>: appid,</span><br><span class="line">        <span class="attr">salt</span>: salt,</span><br><span class="line">        <span class="attr">sign</span>: sign,</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (response.data.error_code) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Translation failed: <span class="subst">$&#123;response.data.error_msg&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response.data.trans_result[<span class="number">0</span>].dst;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = translate;</span><br></pre></td></tr></table></figure>
<h4 id="ranslate.test.js">4.1.6.3 ranslate.test.js</h4>
<p>基于Mocha框架编写的测试文本翻译Javascript的测试程序。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入测试库</span></span><br><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">&#x27;assert&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> translate = <span class="built_in">require</span>(<span class="string">&#x27;./translate&#x27;</span>);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;translate function&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    it(<span class="string">&#x27;should translate &quot;software&quot; to Chinese correctly&#x27;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> translate(<span class="string">&#x27;software&#x27;</span>, <span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;zh&#x27;</span>);</span><br><span class="line">        assert.strictEqual(result, <span class="string">&#x27;软件&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">&#x27;should translate &quot;software@&quot; to Chinese correctly&#x27;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> translate(<span class="string">&#x27;software&#x27;</span>, <span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;zh&#x27;</span>);</span><br><span class="line">        assert.strictEqual(result, <span class="string">&#x27;软件@&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">&#x27;should handle space correctly&#x27;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> translate(<span class="string">&#x27;hello world&#x27;</span>, <span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;zh&#x27;</span>);</span><br><span class="line">        assert.strictEqual(result, <span class="string">&#x27;你好世界&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">&#x27;should handle error correctly&#x27;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">await</span> translate(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;zh&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            assert.strictEqual(e.message, <span class="string">&#x27;Invalid input&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="utils">4.1.7 utils/</h3>
<h4 id="utilsapi.js">4.1.7.1 utils/api.js</h4>
<p>这段代码在utils/目录内继承了所需要用到的api服务，在小程序内需要用到时可以直接调用，提高了代码的可读性与可维护性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> md5 <span class="keyword">from</span> <span class="string">&#x27;./md5.min.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> appid = <span class="string">&#x27;20230428001660105&#x27;</span> <span class="comment">//注册百度翻译api</span></span><br><span class="line"><span class="keyword">const</span> key = <span class="string">&#x27;cVKXtU5tdGp8YDBPghkX&#x27;</span> <span class="comment">//注册百度翻译api</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">translate</span>(<span class="params">q, &#123; <span class="keyword">from</span> = <span class="string">&#x27;auto&#x27;</span>, to = <span class="string">&#x27;auto&#x27;</span> &#125; = &#123; <span class="keyword">from</span>: <span class="string">&#x27;auto&#x27;</span>, to: <span class="string">&#x27;auto&#x27;</span> &#125;</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//表示默认传递参数传递的值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> salt = <span class="built_in">Date</span>.now() <span class="comment">//随机数</span></span><br><span class="line">        <span class="keyword">let</span> sign = md5(<span class="string">`<span class="subst">$&#123;appid&#125;</span><span class="subst">$&#123;q&#125;</span><span class="subst">$&#123;salt&#125;</span><span class="subst">$&#123;key&#125;</span>`</span>) <span class="comment">//拼接 MD5进行加密</span></span><br><span class="line">        wx.request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;https://fanyi-api.baidu.com/api/trans/vip/translate&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                q, <span class="comment">//待翻译文本</span></span><br><span class="line">                <span class="keyword">from</span>, <span class="comment">//待翻译的原始语言</span></span><br><span class="line">                to, <span class="comment">//待翻译成的目标语言</span></span><br><span class="line">                appid,</span><br><span class="line">                salt, <span class="comment">//随机数</span></span><br><span class="line">                sign <span class="comment">//拼接 MD5进行加密</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">success</span>(<span class="params">res</span>)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (res.data &amp;&amp; res.data.trans_result) &#123;</span><br><span class="line">                    resolve(res.data)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    reject(&#123; <span class="attr">status</span>: <span class="string">&#x27;error&#x27;</span>, <span class="attr">msg</span>: <span class="string">&#x27;翻译失败&#x27;</span> &#125;)</span><br><span class="line">                    wx.showToast(&#123;</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&#x27;翻译失败&#x27;</span>,</span><br><span class="line">                        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">                        <span class="attr">duration</span>: <span class="number">3000</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">fail</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                reject(&#123; <span class="attr">status</span>: <span class="string">&#x27;error&#x27;</span>, <span class="attr">msg</span>: <span class="string">&#x27;翻译失败&#x27;</span> &#125;)</span><br><span class="line">                wx.showToast(&#123;</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;网络异常&#x27;</span>,</span><br><span class="line">                    <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">                    <span class="attr">duration</span>: <span class="number">3000</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPicBase64</span>(<span class="params">tempFilePath</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        wx.getFileSystemManager().readFile(&#123;</span><br><span class="line">            <span class="attr">filePath</span>: tempFilePath,</span><br><span class="line">            <span class="attr">encoding</span>: <span class="string">&quot;base64&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(data); <span class="comment">//返回base64编码结果，但是图片的话没有data:image/png</span></span><br><span class="line">                resolve(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPicToWord</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resole, reject</span>) </span>&#123;</span><br><span class="line">        wx.request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;https://api.jisuapi.com/generalrecognition/recognize?appkey=993bfd80d8ac15c6&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="attr">pic</span>: src,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;cnen&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(res);</span><br><span class="line">                resole(res);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(res);</span><br><span class="line">                reject(res);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">translate</span>: translate,</span><br><span class="line">    <span class="attr">getPicBase64</span>: getPicBase64,</span><br><span class="line">    <span class="attr">getPicToWord</span>: getPicToWord</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="utilsconf.js">4.1.7.2 utils/conf.js</h4>
<p>语音翻译的语言配置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">let language = [</span><br><span class="line">    &#123;</span><br><span class="line">        id: <span class="number">0</span>,</span><br><span class="line">        lang_name: <span class="string">&quot;中文&quot;</span>,</span><br><span class="line">        lang_content: <span class="string">&quot;zh_CN&quot;</span>,</span><br><span class="line">        lang_to: [<span class="string">&quot;en_US&quot;</span>],</span><br><span class="line">        max_length: <span class="number">300</span>,</span><br><span class="line">        source_language: <span class="string">&quot;输入文字&quot;</span>,</span><br><span class="line">        target_language: <span class="string">&quot;输出文字&quot;</span>,</span><br><span class="line">        hold_talk: <span class="string">&quot;长按说话&quot;</span>,</span><br><span class="line">        keyboard_input: <span class="string">&quot;键盘输入&quot;</span>,</span><br><span class="line">        type_here: <span class="string">&quot;输入文字&quot;</span>,</span><br><span class="line">        bg_content: <span class="string">&quot;请输入翻译内容&quot;</span>,</span><br><span class="line">        record_failed: <span class="string">&quot;录制失败&quot;</span>,</span><br><span class="line">        recognize_nothing: <span class="string">&quot;请说话&quot;</span>,</span><br><span class="line">        time_left: <span class="string">&quot;录音输入倒数&quot;</span>,</span><br><span class="line">        text_left: <span class="string">&quot;剩余文本长度&quot;</span>,</span><br><span class="line">        prompt_time: <span class="string">&quot;提示秒数&quot;</span>,</span><br><span class="line">        upload_failed: <span class="string">&quot;上传失败&quot;</span>,</span><br><span class="line">        translating: <span class="string">&quot;翻译中&quot;</span>,</span><br><span class="line">        text_limit: <span class="string">&quot;限制长度&quot;</span>,</span><br><span class="line">        input_tip: <span class="string">&quot;请输入有效文字&quot;</span>,</span><br><span class="line">        request_failed: <span class="string">&quot;请求失败&quot;</span>,</span><br><span class="line">        delete_tip: <span class="string">&quot;删除该项&quot;</span>,</span><br><span class="line">        cancel: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">        bubble_tip: <span class="string">&quot;请输入文本&quot;</span>,</span><br><span class="line">        bg_bubble: <span class="string">&quot;正在听你说话&quot;</span>,</span><br><span class="line">        copy_source_text: <span class="string">&quot;复制原文&quot;</span>,</span><br><span class="line">        copy_target_text: <span class="string">&quot;复制译文&quot;</span>,</span><br><span class="line">        delete_item: <span class="string">&quot;删除&quot;</span>,</span><br><span class="line">        exceed_network: <span class="string">&quot;网络请求失败&quot;</span>,</span><br><span class="line">        retry_network: <span class="string">&quot;尝试重新连接&quot;</span>,</span><br><span class="line">        wait_last_record: <span class="string">&quot;请等待翻译结束&quot;</span>,</span><br><span class="line">        access_auth: <span class="string">&quot;请检查权限&quot;</span>,</span><br><span class="line">        access_network: <span class="string">&quot;网络错误&quot;</span>,</span><br><span class="line">        login: <span class="string">&quot;登录&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    language: language,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="md5.min.js">4.1.7.3 md5.min.js</h4>
<p>这段代码用于获取字符串的十六进制32位下的MD5。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">! <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line"><span class="meta">    &quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">t</span>(<span class="params">n, t</span>) </span>&#123; <span class="keyword">var</span> r = (<span class="number">65535</span> &amp; n) + (<span class="number">65535</span> &amp; t); <span class="keyword">return</span> (n &gt;&gt; <span class="number">16</span>) + (t &gt;&gt; <span class="number">16</span>) + (r &gt;&gt; <span class="number">16</span>) &lt;&lt; <span class="number">16</span> | <span class="number">65535</span> &amp; r &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">r</span>(<span class="params">n, t</span>) </span>&#123; <span class="keyword">return</span> n &lt;&lt; t | n &gt;&gt;&gt; <span class="number">32</span> - t &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">e</span>(<span class="params">n, e, o, u, c, f</span>) </span>&#123; <span class="keyword">return</span> t(r(t(t(e, n), t(u, f)), c), o) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">o</span>(<span class="params">n, t, r, o, u, c, f</span>) </span>&#123; <span class="keyword">return</span> e(t &amp; r | ~t &amp; o, n, t, u, c, f) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">u</span>(<span class="params">n, t, r, o, u, c, f</span>) </span>&#123; <span class="keyword">return</span> e(t &amp; o | r &amp; ~o, n, t, u, c, f) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params">n, t, r, o, u, c, f</span>) </span>&#123; <span class="keyword">return</span> e(t ^ r ^ o, n, t, u, c, f) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n, t, r, o, u, c, f</span>) </span>&#123; <span class="keyword">return</span> e(r ^ (t | ~o), n, t, u, c, f) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">i</span>(<span class="params">n, r</span>) </span>&#123;</span><br><span class="line">        n[r &gt;&gt; <span class="number">5</span>] |= <span class="number">128</span> &lt;&lt; r % <span class="number">32</span>, n[<span class="number">14</span> + (r + <span class="number">64</span> &gt;&gt;&gt; <span class="number">9</span> &lt;&lt; <span class="number">4</span>)] = r;</span><br><span class="line">        <span class="keyword">var</span> e, i, a, d, h, l = <span class="number">1732584193</span>,</span><br><span class="line">            g = -<span class="number">271733879</span>,</span><br><span class="line">            v = -<span class="number">1732584194</span>,</span><br><span class="line">            m = <span class="number">271733878</span>;</span><br><span class="line">        <span class="keyword">for</span> (e = <span class="number">0</span>; e &lt; n.length; e += <span class="number">16</span>) i = l, a = g, d = v, h = m, g = f(g = f(g = f(g = f(g = c(g = c(g = c(g = c(g = u(g = u(g = u(g = u(g = o(g = o(g = o(g = o(g, v = o(v, m = o(m, l = o(l, g, v, m, n[e], <span class="number">7</span>, -<span class="number">680876936</span>), g, v, n[e + <span class="number">1</span>], <span class="number">12</span>, -<span class="number">389564586</span>), l, g, n[e + <span class="number">2</span>], <span class="number">17</span>, <span class="number">606105819</span>), m, l, n[e + <span class="number">3</span>], <span class="number">22</span>, -<span class="number">1044525330</span>), v = o(v, m = o(m, l = o(l, g, v, m, n[e + <span class="number">4</span>], <span class="number">7</span>, -<span class="number">176418897</span>), g, v, n[e + <span class="number">5</span>], <span class="number">12</span>, <span class="number">1200080426</span>), l, g, n[e + <span class="number">6</span>], <span class="number">17</span>, -<span class="number">1473231341</span>), m, l, n[e + <span class="number">7</span>], <span class="number">22</span>, -<span class="number">45705983</span>), v = o(v, m = o(m, l = o(l, g, v, m, n[e + <span class="number">8</span>], <span class="number">7</span>, <span class="number">1770035416</span>), g, v, n[e + <span class="number">9</span>], <span class="number">12</span>, -<span class="number">1958414417</span>), l, g, n[e + <span class="number">10</span>], <span class="number">17</span>, -<span class="number">42063</span>), m, l, n[e + <span class="number">11</span>], <span class="number">22</span>, -<span class="number">1990404162</span>), v = o(v, m = o(m, l = o(l, g, v, m, n[e + <span class="number">12</span>], <span class="number">7</span>, <span class="number">1804603682</span>), g, v, n[e + <span class="number">13</span>], <span class="number">12</span>, -<span class="number">40341101</span>), l, g, n[e + <span class="number">14</span>], <span class="number">17</span>, -<span class="number">1502002290</span>), m, l, n[e + <span class="number">15</span>], <span class="number">22</span>, <span class="number">1236535329</span>), v = u(v, m = u(m, l = u(l, g, v, m, n[e + <span class="number">1</span>], <span class="number">5</span>, -<span class="number">165796510</span>), g, v, n[e + <span class="number">6</span>], <span class="number">9</span>, -<span class="number">1069501632</span>), l, g, n[e + <span class="number">11</span>], <span class="number">14</span>, <span class="number">643717713</span>), m, l, n[e], <span class="number">20</span>, -<span class="number">373897302</span>), v = u(v, m = u(m, l = u(l, g, v, m, n[e + <span class="number">5</span>], <span class="number">5</span>, -<span class="number">701558691</span>), g, v, n[e + <span class="number">10</span>], <span class="number">9</span>, <span class="number">38016083</span>), l, g, n[e + <span class="number">15</span>], <span class="number">14</span>, -<span class="number">660478335</span>), m, l, n[e + <span class="number">4</span>], <span class="number">20</span>, -<span class="number">405537848</span>), v = u(v, m = u(m, l = u(l, g, v, m, n[e + <span class="number">9</span>], <span class="number">5</span>, <span class="number">568446438</span>), g, v, n[e + <span class="number">14</span>], <span class="number">9</span>, -<span class="number">1019803690</span>), l, g, n[e + <span class="number">3</span>], <span class="number">14</span>, -<span class="number">187363961</span>), m, l, n[e + <span class="number">8</span>], <span class="number">20</span>, <span class="number">1163531501</span>), v = u(v, m = u(m, l = u(l, g, v, m, n[e + <span class="number">13</span>], <span class="number">5</span>, -<span class="number">1444681467</span>), g, v, n[e + <span class="number">2</span>], <span class="number">9</span>, -<span class="number">51403784</span>), l, g, n[e + <span class="number">7</span>], <span class="number">14</span>, <span class="number">1735328473</span>), m, l, n[e + <span class="number">12</span>], <span class="number">20</span>, -<span class="number">1926607734</span>), v = c(v, m = c(m, l = c(l, g, v, m, n[e + <span class="number">5</span>], <span class="number">4</span>, -<span class="number">378558</span>), g, v, n[e + <span class="number">8</span>], <span class="number">11</span>, -<span class="number">2022574463</span>), l, g, n[e + <span class="number">11</span>], <span class="number">16</span>, <span class="number">1839030562</span>), m, l, n[e + <span class="number">14</span>], <span class="number">23</span>, -<span class="number">35309556</span>), v = c(v, m = c(m, l = c(l, g, v, m, n[e + <span class="number">1</span>], <span class="number">4</span>, -<span class="number">1530992060</span>), g, v, n[e + <span class="number">4</span>], <span class="number">11</span>, <span class="number">1272893353</span>), l, g, n[e + <span class="number">7</span>], <span class="number">16</span>, -<span class="number">155497632</span>), m, l, n[e + <span class="number">10</span>], <span class="number">23</span>, -<span class="number">1094730640</span>), v = c(v, m = c(m, l = c(l, g, v, m, n[e + <span class="number">13</span>], <span class="number">4</span>, <span class="number">681279174</span>), g, v, n[e], <span class="number">11</span>, -<span class="number">358537222</span>), l, g, n[e + <span class="number">3</span>], <span class="number">16</span>, -<span class="number">722521979</span>), m, l, n[e + <span class="number">6</span>], <span class="number">23</span>, <span class="number">76029189</span>), v = c(v, m = c(m, l = c(l, g, v, m, n[e + <span class="number">9</span>], <span class="number">4</span>, -<span class="number">640364487</span>), g, v, n[e + <span class="number">12</span>], <span class="number">11</span>, -<span class="number">421815835</span>), l, g, n[e + <span class="number">15</span>], <span class="number">16</span>, <span class="number">530742520</span>), m, l, n[e + <span class="number">2</span>], <span class="number">23</span>, -<span class="number">995338651</span>), v = f(v, m = f(m, l = f(l, g, v, m, n[e], <span class="number">6</span>, -<span class="number">198630844</span>), g, v, n[e + <span class="number">7</span>], <span class="number">10</span>, <span class="number">1126891415</span>), l, g, n[e + <span class="number">14</span>], <span class="number">15</span>, -<span class="number">1416354905</span>), m, l, n[e + <span class="number">5</span>], <span class="number">21</span>, -<span class="number">57434055</span>), v = f(v, m = f(m, l = f(l, g, v, m, n[e + <span class="number">12</span>], <span class="number">6</span>, <span class="number">1700485571</span>), g, v, n[e + <span class="number">3</span>], <span class="number">10</span>, -<span class="number">1894986606</span>), l, g, n[e + <span class="number">10</span>], <span class="number">15</span>, -<span class="number">1051523</span>), m, l, n[e + <span class="number">1</span>], <span class="number">21</span>, -<span class="number">2054922799</span>), v = f(v, m = f(m, l = f(l, g, v, m, n[e + <span class="number">8</span>], <span class="number">6</span>, <span class="number">1873313359</span>), g, v, n[e + <span class="number">15</span>], <span class="number">10</span>, -<span class="number">30611744</span>), l, g, n[e + <span class="number">6</span>], <span class="number">15</span>, -<span class="number">1560198380</span>), m, l, n[e + <span class="number">13</span>], <span class="number">21</span>, <span class="number">1309151649</span>), v = f(v, m = f(m, l = f(l, g, v, m, n[e + <span class="number">4</span>], <span class="number">6</span>, -<span class="number">145523070</span>), g, v, n[e + <span class="number">11</span>], <span class="number">10</span>, -<span class="number">1120210379</span>), l, g, n[e + <span class="number">2</span>], <span class="number">15</span>, <span class="number">718787259</span>), m, l, n[e + <span class="number">9</span>], <span class="number">21</span>, -<span class="number">343485551</span>), l = t(l, i), g = t(g, a), v = t(v, d), m = t(m, h);</span><br><span class="line">        <span class="keyword">return</span> [l, g, v, m]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> t, r = <span class="string">&quot;&quot;</span>,</span><br><span class="line">            e = <span class="number">32</span> * n.length;</span><br><span class="line">        <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; e; t += <span class="number">8</span>) r += <span class="built_in">String</span>.fromCharCode(n[t &gt;&gt; <span class="number">5</span>] &gt;&gt;&gt; t % <span class="number">32</span> &amp; <span class="number">255</span>);</span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params">n</span>) </span>&#123; <span class="keyword">var</span> t, r = []; <span class="keyword">for</span> (r[(n.length &gt;&gt; <span class="number">2</span>) - <span class="number">1</span>] = <span class="keyword">void</span> <span class="number">0</span>, t = <span class="number">0</span>; t &lt; r.length; t += <span class="number">1</span>) r[t] = <span class="number">0</span>; <span class="keyword">var</span> e = <span class="number">8</span> * n.length; <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; e; t += <span class="number">8</span>) r[t &gt;&gt; <span class="number">5</span>] |= (<span class="number">255</span> &amp; n.charCodeAt(t / <span class="number">8</span>)) &lt;&lt; t % <span class="number">32</span>; <span class="keyword">return</span> r &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params">n</span>) </span>&#123; <span class="keyword">return</span> a(i(d(n), <span class="number">8</span> * n.length)) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">l</span>(<span class="params">n, t</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> r, e, o = d(n),</span><br><span class="line">            u = [],</span><br><span class="line">            c = [];</span><br><span class="line">        <span class="keyword">for</span> (u[<span class="number">15</span>] = c[<span class="number">15</span>] = <span class="keyword">void</span> <span class="number">0</span>, o.length &gt; <span class="number">16</span> &amp;&amp; (o = i(o, <span class="number">8</span> * n.length)), r = <span class="number">0</span>; r &lt; <span class="number">16</span>; r += <span class="number">1</span>) u[r] = <span class="number">909522486</span> ^ o[r], c[r] = <span class="number">1549556828</span> ^ o[r];</span><br><span class="line">        <span class="keyword">return</span> e = i(u.concat(d(t)), <span class="number">512</span> + <span class="number">8</span> * t.length), a(i(c.concat(e), <span class="number">640</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params">n</span>) </span>&#123; <span class="keyword">var</span> t, r, e = <span class="string">&quot;&quot;</span>; <span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; n.length; r += <span class="number">1</span>) t = n.charCodeAt(r), e += <span class="string">&quot;0123456789abcdef&quot;</span>.charAt(t &gt;&gt;&gt; <span class="number">4</span> &amp; <span class="number">15</span>) + <span class="string">&quot;0123456789abcdef&quot;</span>.charAt(<span class="number">15</span> &amp; t); <span class="keyword">return</span> e &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">v</span>(<span class="params">n</span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">unescape</span>(<span class="built_in">encodeURIComponent</span>(n)) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">m</span>(<span class="params">n</span>) </span>&#123; <span class="keyword">return</span> h(v(n)) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">p</span>(<span class="params">n</span>) </span>&#123; <span class="keyword">return</span> g(m(n)) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">s</span>(<span class="params">n, t</span>) </span>&#123; <span class="keyword">return</span> l(v(n), v(t)) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">C</span>(<span class="params">n, t</span>) </span>&#123; <span class="keyword">return</span> g(s(n, t)) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params">n, t, r</span>) </span>&#123; <span class="keyword">return</span> t ? r ? s(t, n) : C(t, n) : r ? m(n) : p(n) &#125;</span><br><span class="line">    <span class="string">&quot;function&quot;</span> == <span class="keyword">typeof</span> define &amp;&amp; define.amd ? define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> A &#125;) : <span class="string">&quot;object&quot;</span> == <span class="keyword">typeof</span> <span class="built_in">module</span> &amp;&amp; <span class="built_in">module</span>.exports ? <span class="built_in">module</span>.exports = A : n.md5 = A</span><br><span class="line">&#125;(<span class="built_in">this</span>);</span><br></pre></td></tr></table></figure>
<h4 id="util.js">4.1.7.4 util.js</h4>
<p>这段代码中定义了三个函数：formatTime，recordTime，和formatNumber。</p>
<ul>
<li>formatTime函数接收一个date对象作为参数，获取date对象的年、月、日、时、分、秒，并将它们格式化为字符串。</li>
<li>recordTime只获取date对象的月、日、时、分，并将它们格式化为字符串。<br>
</li>
<li>formatNumber函数接收一个数值n作为参数，将其转化为字符串并检查是否需要在前面补0。</li>
<li>通过module.exports将formatTime和recordTime两个函数导出，使得它们可以在其他文件中被引用。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> formatTime = <span class="function"><span class="params">date</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> year = date.getFullYear();</span><br><span class="line">    <span class="keyword">const</span> month = date.getMonth() + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> day = date.getDate();</span><br><span class="line">    <span class="keyword">const</span> hour = date.getHours();</span><br><span class="line">    <span class="keyword">const</span> minute = date.getMinutes();</span><br><span class="line">    <span class="keyword">const</span> second = date.getSeconds();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [year, month, day].map(formatNumber).join(<span class="string">&#x27;/&#x27;</span>) + <span class="string">&#x27; &#x27;</span> + [hour, minute, second].map(formatNumber).join(<span class="string">&#x27;:&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">recordTime</span>(<span class="params">date</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> month = date.getMonth() + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> day = date.getDate();</span><br><span class="line">    <span class="keyword">var</span> hour = date.getHours();</span><br><span class="line">    <span class="keyword">var</span> minute = date.getMinutes();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [month, day].map(formatNumber).join(<span class="string">&#x27;/&#x27;</span>) + <span class="string">&#x27; &#x27;</span> + [hour, minute].map(formatNumber).join(<span class="string">&#x27;:&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> formatNumber = <span class="function"><span class="params">n</span> =&gt;</span> &#123;</span><br><span class="line">    n = n.toString();</span><br><span class="line">    <span class="keyword">return</span> n[<span class="number">1</span>] ? n : <span class="string">&#x27;0&#x27;</span> + n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">formatTime</span>: formatTime,</span><br><span class="line">    <span class="attr">recordTime</span>: recordTime</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="section">4.1.8 ./</h3>
<h4 id="app.js">4.8.8.1 ./app.js</h4>
<p>在全局的<code>App</code>对象中，<code>onLaunch</code>函数定义了当小程序启动时的操作，例如从本地获取当前语言和历史记录。<code>getRecordAuth</code>函数则用于获取录音权限。<code>onHide</code>函数定义了当小程序隐藏时的操作，例如停止后台音频。<code>globalData</code>对象则定义了全局的数据，包括历史记录、当前语言、按钮列表、图片的Base64编码、词语列表和语言列表等。</p>
<p>在语言列表<code>langList</code>中，每个元素都是一个对象，包含了语言的中文名（<code>chs</code>）、语言代码（<code>lang</code>）、索引（<code>index</code>）、和图标源（<code>src</code>，对于部分语言）。其中，语言代码是用于识别和设置语言的标识，索引是语言在列表中的位置，图标源是显示语言图标的URL地址。每一个对象代表一种语言。在这个应用中，<code>langList</code>定义了全局支持的语言列表，包括英语、中文、日语等。每种语言的定义都包括中文名(<code>chs</code>)、语言代码(<code>lang</code>)和语言在列表中的索引(<code>index</code>)。部分语言定义还包括了图标的URL地址(<code>src</code>)，用于在界面上显示对应的图标。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入工具模块</span></span><br><span class="line"><span class="keyword">const</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;./utils/util.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line">App(&#123;</span><br><span class="line">  <span class="attr">onLaunch</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 展示本地存储能力</span></span><br><span class="line">    <span class="comment">// 在全局数据中设置当前语言，如果本地没有存储过当前语言，那么就使用语言列表的第一个语言</span></span><br><span class="line">    <span class="built_in">this</span>.globalData.curLang = wx.getStorageSync(<span class="string">&#x27;curLang&#x27;</span>) || <span class="built_in">this</span>.globalData.langList[<span class="number">0</span>];</span><br><span class="line">    <span class="built_in">this</span>.globalData.fromLang = wx.getStorageSync(<span class="string">&#x27;fromLang&#x27;</span>) || <span class="built_in">this</span>.globalData.langList[<span class="number">1</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 从本地获取历史记录，如果获取失败，则将全局的历史记录设置为空数组</span></span><br><span class="line">    wx.getStorage(&#123;</span><br><span class="line">      <span class="attr">key</span>: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.globalData.history = res.data</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">fail</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;get storage failed&quot;</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">        <span class="built_in">this</span>.globalData.history = []</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 权限询问</span></span><br><span class="line">  <span class="comment">// 获取录音权限</span></span><br><span class="line">  <span class="attr">getRecordAuth</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    wx.getSetting(&#123;</span><br><span class="line">      <span class="function"><span class="title">success</span>(<span class="params">res</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;succ&quot;</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">        <span class="keyword">if</span> (!res.authSetting[<span class="string">&#x27;scope.record&#x27;</span>]) &#123;</span><br><span class="line">          wx.authorize(&#123;</span><br><span class="line">            <span class="attr">scope</span>: <span class="string">&#x27;scope.record&#x27;</span>,</span><br><span class="line">            <span class="function"><span class="title">success</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">              <span class="comment">// 用户已经同意小程序使用录音功能</span></span><br><span class="line">              <span class="built_in">console</span>.log(<span class="string">&quot;succ auth&quot;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">fail</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">              <span class="built_in">console</span>.log(<span class="string">&quot;fail auth&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&quot;record has been authed&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">fail</span>(<span class="params">res</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;fail&quot;</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">onHide</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 当小程序隐藏时，停止后台音频</span></span><br><span class="line">    wx.stopBackgroundAudio()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义全局的数据</span></span><br><span class="line">  <span class="attr">globalData</span>: &#123;</span><br><span class="line">    <span class="attr">history</span>: [],</span><br><span class="line">    <span class="attr">curLang</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">formLang</span>:&#123;&#125;,</span><br><span class="line">    <span class="attr">buttons</span>:[],</span><br><span class="line">    <span class="attr">picBase64</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">word</span>: [],   </span><br><span class="line">  <span class="comment">// langList定义了支持的语言列表</span></span><br><span class="line">    <span class="attr">langList</span>: [&#123;</span><br><span class="line">    <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;英文&#x27;</span>,   <span class="comment">// 语言的中文名</span></span><br><span class="line">    <span class="string">&quot;lang&quot;</span>: <span class="string">&#x27;en&#x27;</span>,   <span class="comment">// 语言的代码</span></span><br><span class="line">    <span class="string">&quot;index&quot;</span>: <span class="number">0</span>,     <span class="comment">// 语言在列表中的索引</span></span><br><span class="line">  <span class="comment">// 语言的图标URL，如果没有指定，那么将不显示图标</span></span><br><span class="line">      <span class="string">&quot;src&quot;</span>:<span class="string">&quot;https://codefun-proj-user-res-1256085488.cos.ap-guangzhou.myqcloud.com/644bb0005a7e3f03102917b5/644bb06fb98f5d0011665f39/1117504288074e5a51c1cc92bf0eeadb.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;中文&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;zh&#x27;</span>,</span><br><span class="line">      <span class="string">&quot;index&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">&quot;src&quot;</span>:<span class="string">&quot;https://codefun-proj-user-res-1256085488.cos.ap-guangzhou.myqcloud.com/644bb0005a7e3f03102917b5/644bb06fb98f5d0011665f39/ac7f93cc16a6602c18750922cf92014c.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;日语&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;jp&#x27;</span>,</span><br><span class="line">      <span class="string">&quot;index&quot;</span>: <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;韩语&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;kor&#x27;</span>,</span><br><span class="line">      <span class="string">&quot;index&quot;</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="string">&quot;src&quot;</span>:<span class="string">&quot;https://codefun-proj-user-res-1256085488.cos.ap-guangzhou.myqcloud.com/644bb0005a7e3f03102917b5/644bb06fb98f5d0011665f39/16826823185920520575.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;法语&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;fra&#x27;</span>,</span><br><span class="line">      <span class="string">&quot;index&quot;</span>: <span class="number">4</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;德语&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;de&#x27;</span>,</span><br><span class="line">      <span class="string">&quot;index&quot;</span>: <span class="number">5</span>,</span><br><span class="line">      <span class="string">&quot;src&quot;</span>:<span class="string">&quot;https://codefun-proj-user-res-1256085488.cos.ap-guangzhou.myqcloud.com/644bb0005a7e3f03102917b5/644bb06fb98f5d0011665f39/16826823185577922182.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;俄语&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;ru&#x27;</span>,</span><br><span class="line">      <span class="string">&quot;index&quot;</span>: <span class="number">6</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;泰语&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;th&#x27;</span>,</span><br><span class="line">      <span class="string">&quot;index&quot;</span>: <span class="number">7</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;西班牙语&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;spa&#x27;</span>,</span><br><span class="line">      <span class="string">&quot;index&quot;</span>: <span class="number">8</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;阿拉伯语&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;ara&#x27;</span>,</span><br><span class="line">      <span class="string">&quot;index&quot;</span>: <span class="number">9</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;意大利语&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;it&#x27;</span>,</span><br><span class="line">      <span class="string">&quot;index&quot;</span>: <span class="number">10</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&#x27;chs&#x27;</span>: <span class="string">&#x27;葡萄牙语&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;pt&#x27;</span>,</span><br><span class="line">      <span class="string">&quot;index&quot;</span>: <span class="number">11</span></span><br><span class="line">    &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="app.json">4.8.8.2 ./app.json</h4>
<p>这段代码是微信小程序的配置文件<code>app.json</code>中的一部分。<code>app.json</code>是小程序的全局配置，包括了小程序的所有页面路径、界面表现、网络超时时间、多
tab
等等。简单解释一下，这段代码配置了小程序的页面、窗口表现、使用的插件、sitemap
文件位置以及底部 tab
栏的表现。其中，<code>pages</code>数组包含了所有页面的路径，<code>window</code>对象设置了全局窗口的外观，<code>plugins</code>对象声明了小程序使用的插件，<code>sitemapLocation</code>字符串指明了sitemap
文件的位置，<code>tabBar</code>对象则描述了底部 tab 栏的表现。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 小程序所有页面的路径数组</span></span><br><span class="line">    <span class="attr">&quot;pages&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pages/history/history&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pages/OCR/OCR&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pages/getPic/getPic&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pages/voice_translation/voice_translation&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pages/edit/edit&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pages/choose_language/choose_language&quot;</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 全局的默认窗口表现</span></span><br><span class="line">    <span class="attr">&quot;window&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;backgroundTextStyle&quot;</span>: <span class="string">&quot;light&quot;</span>,  <span class="comment">// 下拉背景字体、loading 图的样式</span></span><br><span class="line">        <span class="attr">&quot;navigationBarBackgroundColor&quot;</span>: <span class="string">&quot;#1493FC&quot;</span>,  <span class="comment">// 导航栏背景颜色</span></span><br><span class="line">        <span class="attr">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;TransWe&quot;</span>,  <span class="comment">// 导航栏标题文字内容</span></span><br><span class="line">        <span class="attr">&quot;navigationBarTextStyle&quot;</span>: <span class="string">&quot;black&quot;</span>,  <span class="comment">// 导航栏标题颜色</span></span><br><span class="line">        <span class="attr">&quot;backgroundColor&quot;</span>: <span class="string">&quot;#4b3c96&quot;</span>,  <span class="comment">// 窗口的背景颜色</span></span><br><span class="line">        <span class="attr">&quot;navigationStyle&quot;</span>: <span class="string">&quot;custom&quot;</span>  <span class="comment">// 导航栏样式</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 插件的声明</span></span><br><span class="line">    <span class="attr">&quot;plugins&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;WechatSI&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;0.3.3&quot;</span>,  <span class="comment">// 插件的版本</span></span><br><span class="line">            <span class="attr">&quot;provider&quot;</span>: <span class="string">&quot;wx069ba97219f66d99&quot;</span>  <span class="comment">// 插件的提供者</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;sitemapLocation&quot;</span>: <span class="string">&quot;sitemap.json&quot;</span>,  <span class="comment">// 小程序的站点地图文件位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 底部 tab 栏的表现</span></span><br><span class="line">    <span class="attr">&quot;tabBar&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;borderStyle&quot;</span>: <span class="string">&quot;white&quot;</span>,  <span class="comment">// tab 的边框颜色</span></span><br><span class="line">        <span class="attr">&quot;position&quot;</span>: <span class="string">&quot;bottom&quot;</span>,  <span class="comment">// tab 的位置</span></span><br><span class="line">        <span class="attr">&quot;color&quot;</span>: <span class="string">&quot;#bfbfbf&quot;</span>,  <span class="comment">// tab 的默认颜色</span></span><br><span class="line">        <span class="attr">&quot;selectedColor&quot;</span>: <span class="string">&quot;#1c1b21&quot;</span>,  <span class="comment">// tab 被选中时的颜色</span></span><br><span class="line">        <span class="attr">&quot;list&quot;</span>: [  <span class="comment">// tab 的列表，顺序与显示的顺序一致</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">&quot;pagePath&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;翻译&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;iconPath&quot;</span>: <span class="string">&quot;imgs/icon-1.png&quot;</span>,  <span class="comment">// 未选中时的图标路径</span></span><br><span class="line">                <span class="attr">&quot;selectedIconPath&quot;</span>: <span class="string">&quot;imgs/sel-icon-1.png&quot;</span>  <span class="comment">// 选中时的图标路径</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">&quot;pagePath&quot;</span>: <span class="string">&quot;pages/getPic/getPic&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;拍照翻译&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;iconPath&quot;</span>: <span class="string">&quot;imgs/paizhao-xianxing.png&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;selectedIconPath&quot;</span>: <span class="string">&quot;imgs/paizhao.png&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">&quot;pagePath&quot;</span>: <span class="string">&quot;pages/voice_translation/voice_translation&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;语音翻译&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;iconPath&quot;</span>: <span class="string">&quot;imgs/maikefeng-xianxing.png&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;selectedIconPath&quot;</span>: <span class="string">&quot;imgs/maikefeng.png&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">&quot;pagePath&quot;</span>: <span class="string">&quot;pages/history/history&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;历史&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;iconPath&quot;</span>: <span class="string">&quot;imgs/icon-2.png&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;selectedIconPath&quot;</span>: <span class="string">&quot;imgs/sel-icon-2.png&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="app.wxss">4.8.8.3 ./app.wxss</h4>
<p>这段代码是微信小程序的全局样式表<code>app.wxss</code>中的一部分。<code>.wxss</code>是微信小程序的样式语言，类似于
Web 的
CSS，可以设置小程序中的组件样式。这里定义了全局的样式规则，将在整个小程序范围内生效。</p>
<p>这段代码的主要作用是：</p>
<ul>
<li>定义了全局容器的样式，例如背景色、字体颜色和大小、布局方式等。</li>
<li>定义了版权信息的样式，例如字体颜色和大小、在容器中的位置等。</li>
<li>定义了视图在悬停时的背景颜色。</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 引入 iconfont 的样式文件 */</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">&quot;./assets/iconfont/iconfont.wxss&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 容器样式 */</span></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;  <span class="comment">/* 容器内边距设置为 0 */</span></span><br><span class="line">  <span class="attribute">background-color</span>:<span class="number">#f7f8f9</span>;  <span class="comment">/* 容器背景色 */</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;  <span class="comment">/* 容器高度设置为视口高度的100% */</span></span><br><span class="line">  <span class="attribute">display</span>: flex;  <span class="comment">/* 设置为弹性布局 */</span></span><br><span class="line">  <span class="attribute">flex-direction</span>:column;  <span class="comment">/* 设置主轴方向为垂直方向 */</span></span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;  <span class="comment">/* 盒模型设置为 border-box，即元素的 padding 和 border 在元素宽高内 */</span></span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">30</span>rpx;  <span class="comment">/* 字体大小设置为 30rpx */</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>;  <span class="comment">/* 字体颜色 */</span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">/* 版权信息样式 */</span></span><br><span class="line"><span class="selector-class">.copyright</span> &#123;</span><br><span class="line">  <span class="attribute">align-self</span>: center;  <span class="comment">/* 版权信息在交叉轴方向居中对齐 */</span></span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;  <span class="comment">/* flex 值为 1，使版权信息元素占据剩余的空间 */</span></span><br><span class="line">  <span class="attribute">display</span>: flex;  <span class="comment">/* 设置为弹性布局 */</span></span><br><span class="line">  <span class="attribute">align-items</span>: flex-end;  <span class="comment">/* 在交叉轴方向上，版权信息位于容器的底部 */</span></span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">20</span>rpx;  <span class="comment">/* 底部内边距设置为 20rpx */</span></span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28</span>rpx;  <span class="comment">/* 字体大小设置为 28rpx */</span></span><br><span class="line">  <span class="attribute">color</span>:<span class="number">#999</span>;  <span class="comment">/* 字体颜色 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 视图悬停样式 */</span></span><br><span class="line"><span class="selector-class">.view-hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f3f3f3</span><span class="meta">!important</span>;  <span class="comment">/* 视图的背景色设置为#f3f3f3，!important 表示优先级最高，如果有其他样式影响，该规则将覆盖其他规则 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="project.config.json">4.8.8.4 ./project.config.json</h4>
<p>这段代码是微信小程序的项目配置文件 <code>project.config.json</code>
的一部分。<code>project.config.json</code>
是微信小程序的项目配置文件，用于配置项目的相关信息，包括项目名，appid，编译设置等。</p>
<p>这个文件对于小程序项目的运行具有重要影响。例如，<code>appid</code>
字段设置了小程序的唯一标识，<code>es6</code> 字段决定了是否需要将 ES6
代码转为 ES5 代码以适应更多环境，<code>minified</code>
字段决定了是否需要压缩代码等。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;项目配置文件。&quot;</span>,  <span class="comment">// 项目描述</span></span><br><span class="line">  <span class="attr">&quot;packOptions&quot;</span>: &#123;  <span class="comment">// 打包配置项</span></span><br><span class="line">    <span class="attr">&quot;ignore&quot;</span>: [],  <span class="comment">// 打包时需要忽略的文件列表</span></span><br><span class="line">    <span class="attr">&quot;include&quot;</span>: []  <span class="comment">// 打包时需要包含的文件列表</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;setting&quot;</span>: &#123;  <span class="comment">// 设置项</span></span><br><span class="line">    <span class="attr">&quot;urlCheck&quot;</span>: <span class="literal">false</span>,  <span class="comment">// 是否开启url合法性检查</span></span><br><span class="line">    <span class="attr">&quot;es6&quot;</span>: <span class="literal">true</span>,  <span class="comment">// 是否启用ES6转ES5功能</span></span><br><span class="line">    <span class="attr">&quot;postcss&quot;</span>: <span class="literal">true</span>,  <span class="comment">// 是否启用PostCSS</span></span><br><span class="line">    <span class="attr">&quot;minified&quot;</span>: <span class="literal">true</span>,  <span class="comment">// 是否压缩代码</span></span><br><span class="line">    <span class="attr">&quot;ignoreDevUnusedFiles&quot;</span>: <span class="literal">false</span>,  <span class="comment">// 是否忽略开发模式下未引用的资源文件</span></span><br><span class="line">    <span class="attr">&quot;ignoreUploadUnusedFiles&quot;</span>: <span class="literal">false</span>,  <span class="comment">// 是否忽略上传模式下未引用的资源文件</span></span><br><span class="line">    <span class="attr">&quot;newFeature&quot;</span>: <span class="literal">true</span>,  <span class="comment">// 是否启用新的编译功能</span></span><br><span class="line">    <span class="attr">&quot;babelSetting&quot;</span>: &#123;  <span class="comment">// Babel 编译配置</span></span><br><span class="line">      <span class="attr">&quot;ignore&quot;</span>: [],  <span class="comment">// 需要忽略编译的文件列表</span></span><br><span class="line">      <span class="attr">&quot;disablePlugins&quot;</span>: [],  <span class="comment">// 需要禁用的插件列表</span></span><br><span class="line">      <span class="attr">&quot;outputPath&quot;</span>: <span class="string">&quot;&quot;</span>  <span class="comment">// 编译输出路径</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;condition&quot;</span>: <span class="literal">false</span>,  <span class="comment">// 条件编译</span></span><br><span class="line">    <span class="attr">&quot;skylineRenderEnable&quot;</span>: <span class="literal">false</span>  <span class="comment">// 是否开启3D渲染模式</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;compileType&quot;</span>: <span class="string">&quot;miniprogram&quot;</span>,  <span class="comment">// 编译类型为小程序</span></span><br><span class="line">  <span class="attr">&quot;libVersion&quot;</span>: <span class="string">&quot;2.32.0&quot;</span>,  <span class="comment">// 使用的基础库版本</span></span><br><span class="line">  <span class="attr">&quot;appid&quot;</span>: <span class="string">&quot;wx365790a8c04e3a3b&quot;</span>,  <span class="comment">// 小程序的appid</span></span><br><span class="line">  <span class="attr">&quot;projectname&quot;</span>: <span class="string">&quot;TransWe&quot;</span>,  <span class="comment">// 项目名称</span></span><br><span class="line">  <span class="attr">&quot;simulatorType&quot;</span>: <span class="string">&quot;wechat&quot;</span>,  <span class="comment">// 模拟器类型为微信</span></span><br><span class="line">  <span class="attr">&quot;simulatorPluginLibVersion&quot;</span>: &#123;&#125;,  <span class="comment">// 插件库版本（用于模拟器）</span></span><br><span class="line">  <span class="attr">&quot;condition&quot;</span>: &#123;&#125;,  <span class="comment">// 调试配置</span></span><br><span class="line">  <span class="attr">&quot;editorSetting&quot;</span>: &#123;  <span class="comment">// 编辑器设置</span></span><br><span class="line">    <span class="attr">&quot;tabIndent&quot;</span>: <span class="string">&quot;insertSpaces&quot;</span>,  <span class="comment">// 设置缩进为插入空格</span></span><br><span class="line">    <span class="attr">&quot;tabSize&quot;</span>: <span class="number">2</span>  <span class="comment">// 设置缩进大小为2个空格</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="project.private.config.json">4.8.8.5
./project.private.config.json</h4>
<p>这段代码是微信小程序的 <code>project.private.config.json</code>
文件的一部分。这个文件是一个私有配置文件，用于覆盖
<code>project.config.json</code>
中的同名字段，存储开发者在开发工具中改动的项目配置。当
<code>project.private.config.json</code> 与
<code>project.config.json</code> 中的字段冲突时，
<code>project.private.config.json</code> 的配置项会优先被应用。</p>
<p>这个配置文件有助于个别开发者或者团队在本地进行特定的设置，比如禁止URL检查或者开启热重载等，并且不会影响到其他的开发人员。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 项目描述，指出这是一个私有配置文件</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;项目私有配置文件。此文件中的内容将覆盖 project.config.json 中的相同字段。项目的改动优先同步到此文件中。详见文档：https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html&quot;</span>,</span><br><span class="line">  <span class="comment">// 项目名称</span></span><br><span class="line">  <span class="attr">&quot;projectname&quot;</span>: <span class="string">&quot;TransWe&quot;</span>,</span><br><span class="line">  <span class="comment">// 设置项</span></span><br><span class="line">  <span class="attr">&quot;setting&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// 是否启用编译热更新</span></span><br><span class="line">    <span class="attr">&quot;compileHotReLoad&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 是否开启URL合法性检查</span></span><br><span class="line">    <span class="attr">&quot;urlCheck&quot;</span>: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 调试配置</span></span><br><span class="line">  <span class="attr">&quot;condition&quot;</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="系统测试">4.2 系统测试</h2>
<h3 id="tdd测试">4.2.1 TDD测试</h3>
<h4 id="tdd_test_cdt-1">4.2.1.1 TDD_test_cdt/</h4>
<blockquote>
<p>语音翻译测试</p>
</blockquote>
<ol type="1">
<li>测试用例（中翻英）</li>
</ol>
<table>
<thead>
<tr class="header">
<th>输入</th>
<th>期望输出</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>华中科技大学</td>
<td>Huazhong University of Science and Technology</td>
</tr>
<tr class="even">
<td>我来自武汉</td>
<td>I am from Wuhan</td>
</tr>
<tr class="odd">
<td>如何进入校园</td>
<td>How to enter the campus</td>
</tr>
<tr class="even">
<td>用户的要求是绝对的</td>
<td>User requirements are absolute</td>
</tr>
</tbody>
</table>
<ol start="2" type="1">
<li>测试结果</li>
</ol>
<ul>
<li>测试点1</li>
</ul>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/SS_TDD_VoiceTrans_1.png&quot; width=&quot;50%&quot; /&gt;</code></pre>
</div>
<ul>
<li>测试点2</li>
</ul>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/SS_TDD_VoiceTrans_2.png&quot; width=&quot;50%&quot; /&gt;</code></pre>
</div>
<ul>
<li>测试点3</li>
</ul>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/SS_TDD_VoiceTrans_3.png&quot; width=&quot;50%&quot; /&gt;</code></pre>
</div>
<ul>
<li>测试点4</li>
</ul>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/SS_TDD_VoiceTrans_4.png&quot; width=&quot;50%&quot; /&gt;</code></pre>
</div>
<p>测试通过数（4/4）</p>
<h4 id="tdd_test_zxk-1">4.2.1.2 TDD_test_zxk/</h4>
<p>基于Mocha框架编写的测试文本翻译Javascript的测试程序。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入测试库</span></span><br><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">&#x27;assert&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> translate = <span class="built_in">require</span>(<span class="string">&#x27;./translate&#x27;</span>);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;translate function&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    it(<span class="string">&#x27;should translate &quot;software&quot; to Chinese correctly&#x27;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> translate(<span class="string">&#x27;software&#x27;</span>, <span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;zh&#x27;</span>);</span><br><span class="line">        assert.strictEqual(result, <span class="string">&#x27;软件&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">&#x27;should translate &quot;software@&quot; to Chinese correctly&#x27;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> translate(<span class="string">&#x27;software&#x27;</span>, <span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;zh&#x27;</span>);</span><br><span class="line">        assert.strictEqual(result, <span class="string">&#x27;软件@&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">&#x27;should handle space correctly&#x27;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> translate(<span class="string">&#x27;hello world&#x27;</span>, <span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;zh&#x27;</span>);</span><br><span class="line">        assert.strictEqual(result, <span class="string">&#x27;你好世界&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">&#x27;should handle error correctly&#x27;</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">await</span> translate(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;zh&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            assert.strictEqual(e.message, <span class="string">&#x27;Invalid input&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>若要进行测试，请在正确安装相关框架的情况下运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mocha .\translate.test.js</span><br></pre></td></tr></table></figure>
<p>测试成功会显示下列截图：</p>
<p><img src="/report/se-report/Mocha_success.png"></p>
<h1 id="系统界面展示">5. 系统界面展示</h1>
<h2 id="index-主页">5.1 index | 主页</h2>
<p>在主页中：</p>
<ul>
<li>用户在输入框中输入待翻译的文本，<strong>程序会自动检测输入语言</strong>，用户在下拉菜单中选择相应的目标语言。</li>
<li>用户也可以<strong>手动选择输入语言</strong>。输入完成后，程序将进行翻译并在输出框中显示翻译结果。</li>
<li>用户可以点击小喇叭按钮，调用语音合成功能，听到翻译结果。</li>
<li>用户可以点击剪贴板按钮，待翻译文本或翻译结果会自动复制到用户的剪贴板。</li>
<li>用户可以点击下方的翻译历史板块，跳转到翻译历史页面。</li>
<li>用户可以点击最下方的导航栏跳转到对应的界面。</li>
</ul>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/ScreenShots/SS_index_1.jpg&quot; width=&quot;30%&quot; /&gt;
&lt;img src=&quot;./se-report/ScreenShots/SS_index_2.jpg&quot; width=&quot;30%&quot; /&gt;
&lt;img src=&quot;./se-report/ScreenShots/SS_index_3.jpg&quot; width=&quot;30%&quot; /&gt;</code></pre>
</div>
<h2 id="choose_language-选择语言界面">5.2 choose_language |
选择语言界面</h2>
<ul>
<li>在选择语言界面选择翻译语言和目标语言</li>
</ul>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/ScreenShots/SS_chooselanguage1.jpg&quot; width=&quot;30%&quot; /&gt;
&lt;img src=&quot;./se-report/ScreenShots/SS_chooselanguage4.jpg&quot; width=&quot;30%&quot; /&gt;
&lt;img src=&quot;./se-report/ScreenShots/SS_chooselanguage3.jpg&quot; width=&quot;30%&quot; /&gt;</code></pre>
</div>
<ul>
<li>可以看到，翻译页面根据语言选择进行了及时的更新</li>
</ul>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/ScreenShots/SS_chooselanguage2.jpg&quot; width=&quot;30%&quot; /&gt;
&lt;img src=&quot;./se-report/ScreenShots/SS_chooselanguage5.jpg&quot; width=&quot;30%&quot; /&gt;
&lt;img src=&quot;./se-report/ScreenShots/SS_chooselanguage6.jpg&quot; width=&quot;30%&quot; /&gt;</code></pre>
</div>
<h2 id="getpic-拍照界面">5.3 getPic | 拍照界面</h2>
<p>在这个界面，用户点击拍照按钮可以进行拍照，并进入拍照翻译的结果页面。</p>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/ScreenShots/SS_getPic.jpg&quot; width=&quot;30%&quot; /&gt;</code></pre>
</div>
<h2 id="ocr-拍照翻译结果">5.4 OCR | 拍照翻译结果</h2>
<p>在这个界面，点击翻译图片，小程序会进行OCR识别并进行翻译，将结果显示在屏幕上。</p>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/ScreenShots/SS_OCR.jpg&quot; width=&quot;30%&quot; /&gt;</code></pre>
</div>
<h2 id="voice_translation-语音翻译页面">5.5 voice_translation |
语音翻译页面</h2>
<p>语音翻译页面，点击切换按钮改变录音语言。</p>
<p><img src="/report/se-report/ScreenShots/SS_voice1.jpg" width="30%"></p>
<p><img src="/report/se-report/ScreenShots/SS_voice2.jpg" width="30%"></p>
<p>长按录音按钮，按钮样式改变，出现文字提示正在录音，翻译的结果会以卡片的形式保存在本地。</p>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/ScreenShots/SS_voice3.jpg&quot; width=&quot;30%&quot; /&gt;
&lt;img src=&quot;./se-report/ScreenShots/SS_voice4.jpg&quot; width=&quot;30%&quot; /&gt;
&lt;img src=&quot;./se-report/ScreenShots/SS_voice5.jpg&quot; width=&quot;30%&quot; /&gt;</code></pre>
</div>
<p>在卡片右侧对应两个组件，分别代表编辑文本和语音合成。</p>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/ScreenShots/SS_voice6.png&quot; width=&quot;30%&quot; /&gt;
&lt;img src=&quot;./se-report/ScreenShots/SS_voice11.jpg&quot; width=&quot;30%&quot; /&gt;</code></pre>
</div>
<p>长按卡片出现弹窗，功能包括复制文本以及删除不用的卡片。</p>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/ScreenShots/SS_voice12.jpg&quot; width=&quot;30%&quot; /&gt;
&lt;img src=&quot;./se-report/ScreenShots/SS_voice13.jpg&quot; width=&quot;30%&quot; /&gt;
 &lt;img src=&quot;./se-report/ScreenShots/SS_voice14.jpg&quot; width=&quot;30%&quot; /&gt;</code></pre>
</div>
<h2 id="edit-文本编辑界面">5.6 edit | 文本编辑界面</h2>
<p>考虑到用户录音时可能会因为录音失误导致录入的文本有误，为避免用户重新录音的麻烦，允许编辑录音文本，为用户带来更好的体验。</p>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/ScreenShots/SS_voice7.jpg&quot; width=&quot;30%&quot; /&gt;
&lt;img src=&quot;./se-report/ScreenShots/SS_voice8.jpg&quot; width=&quot;30%&quot; /&gt;</code></pre>
</div>
<p>设置了最大输入文本限制，用户可以看到剩余可输入文字，点击清空按钮可以快速清除文字</p>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/ScreenShots/SS_voice9.jpg&quot; width=&quot;30%&quot; /&gt;
&lt;img src=&quot;./se-report/ScreenShots/SS_voice10.jpg&quot; width=&quot;30%&quot; /&gt;</code></pre>
</div>
<h2 id="history-翻译历史">5.7 history | 翻译历史</h2>
<p>在这个界面，用户可以查看使用小程序的翻译历史，点击对应的翻译历史可以跳转到主页查看翻译结果。</p>
<div data-align="center">
<pre><code>&lt;img src=&quot;./se-report/ScreenShots/SS_history.jpg&quot; width=&quot;30%&quot; /&gt;</code></pre>
</div>
<h1 id="总结">6. 总结</h1>
<p>在这个课程设计项目中，我们的团队开发了一个名为TransWe的微信小程序。这是一个强大的机器翻译工具，它的核心功能是能够快速准确地翻译各种语言。但是，我们并没有止步于此，我们还集成了第三方OCR、语音识别和语音合成服务，这些功能的加入使得TransWe不仅仅是一个翻译工具，更是一个全方位的语言服务平台，为用户提供了更便捷、高效的翻译服务。</p>
<p>在这个过程中，我们深入了解了微信小程序的开发流程和特性。微信小程序的特性如页面跳转、图片上传、音频播放等，都被我们充分利用，以实现TransWe的各项功能。同时，我们也学习了如何利用第三方服务来增强小程序的功能性和用户体验。例如，我们利用OCR服务实现了图片中文本的识别，利用语音识别和语音合成服务实现了语音翻译功能，这些都大大提高了TransWe的用户体验。</p>
<p>在代码实现方面，我们遵循了良好的编程习惯。我们的代码结构清晰，每个函数、每个模块都有其明确的职责；我们的命名规范，变量名、函数名都能准确地反映其功能；我们的注释详细，每一段重要的代码都有相应的注释，方便后续的维护和修改。这些都是我们在软件工程课程中学到的重要知识，也是我们在实际开发过程中得到应用的地方。</p>
<p>然而，这个项目的开发过程并非一帆风顺。我们遇到了一些挑战，如API调用的问题、图片大小限制的问题等。但是，我们并没有因此而退缩，我们通过查阅文档、搜索解决方案、反复测试等方式，最终都成功地解决了这些问题。这个过程不仅锻炼了我们的问题解决能力，也让我们更加深入地理解了软件开发的实际过程。</p>
<p>总的来说，这个课程设计项目是一次非常宝贵的实践经验。它不仅提升了我们的编程技能，也锻炼了我们的问题解决能力。同时，看到自己的作品能够真正地帮助到用户，也是一种非常满足的感觉。我们深感，软件开发不仅仅是编写代码，更是解决问题，满足用户需求的过程。<strong>我们将带着这次的经验和教训，继续在软件工程的道路上探索和前进。</strong></p>
<h1 id="理论课实验报告">7. 理论课实验报告</h1>
<blockquote>
<p>下面是软件工程理论课的实验报告：重构实验，寻找代码中的坏味道。</p>
</blockquote>
<h2 id="一实验目的内容和要求">一、实验目的、内容和要求</h2>
<h3 id="实验名称">1.1 实验名称</h3>
<ul>
<li>重构实验</li>
</ul>
<h3 id="实验目的">1.2 实验目的</h3>
<ul>
<li><p>理解重构在软件开发中的作用</p></li>
<li><p>熟悉常见的代码环味道和重构方法</p></li>
</ul>
<h3 id="实验内容和要求">1.3 实验内容和要求</h3>
<ul>
<li><p>阅读：Martin Fowler 《重构-改善既有代码的设计》</p></li>
<li><p>掌握你认为最常见的8种代码坏味道及其重构方法</p></li>
<li><p>从你过去写过的代码或Github等开源代码库上寻找这8种坏味道，并对代码进行重构；反对拷贝别人重构例子。</p></li>
</ul>
<h2 id="二代码重构">二、代码重构</h2>
<h3 id="重构1神秘命名mysterious-name">2.1 重构1：神秘命名（Mysterious
Name）</h3>
<h4 id="坏味道代码">2.1.1 坏味道代码</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    c = a + b</span><br><span class="line">    <span class="keyword">return</span> c</span><br></pre></td></tr></table></figure>
<p>这段代码来自我初学python时写的<code>HelloWorld.py</code>
文件，代码定义了一个函数，这个函数的输入是两个数a, b；输出是a + b。</p>
<h4 id="坏味道说明">2.1.2 坏味道说明</h4>
<p>“神秘命名”是一种常见的坏味道，它指的是在代码中使用没有明确含义的变量、函数、类、模块等命名。这些命名往往缺乏清晰的语义和上下文，让其他开发人员难以理解代码的意图和目的。这可能导致代码可读性和可维护性的下降，并且增加了调试和重构代码的难度。</p>
<p>神秘命名的危害在于它会导致代码难以理解和维护。当其他开发人员需要在代码中添加新的功能或者修改代码时，他们可能需要花费更多的时间来理解这些命名的含义和作用。这可能导致开发时间的延长和错误的引入，从而降低了代码质量和开发效率。</p>
<h4 id="重构方法">2.1.3 重构方法</h4>
<p>为了解决神秘命名的问题，可以采取以下重构方法：</p>
<ol type="1">
<li>更改命名：将神秘的命名更改为更有意义和描述性的名称，使代码更易于理解和维护。</li>
<li>引入注释：在代码中添加注释可以帮助其他开发人员理解变量、函数、类等的含义和用途，特别是在一些情况下，无法通过名称清楚地表达其意图时。</li>
<li>优化命名规范：制定良好的命名规范并将其应用于整个代码库可以减少神秘命名的发生。在规范中，定义变量、函数、类、模块等的命名规则，并尽可能遵循这些规则。</li>
</ol>
<h4 id="重构后代码">2.1.4 重构后代码</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a, b</span>):</span> <span class="comment"># a, b represent the two addend number</span></span><br><span class="line">    result = a + b</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<h3 id="重构2重复代码duplicated-code">2.2 重构2：重复代码（Duplicated
Code）</h3>
<h4 id="坏味道代码-1">2.2.1 坏味道代码</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cow movement</span></span><br><span class="line"><span class="keyword">if</span>(cow.direction == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(map[cow.x][cow.y - <span class="number">1</span>] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">        cow.direction = (cow.direction + <span class="number">1</span> ) % <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        cow.y--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(cow.direction == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(map[cow.x + <span class="number">1</span>][cow.y] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">        cow.direction = (cow.direction + <span class="number">1</span> ) % <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        cow.x++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(cow.direction == <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(map[cow.x][cow.y + <span class="number">1</span>] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">        cow.direction = (cow.direction + <span class="number">1</span> ) % <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        cow.y++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(cow.direction == <span class="number">3</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(map[cow.x - <span class="number">1</span>][cow.y] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">        cow.direction = (cow.direction + <span class="number">1</span> ) % <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        cow.x--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// farmer movement</span></span><br><span class="line"><span class="keyword">if</span>(framer.direction == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(map[framer.x][framer.y - <span class="number">1</span>] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">        framer.direction = (framer.direction + <span class="number">1</span> ) % <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        framer.y--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(framer.direction == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(map[framer.x + <span class="number">1</span>][framer.y] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">        framer.direction = (framer.direction + <span class="number">1</span> ) % <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        framer.x++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(framer.direction == <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(map[framer.x][framer.y + <span class="number">1</span>] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">        framer.direction = (framer.direction + <span class="number">1</span> ) % <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        framer.y++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(framer.direction == <span class="number">3</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(map[framer.x - <span class="number">1</span>][framer.y] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">        framer.direction = (framer.direction + <span class="number">1</span> ) % <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        framer.x--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码来源：我自己写的一道算法题<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1518">USACO2.4两只塔姆沃斯牛 The
Tamworth Two</a>，这段代码的作用是控制农夫和牛在地图中方向的移动。</p>
<h4 id="坏味道说明-1">2.2.2 坏味道说明</h4>
<p>“重复代码”是一种常见的坏味道，它指的是代码中存在多个相同或非常相似的代码片段。这些重复的代码可能存在于同一个文件、不同的文件或不同的代码库中，但它们执行的功能相同或者非常相似。</p>
<p>重复代码的危害在于它会导致代码冗余和维护困难。如果存在多个相同或相似的代码片段，每次需要修改功能时，必须修改所有重复的代码。这会增加代码的维护难度，并且可能导致错误的引入。此外，重复的代码还会占用更多的内存和磁盘空间，从而导致代码库变得更加庞大和不易维护。</p>
<h4 id="重构方法-1">2.2.3 重构方法</h4>
<p>为了解决重复代码的问题，我们可以采取以下重构方法：</p>
<ol type="1">
<li>提取方法：将重复的代码段提取到一个独立的方法中，并在需要时调用该方法。这可以减少重复代码并提高代码的可重用性。</li>
<li>抽象公共方法：如果有多个代码段具有相同的结构，可以将它们抽象为一个通用方法，并在需要时使用。这可以减少重复代码的数量并提高代码的可维护性。</li>
</ol>
<h4 id="重构后代码-1">2.2.4 重构后代码</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">(object&amp; obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(obj.direction == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(map[obj.x][obj.y - <span class="number">1</span>] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">            obj.direction = (obj.direction + <span class="number">1</span> ) % <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            obj.y--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(obj.direction == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(map[obj.x + <span class="number">1</span>][obj.y] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">            obj.direction = (obj.direction + <span class="number">1</span> ) % <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            obj.x++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(obj.direction == <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(map[obj.x][obj.y + <span class="number">1</span>] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">            obj.direction = (obj.direction + <span class="number">1</span> ) % <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            obj.y++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(obj.direction == <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(map[obj.x - <span class="number">1</span>][obj.y] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">            obj.direction = (obj.direction + <span class="number">1</span> ) % <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            obj.x--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">move</span>(cow);</span><br><span class="line">	<span class="built_in">move</span>(framer);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="重构3过长函数long-function">2.3 重构3：过长函数（Long
Function）</h3>
<h4 id="坏味道代码-2">2.3.1 坏味道代码</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn (2023)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x &gt; y ? x : y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> a[maxn], b[maxn], ans[maxn &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string s1, s2;</span><br><span class="line">    cin &gt;&gt; s1 &gt;&gt; s2;</span><br><span class="line">    <span class="keyword">for</span> (re <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s1.<span class="built_in">length</span>(); i++)</span><br><span class="line">        a[i] = s1[s1.<span class="built_in">length</span>() - <span class="number">1</span> - i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (re <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s2.<span class="built_in">length</span>(); i++)</span><br><span class="line">        b[i] = s2[s2.<span class="built_in">length</span>() - <span class="number">1</span> - i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (re <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s1.<span class="built_in">length</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (re <span class="keyword">int</span> j = <span class="number">0</span>; j &lt; s2.<span class="built_in">length</span>(); j++)</span><br><span class="line">        &#123;</span><br><span class="line">            ans[i + j] += a[i] * b[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (re <span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= (maxn &lt;&lt; <span class="number">1</span>); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ans[i] &gt;= <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            ans[i + <span class="number">1</span>] += ans[i] / <span class="number">10</span>;</span><br><span class="line">            ans[i] %= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> tmp = maxn &lt;&lt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (ans[tmp] == <span class="number">0</span> &amp;&amp; tmp &gt; <span class="number">0</span>) tmp--;</span><br><span class="line">    <span class="keyword">if</span>(tmp == <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="keyword">int</span> i = tmp; i &gt;= <span class="number">0</span> ; i--)</span><br><span class="line">        cout &lt;&lt; ans[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码是我利用C语言实现的高精度乘法，可以对两个<span class="math inline">\(10^{20}\)</span>
的超级大整数相乘，采用数组模拟乘法的相乘与进位，思路是消耗空间换取时间。</p>
<h4 id="坏味道说明-2">2.3.2 坏味道说明</h4>
<p>过长函数是指代码中某个函数过于冗长复杂，超过应有的长度限制，使得代码难以阅读、理解和维护。这种坏味道的存在会导致代码质量下降、可读性差、出错率高等问题，并且难以重用或调试。比如这段代码中一连串的for代码根本让人不知所云。</p>
<h4 id="重构方法-2">2.3.3 重构方法</h4>
<p>对于过长函数的重构，考虑以下思路：</p>
<ol type="1">
<li>拆分函数：将一个函数按照不同的职责或功能进行拆分，形成多个小函数，每个小函数只负责一项具体的工作，这样可以降低单个函数的复杂度和长度。</li>
<li>提取方法：将函数中的某些独立操作提取为新的方法，以减少代码重复和提高重用性。</li>
<li>优化参数列表：如果函数参数列表过长，可以考虑将其中的相关参数放置在同一个对象中，以简化函数的参数列表并提高代码可读性。</li>
<li>使用注释：对于一些长函数，可以使用注释来标识代码的不同执行分支或处理步骤，以提高代码可读性。</li>
</ol>
<h4 id="重构后代码-2">2.3.4 重构后代码</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn (2023)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x &gt; y ? x : y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> a[maxn], b[maxn], ans[maxn &lt;&lt; <span class="number">1</span>];</span><br><span class="line">string s1, s2;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">multiple</span><span class="params">(<span class="keyword">int</span> *a, <span class="keyword">int</span> *b)</span> <span class="comment">// 采用数组模拟乘法的相乘与进位</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (re <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s1.<span class="built_in">length</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (re <span class="keyword">int</span> j = <span class="number">0</span>; j &lt; s2.<span class="built_in">length</span>(); j++)</span><br><span class="line">        &#123;</span><br><span class="line">            ans[i + j] += a[i] * b[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (re <span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= (maxn &lt;&lt; <span class="number">1</span>); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ans[i] &gt;= <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            ans[i + <span class="number">1</span>] += ans[i] / <span class="number">10</span>;</span><br><span class="line">            ans[i] %= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> <span class="comment">// 从高位到低位进行输出</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp = maxn &lt;&lt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (ans[tmp] == <span class="number">0</span> &amp;&amp; tmp &gt; <span class="number">0</span>) tmp--;</span><br><span class="line">    <span class="keyword">if</span>(tmp == <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="keyword">int</span> i = tmp; i &gt;= <span class="number">0</span> ; i--)</span><br><span class="line">        cout &lt;&lt; ans[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; s1 &gt;&gt; s2;</span><br><span class="line">    <span class="keyword">for</span> (re <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s1.<span class="built_in">length</span>(); i++)</span><br><span class="line">        a[i] = s1[s1.<span class="built_in">length</span>() - <span class="number">1</span> - i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (re <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s2.<span class="built_in">length</span>(); i++)</span><br><span class="line">        b[i] = s2[s2.<span class="built_in">length</span>() - <span class="number">1</span> - i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="built_in">multiple</span>(a, b);</span><br><span class="line">    <span class="built_in">print</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="重构4过长参数列表long-parameter-list">2.4
重构4:过长参数列表（Long Parameter List）</h3>
<h4 id="坏味道代码-3">2.4.1 坏味道代码</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate_score</span>(<span class="params">name, age, gender, height, weight, math_score, english_score, chinese_score</span>):</span></span><br><span class="line">    score = (math_score + english_score + chinese_score) / <span class="number">3</span></span><br><span class="line">    <span class="keyword">if</span> gender == <span class="string">&quot;male&quot;</span>:</span><br><span class="line">        <span class="keyword">if</span> age &gt; <span class="number">20</span> <span class="keyword">and</span> height &gt; <span class="number">175</span> <span class="keyword">and</span> weight &lt; <span class="number">80</span>:</span><br><span class="line">            score += <span class="number">10</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> age &gt; <span class="number">18</span> <span class="keyword">and</span> height &gt; <span class="number">165</span> <span class="keyword">and</span> weight &lt; <span class="number">60</span>:</span><br><span class="line">            score += <span class="number">10</span></span><br><span class="line">    <span class="keyword">return</span> score</span><br></pre></td></tr></table></figure>
<p>该代码来自我在学习python的面向对象的概念是完成的学生成绩管理系统，这段代码的作用是根据学生的性别，身高，体重，成绩等数据计算学生的分数并进行返回。</p>
<h4 id="坏味道说明-3">2.4.2 坏味道说明</h4>
<p>“过长参数列表”是指函数或方法的参数数量过多或者参数类型过于复杂，导致函数声明或调用代码难以阅读和理解。这种坏味道可能导致代码的可维护性和可读性降低，同时也会增加代码的复杂度和错误的引入。</p>
<p>过长参数列表的危害在于它会导致代码难以理解和维护。当其他开发人员需要在代码中添加新的功能或者修改代码时，他们可能需要花费更多的时间来理解参数的作用和顺序。这可能导致开发时间的延长和错误的引入，从而降低了代码质量和开发效率。</p>
<h4 id="重构方法-3">2.4.3 重构方法</h4>
<p>为了解决过长参数列表的问题，我们可以采取以下重构方法：</p>
<ol type="1">
<li>重构为对象：将参数封装成一个对象，并将该对象作为参数传递给函数。这样可以减少函数的参数数量，提高代码的可读性和可维护性。</li>
<li>使用默认值：对于一些不是必须的参数，可以设置默认值来避免在调用函数时传递参数。</li>
<li>重构为多个函数：如果一个函数的参数过多，可以考虑将其拆分成多个较小的函数，每个函数只需要少量的参数。</li>
<li>重构为参数对象：将多个参数封装成一个参数对象，并在函数声明中只传递一个参数对象。这样可以减少函数的参数数量，提高代码的可读性和可维护性。</li>
</ol>
<p>通过上述重构方法，我们可以减少函数的参数数量，提高代码的可读性和可维护性，避免过长参数列表带来的问题。</p>
<h4 id="重构后代码-3">2.4.4 重构后代码</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age, gender, height, weight, math_score, english_score, chinese_score</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.gender = gender</span><br><span class="line">        self.height = height</span><br><span class="line">        self.weight = weight</span><br><span class="line">        self.math_score = math_score</span><br><span class="line">        self.english_score = english_score</span><br><span class="line">        self.chinese_score = chinese_score</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calculate_score</span>(<span class="params">self</span>):</span></span><br><span class="line">        score = (self.math_score + self.english_score + self.chinese_score) / <span class="number">3</span></span><br><span class="line">        <span class="keyword">if</span> self.gender == <span class="string">&quot;male&quot;</span>:</span><br><span class="line">            <span class="keyword">if</span> self.age &gt; <span class="number">20</span> <span class="keyword">and</span> self.height &gt; <span class="number">175</span> <span class="keyword">and</span> self.weight &lt; <span class="number">80</span>:</span><br><span class="line">                score += <span class="number">10</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> self.age &gt; <span class="number">18</span> <span class="keyword">and</span> self.height &gt; <span class="number">165</span> <span class="keyword">and</span> self.weight &lt; <span class="number">60</span>:</span><br><span class="line">                score += <span class="number">10</span></span><br><span class="line">        <span class="keyword">return</span> score</span><br></pre></td></tr></table></figure>
<h3 id="重构5-全局数据global-data">2.5 重构5: 全局数据（Global
Data）</h3>
<h4 id="坏味道代码-4">2.5.1 坏味道代码</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> re register</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;<span class="keyword">return</span> x &gt; y ? x : y;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a[<span class="number">505</span>], b[<span class="number">505</span>], ans[<span class="number">505</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string s1, s2;</span><br><span class="line">    <span class="keyword">int</span> maxn;</span><br><span class="line">    cin &gt;&gt; s1 &gt;&gt; s2;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s1.<span class="built_in">length</span>(); i++)    </span><br><span class="line">        a[i] = s1[s1.<span class="built_in">length</span>() - <span class="number">1</span> - i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s2.<span class="built_in">length</span>(); i++)    </span><br><span class="line">        b[i] = s2[s2.<span class="built_in">length</span>() - <span class="number">1</span> - i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    maxn = <span class="built_in">max</span>(s1.<span class="built_in">length</span>(), s2.<span class="built_in">length</span>());</span><br><span class="line">    <span class="comment">// cout &lt;&lt; maxn &lt;&lt; endl;</span></span><br><span class="line">    <span class="keyword">for</span> (re <span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= maxn; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ans[i] += a[i] + b[i];</span><br><span class="line">        <span class="keyword">if</span>(ans[i] &gt;= <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            ans[i] -= <span class="number">10</span>;</span><br><span class="line">            ans[i+<span class="number">1</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ans[maxn] != <span class="number">0</span>) cout &lt;&lt; ans[maxn];</span><br><span class="line">    <span class="keyword">for</span>(re <span class="keyword">int</span> i = maxn - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        cout &lt;&lt; ans[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="坏味道说明-4">2.5.2 坏味道说明</h4>
<p>全局数据是指在整个程序中可被访问的数据，它们可以是全局变量、静态变量或常量等。这种坏味道的存在会导致代码的耦合度高、可维护性差、扩展性低等问题。</p>
<p>全局数据的危害包括：</p>
<ol type="1">
<li>导致代码依赖复杂：由于全局数据可以被整个程序的任何部分引用和修改，因此当多个模块之间共享同一个全局数据时，代码的依赖关系变得非常复杂，使得代码难以理解和维护。</li>
<li>难以进行单元测试：全局数据的存在会影响到模块的独立性，使得模块的单元测试变得困难，需要考虑全局数据的状态和影响范围。</li>
<li>安全性问题：全局数据容易被不同模块同时访问和修改，这可能导致数据的竞争条件和安全漏洞。</li>
</ol>
<h4 id="重构方法-4">2.5.3 重构方法</h4>
<p>针对全局数据的坏味道，考虑以下重构方法：将全局数据转换为局部数据：将全局变量转化为函数参数或返回值，将静态变量转化为函数内的局部变量，这样可以减少对全局数据的依赖，提高代码的独立性和可维护性。</p>
<h4 id="重构后代码-4">2.5.4 重构后代码</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> re register</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;<span class="keyword">return</span> x &gt; y ? x : y;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> *<span class="title">add</span><span class="params">(<span class="keyword">int</span> *a, <span class="keyword">int</span> *b)</span> <span class="comment">// 执行按位加法，采用传递地址的方式避免使用全局变量</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (re <span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= maxn; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ans[i] += a[i] + b[i];</span><br><span class="line">        <span class="keyword">if</span>(ans[i] &gt;= <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            ans[i] -= <span class="number">10</span>;</span><br><span class="line">            ans[i+<span class="number">1</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a[<span class="number">505</span>], b[<span class="number">505</span>], ans[<span class="number">505</span>];</span><br><span class="line">    string s1, s2;</span><br><span class="line">    <span class="keyword">int</span> maxn;</span><br><span class="line">    cin &gt;&gt; s1 &gt;&gt; s2;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s1.<span class="built_in">length</span>(); i++)    </span><br><span class="line">        a[i] = s1[s1.<span class="built_in">length</span>() - <span class="number">1</span> - i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s2.<span class="built_in">length</span>(); i++)    </span><br><span class="line">        b[i] = s2[s2.<span class="built_in">length</span>() - <span class="number">1</span> - i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    maxn = <span class="built_in">max</span>(s1.<span class="built_in">length</span>(), s2.<span class="built_in">length</span>());</span><br><span class="line">    <span class="comment">// cout &lt;&lt; maxn &lt;&lt; endl;</span></span><br><span class="line">    ans = <span class="built_in">add</span>(a, b);</span><br><span class="line">    <span class="keyword">if</span>(ans[maxn] != <span class="number">0</span>) cout &lt;&lt; ans[maxn];</span><br><span class="line">    <span class="keyword">for</span>(re <span class="keyword">int</span> i = maxn - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        cout &lt;&lt; ans[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="可变数据">2.6 可变数据</h3>
<h4 id="坏味道代码-5">2.6.1 坏味道代码</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> b, p, k;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">qpow</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> a, <span class="keyword">long</span> <span class="keyword">long</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>)</span><br><span class="line">            ans = (ans * a) % k;</span><br><span class="line">        a = (a * a) % k;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ans %= k;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld&quot;</span>, &amp;b, &amp;p, &amp;k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld^%lld mod %lld=%lld\n&quot;</span>, b, p, k, <span class="built_in">qpow</span>(b, p));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码是我自己写的快速幂，通过二分的思想将求取<span class="math inline">\(a^b\)</span>的算法从O(n)的复杂度降低至O(log
n)，在处理需要大量幂运算的程序中大大提高了程序的运行效率。</p>
<h4 id="坏味道说明-5">2.6.2 坏味道说明</h4>
<p>可变数据是指在函数中修改了参数的值，导致代码的可读性差、维护成本高、易出现意外错误。重构的方法是尽可能避免修改参数的值，可以采用复制、封装成类等方式避免修改参数的值。</p>
<h4 id="重构方法-5">2.6.3 重构方法</h4>
<p>要消除可变数据的坏味道，可以使用以下重构方法：将可变数据的修改范围限制在单个函数内部。通过定义局部变量，可以确保变量的生命周期仅限于该函数，并且不会泄露到程序的其他部分。</p>
<h4 id="重构后代码-5">2.6.4 重构后代码</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> b, p, k;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">qpow</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> a, <span class="keyword">long</span> <span class="keyword">long</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> tmp = b; <span class="comment">// 避免对参数进行直接修改</span></span><br><span class="line">    <span class="keyword">while</span> (b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>)</span><br><span class="line">            ans = (ans * a) % k;</span><br><span class="line">        a = (a * a) % k;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ans %= k;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld&quot;</span>, &amp;b, &amp;p, &amp;k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld^%lld mod %lld=%lld\n&quot;</span>, b, p, k, <span class="built_in">qpow</span>(b, p));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="重构7-发散式变化divergent-change">2.7 重构7:
发散式变化（Divergent Change）</h3>
<h4 id="坏味道代码-6">2.7.1 坏味道代码</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, width, height</span>):</span></span><br><span class="line">        self.width = width</span><br><span class="line">        self.height = height</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_area</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.width * self.height</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, side</span>):</span></span><br><span class="line">        self.side = side</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_area</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.side ** <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>这段代码是我在学习python面向对象——继承的时候写的代码，代码定义了长方形类和正方形类，其中<code>get_area</code>函数用来求对应对象的面积。</p>
<h4 id="坏味道说明-6">2.7.2 坏味道说明</h4>
<p>发散式变化是指修改一个类需要修改多个地方的代码，导致代码的可维护性差、扩展性差。这种坏味道的存在会导致代码的耦合度高、可维护性差、扩展性低等问题。</p>
<h4 id="重构方法-6">2.7.3 重构方法</h4>
<p>对于发散式变化的重构，可以考虑以下思路：</p>
<ol type="1">
<li>应用面向对象设计原则：例如单一职责原则（SRP）和开放封闭原则（OCP），确保代码的职责分明，易于扩展和维护。</li>
<li>重构共享代码：将不同职责之间共享的代码提取出来，形成通用的类或模块，以降低代码的冗余度。</li>
</ol>
<h4 id="重构后代码-6">2.7.4 重构后代码</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, width, height</span>):</span></span><br><span class="line">    	self.width = width</span><br><span class="line">	    self.height = height</span><br><span class="line">        </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get_area</span>(<span class="params">self</span>):</span></span><br><span class="line">    	<span class="keyword">return</span> self.width * self.height</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span>(<span class="params">Rectangle</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, side</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(side, side)霰弹式修改</span><br></pre></td></tr></table></figure>
<h3 id="数据泥团data-clumps">2.8 数据泥团（Data Clumps）</h3>
<h4 id="坏味道代码-7">2.8.1 坏味道代码</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calculate_total_cost</span><span class="params">(<span class="keyword">int</span> num_items, <span class="keyword">float</span> price_per_item, <span class="keyword">float</span> tax_rate)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> subtotal = num_items * price_per_item;</span><br><span class="line">    <span class="keyword">float</span> tax_amount = subtotal * tax_rate;</span><br><span class="line">    <span class="keyword">float</span> total_cost = subtotal + tax_amount;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Total cost: %.2f&quot;</span>, total_cost);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="坏味道说明-7">2.8.2 坏味道说明</h4>
<p>数据泥团指的是一组数据在代码中反复出现，这些数据之间存在某种联系或者依赖关系，但是却没有被单独封装起来。这样的代码会导致代码重复和可维护性下降。
在上述代码中，<code>num_items</code>、<code>price_per_item</code>、<code>tax_rate</code>、<code>subtotal</code>、<code>tax_amount</code>等数据反复出现，这些数据之间存在联系，但是没有被封装起来，导致代码重复，难以维护。</p>
<h4 id="重构方法-7">2.8.3 重构方法</h4>
<p>重构思路是将这些数据封装起来，形成一个独立的数据结构。这个数据结构可以是一个类、一个结构体、一个数组等等，具体形式取决于具体场景。
对于上述代码，我们可以将<code>num_items、price_per_item、tax_rate</code>封装成一个结构体，这样，我们就将相关的数据封装成一个Order结构体，并将计算<code>subtotal、tax_amount</code>的逻辑封装到了相应的函数中，代码变得更清晰、易于维护。</p>
<h4 id="重构后代码-7">2.8.4 重构后代码</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> num_items;</span><br><span class="line">    <span class="keyword">float</span> price_per_item;</span><br><span class="line">    <span class="keyword">float</span> tax_rate;</span><br><span class="line">&#125; Order;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">calculate_subtotal</span><span class="params">(Order order)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> order.num_items * order.price_per_item;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">calculate_tax_amount</span><span class="params">(Order order)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">calculate_subtotal</span>(order) * order.tax_rate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">calculate_total_cost</span><span class="params">(Order order)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> subtotal = <span class="built_in">calculate_subtotal</span>(order);</span><br><span class="line">    <span class="keyword">float</span> tax_amount = <span class="built_in">calculate_tax_amount</span>(order);</span><br><span class="line">    <span class="keyword">float</span> total_cost = subtotal + tax_amount;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Total cost: %.2f&quot;</span>, total_cost);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="三实验总结">三、实验总结</h2>
<p>​
通过这次重构实验，我深刻理解了重构在软件开发中的重要性。重构不仅可以改善代码的设计，提高代码的可读性和可维护性，还可以使代码更加清晰、简洁、易于扩展和修改。在重构过程中，我们需要熟悉常见的代码坏味道和重构方法，只有在深入理解和掌握了这些概念和技巧之后，才能正确地进行代码重构。</p>
<p>​ 在本次实验中，我阅读了Martin
Fowler的《重构-改善既有代码的设计》，并掌握了8种常见的代码坏味道及其重构方法。对于每一种坏味道，我都学会了相应的重构方法，例如，对于长方法，可以采取函数分解、函数组合以及提炼函数的方式进行重构；对于大类，可以采取提炼子类、提炼接口、提炼模块、提炼聚集以及提炼超类的方式进行重构。</p>
<p>​
在完成实验要求时，我选择了从自己过去写过的代码和Github等开源代码库中寻找这8种常见的坏味道，并对代码进行重构。在实践中，我深刻感受到了代码重构的必要性和难度。在重构过程中，需要仔细分析每一行代码以及代码之间的关系，考虑如何改进代码的结构和逻辑。同时还需要避免破坏代码的原有功能。</p>
<p>​
总之，通过这次实验，我对代码重构有了更深入的理解和认识。我认识到，在日后的编程工作中，我需要注意以下几个方面：首先，我的代码应该尽可能地简洁、可读、易于维护；其次，我应该时刻关注代码中存在的坏味道，及时采取相应的重构方法优化代码；最后，我需要不断学习和掌握新的技术和工具，以便更加高效和优雅地完成编程任务。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">dekrt</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://dekrt.cn/report/se-report/">https://dekrt.cn/report/se-report/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://dekrt.cn" target="_blank">dekrt's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%8A%A5%E5%91%8A-report/">报告 | report</a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2023/07/26/pCjsWb4.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechatpay.png" target="_blank"><img class="post-qr-code-img" src="/img/wechatpay.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/report/ccd/"><img class="prev-cover" src="https://z1.ax1x.com/2023/12/12/pifVYB4.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">编译原理课程实验报告</div></div></a></div><div class="next-post pull-right"><a href="/report/os-report/"><img class="next-cover" src="https://s1.ax1x.com/2023/07/26/pCjs4a9.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">操作系统实验报告&amp;课程设计</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/report/ccd/" title="编译原理课程实验报告"><img class="cover" src="https://z1.ax1x.com/2023/12/12/pifVYB4.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-12</div><div class="title">编译原理课程实验报告</div></div></a></div><div><a href="/report/os-report/" title="操作系统实验报告&课程设计"><img class="cover" src="https://s1.ax1x.com/2023/07/26/pCjs4a9.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-12</div><div class="title">操作系统实验报告&课程设计</div></div></a></div><div><a href="/report/cpsd/" title="软件设计综合实践实验报告"><img class="cover" src="https://s1.ax1x.com/2023/03/14/pplXRSO.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-14</div><div class="title">软件设计综合实践实验报告</div></div></a></div><div><a href="/report/experiment/" title="C语言实验报告"><img class="cover" src="https://s1.ax1x.com/2022/03/10/bhIu6J.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-21</div><div class="title">C语言实验报告</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s1.ax1x.com/2023/04/14/ppzvSxK.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">dekrt</div><div class="author-info__description">write something casually</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/dekrt"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/dekrt" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:dekrt@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://weibo.com/dekrt" target="_blank" title="Weibo"><i class="fab fa-weibo"></i></a><a class="social-icon" href="https://twitter.com/dekrt2" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a><a class="social-icon" href="https://instagram.com/dekrt" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">菜菜，呜呜，捞捞</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">1. 项目概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 项目基本介绍</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">
TransWe
</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-number">2.0.0.1.</span> <span class="toc-text">
Translate WeChat Mini Program
</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ui%E7%95%8C%E9%9D%A2"><span class="toc-number">2.0.1.</span> <span class="toc-text">📱 UI界面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.0.2.</span> <span class="toc-text">📖 项目介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E7%89%B9%E6%80%A7"><span class="toc-number">2.0.3.</span> <span class="toc-text">🚀 功能特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E6%8F%8F%E8%BF%B0"><span class="toc-number">2.0.4.</span> <span class="toc-text">🧱 目录结构描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E5%86%85%E5%AE%B9%E6%9B%B4%E6%96%B0"><span class="toc-number">2.0.5.</span> <span class="toc-text">⬇️ 版本内容更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.0.6.</span> <span class="toc-text">📃 协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#github%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80"><span class="toc-number">2.1.</span> <span class="toc-text">1.2 Github仓库地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%BA%E5%91%98%E5%9F%BA%E6%9C%AC%E5%88%86%E5%B7%A5"><span class="toc-number">2.2.</span> <span class="toc-text">1.3 人员基本分工</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dekrt%E8%B4%9F%E8%B4%A3%E4%BA%BA"><span class="toc-number">2.2.1.</span> <span class="toc-text">1.3.1 dekrt（负责人）：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cdt%E5%89%AF%E8%B4%9F%E8%B4%A3%E4%BA%BA"><span class="toc-number">2.2.2.</span> <span class="toc-text">1.3.2 cdt（副负责人）：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E6%8F%8F%E8%BF%B0"><span class="toc-number">3.</span> <span class="toc-text">2. 需求描述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%80%A7%E6%8F%8F%E8%BF%B0"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 功能性描述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E9%9C%80%E6%B1%82"><span class="toc-number">3.1.1.</span> <span class="toc-text">2.1.1 用户需求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E6%88%90%E7%BF%BB%E8%AF%91%E6%9C%8D%E5%8A%A1translation-service"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">1 集成翻译服务（Translation
Service）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E6%88%90%E7%AC%AC%E4%B8%89%E6%96%B9ocr%E5%8A%9F%E8%83%BDoptical-character-recognition"><span class="toc-number">3.1.1.2.</span> <span class="toc-text">2
集成第三方OCR功能（Optical Character Recognition）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E6%88%90%E7%AC%AC%E4%B8%89%E6%96%B9%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%ABspeech-recognition"><span class="toc-number">3.1.1.3.</span> <span class="toc-text">3
集成第三方语音识别(Speech Recognition):</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E6%88%90%E7%AC%AC%E4%B8%89%E6%96%B9%E8%AF%AD%E9%9F%B3%E5%90%88%E6%88%90speech-synthesis"><span class="toc-number">3.1.1.4.</span> <span class="toc-text">4 集成第三方语音合成（Speech
Synthesis）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E9%9C%80%E6%B1%82"><span class="toc-number">3.1.2.</span> <span class="toc-text">2.1.2 系统需求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%BF%BB%E8%AF%91%E5%8A%9F%E8%83%BDtranswe-sr-ts"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">1 基础翻译功能（TransWe-SR-TS）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E6%88%90%E7%AC%AC%E4%B8%89%E6%96%B9ocr%E5%8A%9F%E8%83%BD%E7%9A%84%E8%84%9A%E6%9C%ACtranswe-sr-ocr"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">2
集成第三方OCR功能的脚本（TransWe-SR-OCR）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB%E5%8A%9F%E8%83%BDtranswe-sr-sr"><span class="toc-number">3.1.2.3.</span> <span class="toc-text">3 语音识别功能（TransWe-SR-SR）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E9%9F%B3%E5%90%88%E6%88%90%E5%8A%9F%E8%83%BDtranswe-ur-ss"><span class="toc-number">3.1.2.4.</span> <span class="toc-text">4 语音合成功能（TransWe-UR-SS）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E5%8A%9F%E8%83%BD%E6%80%A7%E9%9C%80%E6%B1%82"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 非功能性需求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E9%9C%80%E6%B1%82"><span class="toc-number">3.2.1.</span> <span class="toc-text">2.2.1 性能需求：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%80%A7%E9%9C%80%E6%B1%82"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.2.2 安全性需求：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E7%94%A8%E6%80%A7%E9%9C%80%E6%B1%82"><span class="toc-number">3.2.3.</span> <span class="toc-text">2.2.3 可用性需求：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E7%BB%B4%E6%8A%A4%E6%80%A7%E9%9C%80%E6%B1%82"><span class="toc-number">3.2.4.</span> <span class="toc-text">2.2.4 可维护性需求：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7%E9%9C%80%E6%B1%82"><span class="toc-number">3.2.5.</span> <span class="toc-text">2.2.5 可扩展性需求：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C%E9%9C%80%E6%B1%82"><span class="toc-number">3.2.6.</span> <span class="toc-text">2.2.6 用户体验需求：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.</span> <span class="toc-text">3. 系统设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.1.</span> <span class="toc-text">3.1 架构设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%A4%BA%E5%B1%82presentation-layer"><span class="toc-number">4.1.1.</span> <span class="toc-text">3.1.1 表示层（Presentation
Layer）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%B1%82application-layer"><span class="toc-number">4.1.2.</span> <span class="toc-text">3.1.2 应用层（Application Layer）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%B1%82service-layer"><span class="toc-number">4.1.3.</span> <span class="toc-text">3.1.3 服务层（Service Layer）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%95%8C%E9%9D%A2%E5%8E%9F%E5%9E%8B%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.2.</span> <span class="toc-text">3.2界面原型设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%A1%B5%E9%9D%A2main-page"><span class="toc-number">4.2.1.</span> <span class="toc-text">3.2.1. 主页面（Main Page）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E8%A8%80%E9%80%89%E6%8B%A9%E9%A1%B5settings-page"><span class="toc-number">4.2.2.</span> <span class="toc-text">3.2.2.语言选择页（Settings Page）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E9%9F%B3%E7%BF%BB%E8%AF%91%E9%A1%B5voice-translation-page"><span class="toc-number">4.2.3.</span> <span class="toc-text">3.2.3.语音翻译页（Voice
Translation Page）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ocr%E6%8B%8D%E7%85%A7%E7%BF%BB%E8%AF%91%E9%A1%B5%E9%9D%A2ocr-translation-page"><span class="toc-number">4.2.4.</span> <span class="toc-text">3.2.4.OCR拍照翻译页面（OCR
Translation Page）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BF%BB%E8%AF%91%E5%8E%86%E5%8F%B2%E9%A1%B5translation-history-page"><span class="toc-number">4.2.5.</span> <span class="toc-text">3.2.5.翻译历史页（Translation
History Page）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.3.</span> <span class="toc-text">3.3 详细设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.3.1.</span> <span class="toc-text">3.3.1. 组件设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.3.2.</span> <span class="toc-text">3.3.2. 组件接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.2.1.</span> <span class="toc-text">1 数据库接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E8%A8%80%E8%AE%BE%E7%BD%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.2.2.</span> <span class="toc-text">2 语言设置接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ocr%E7%BF%BB%E8%AF%91%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.2.3.</span> <span class="toc-text">3 OCR翻译接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E9%9F%B3%E7%BF%BB%E8%AF%91%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.2.4.</span> <span class="toc-text">4 语音翻译接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E7%BF%BB%E8%AF%91%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.2.5.</span> <span class="toc-text">5 文本翻译接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.2.6.</span> <span class="toc-text">6 用户界面接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E9%9F%B3%E5%BD%95%E5%85%A5%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.2.7.</span> <span class="toc-text">7 语音录入接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E6%8E%A7%E5%88%B6%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.2.8.</span> <span class="toc-text">8 页面控制接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#api%E4%BF%A1%E6%81%AF%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.2.9.</span> <span class="toc-text">9 API信息配置接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BF%BB%E8%AF%91%E8%AE%B0%E5%BD%95"><span class="toc-number">4.3.2.10.</span> <span class="toc-text">10 翻译记录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-number">4.3.3.</span> <span class="toc-text">3.3.3 系统流程分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E7%BF%BB%E8%AF%91%E6%97%B6%E5%BA%8F%E5%9B%BE"><span class="toc-number">4.3.3.1.</span> <span class="toc-text">1 文本翻译时序图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%8D%E7%85%A7%E7%BF%BB%E8%AF%91%E6%97%B6%E5%BA%8F%E5%9B%BE"><span class="toc-number">4.3.3.2.</span> <span class="toc-text">2 拍照翻译时序图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E9%9F%B3%E7%BF%BB%E8%AF%91%E6%97%B6%E5%BA%8F%E5%9B%BE"><span class="toc-number">4.3.3.3.</span> <span class="toc-text">3 语音翻译时序图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E9%9F%B3%E5%90%88%E6%88%90%E6%97%B6%E5%BA%8F%E5%9B%BE"><span class="toc-number">4.3.3.4.</span> <span class="toc-text">4 语音合成时序图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%BF%BB%E8%AF%91%E5%8E%86%E5%8F%B2%E6%97%B6%E5%BA%8F%E5%9B%BE"><span class="toc-number">4.3.3.5.</span> <span class="toc-text">5 查看翻译历史时序图</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0%E5%92%8C%E6%B5%8B%E8%AF%95"><span class="toc-number">5.</span> <span class="toc-text">4. 系统实现和测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.1.</span> <span class="toc-text">4.1 系统实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#assets"><span class="toc-number">5.1.1.</span> <span class="toc-text">4.1.1 assets&#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#assetsiconfont.wxss"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">4.1.1.1 assets&#x2F;iconfont.wxss</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#components"><span class="toc-number">5.1.2.</span> <span class="toc-text">4.1.2 components&#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#componentsbottom-button"><span class="toc-number">5.1.2.1.</span> <span class="toc-text">4.1.2.1 components&#x2F;bottom-button</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#componentsmodal"><span class="toc-number">5.1.2.2.</span> <span class="toc-text">4.1.2.2 components&#x2F;modal</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pages"><span class="toc-number">5.1.3.</span> <span class="toc-text">4.1.4 pages&#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pageschoose_language"><span class="toc-number">5.1.3.1.</span> <span class="toc-text">4.1.4.1 pages&#x2F;choose_language</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#choose_language.js"><span class="toc-number">5.1.3.1.1.</span> <span class="toc-text">1 choose_language.js</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#choose_language.json"><span class="toc-number">5.1.3.1.2.</span> <span class="toc-text">2 choose_language.json</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#choose_language.wxml"><span class="toc-number">5.1.3.1.3.</span> <span class="toc-text">3 choose_language.wxml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#choose_language.wxss"><span class="toc-number">5.1.3.1.4.</span> <span class="toc-text">4 choose_language.wxss</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pagesedit"><span class="toc-number">5.1.3.2.</span> <span class="toc-text">4.1.4.2 pages&#x2F;edit</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#edit.js"><span class="toc-number">5.1.3.2.1.</span> <span class="toc-text">1 edit.js</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#edit.json"><span class="toc-number">5.1.3.2.2.</span> <span class="toc-text">2 edit.json</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#edit.wxml"><span class="toc-number">5.1.3.2.3.</span> <span class="toc-text">3 edit.wxml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#edit.wxss"><span class="toc-number">5.1.3.2.4.</span> <span class="toc-text">3 edit.wxss</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pagesgetpic"><span class="toc-number">5.1.3.3.</span> <span class="toc-text">4.1.4.3 pages&#x2F;getPic</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#getpic.js"><span class="toc-number">5.1.3.3.1.</span> <span class="toc-text">1 getPic.js</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#getpic.json"><span class="toc-number">5.1.3.3.2.</span> <span class="toc-text">2 getPic.json</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#getpic.wxml"><span class="toc-number">5.1.3.3.3.</span> <span class="toc-text">3 getPic.wxml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#getpic.wxss"><span class="toc-number">5.1.3.3.4.</span> <span class="toc-text">4 getPic.wxss</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pageshistory"><span class="toc-number">5.1.3.4.</span> <span class="toc-text">4.1.4.4 pages&#x2F;history</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#history.js"><span class="toc-number">5.1.3.4.1.</span> <span class="toc-text">1 history.js</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#history.json"><span class="toc-number">5.1.3.4.2.</span> <span class="toc-text">2 history.json</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#history.wxml"><span class="toc-number">5.1.3.4.3.</span> <span class="toc-text">3 history.wxml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#history.wxss"><span class="toc-number">5.1.3.4.4.</span> <span class="toc-text">4 history.wxss</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pagesindex"><span class="toc-number">5.1.3.5.</span> <span class="toc-text">4.1.4.5 pages&#x2F;index</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#index.js"><span class="toc-number">5.1.3.5.1.</span> <span class="toc-text">1 index.js</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#index.json"><span class="toc-number">5.1.3.5.2.</span> <span class="toc-text">2 index.json</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#index.wxml"><span class="toc-number">5.1.3.5.3.</span> <span class="toc-text">3 index.wxml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#index.wxss"><span class="toc-number">5.1.3.5.4.</span> <span class="toc-text">4 index.wxss</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pagesocr"><span class="toc-number">5.1.3.6.</span> <span class="toc-text">4.1.4.6 pages&#x2F;OCR</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ocr.js"><span class="toc-number">5.1.3.6.1.</span> <span class="toc-text">1 OCR.js</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ocr.json"><span class="toc-number">5.1.3.6.2.</span> <span class="toc-text">2 OCR.json</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ocr.wxml"><span class="toc-number">5.1.3.6.3.</span> <span class="toc-text">3 OCR.wxml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ocr.wxss"><span class="toc-number">5.1.3.6.4.</span> <span class="toc-text">4 OCR.wxss</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pagesvoice_translation"><span class="toc-number">5.1.3.7.</span> <span class="toc-text">4.1.4.7 pages&#x2F;voice_translation</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#voice_translation.js"><span class="toc-number">5.1.3.7.1.</span> <span class="toc-text">1 voice_translation.js</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#voice_translation.json"><span class="toc-number">5.1.3.7.2.</span> <span class="toc-text">2 voice_translation.json</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#voice_translationt.wxml"><span class="toc-number">5.1.3.7.3.</span> <span class="toc-text">3 voice_translationt.wxml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#voice_translation.wxss"><span class="toc-number">5.1.3.7.4.</span> <span class="toc-text">3 voice_translation.wxss</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tdd_test_cdt"><span class="toc-number">5.1.4.</span> <span class="toc-text">4.1.5 TDD_test_cdt&#x2F;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tdd_test_zxk"><span class="toc-number">5.1.5.</span> <span class="toc-text">4.1.6 TDD_test_zxk&#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#node_modules"><span class="toc-number">5.1.5.1.</span> <span class="toc-text">4.1.6.1 node_modules</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#translate.js"><span class="toc-number">5.1.5.2.</span> <span class="toc-text">4.1.6.2 translate.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ranslate.test.js"><span class="toc-number">5.1.5.3.</span> <span class="toc-text">4.1.6.3 ranslate.test.js</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#utils"><span class="toc-number">5.1.6.</span> <span class="toc-text">4.1.7 utils&#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#utilsapi.js"><span class="toc-number">5.1.6.1.</span> <span class="toc-text">4.1.7.1 utils&#x2F;api.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#utilsconf.js"><span class="toc-number">5.1.6.2.</span> <span class="toc-text">4.1.7.2 utils&#x2F;conf.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#md5.min.js"><span class="toc-number">5.1.6.3.</span> <span class="toc-text">4.1.7.3 md5.min.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#util.js"><span class="toc-number">5.1.6.4.</span> <span class="toc-text">4.1.7.4 util.js</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#section"><span class="toc-number">5.1.7.</span> <span class="toc-text">4.1.8 .&#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#app.js"><span class="toc-number">5.1.7.1.</span> <span class="toc-text">4.8.8.1 .&#x2F;app.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#app.json"><span class="toc-number">5.1.7.2.</span> <span class="toc-text">4.8.8.2 .&#x2F;app.json</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#app.wxss"><span class="toc-number">5.1.7.3.</span> <span class="toc-text">4.8.8.3 .&#x2F;app.wxss</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#project.config.json"><span class="toc-number">5.1.7.4.</span> <span class="toc-text">4.8.8.4 .&#x2F;project.config.json</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#project.private.config.json"><span class="toc-number">5.1.7.5.</span> <span class="toc-text">4.8.8.5
.&#x2F;project.private.config.json</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%B5%8B%E8%AF%95"><span class="toc-number">5.2.</span> <span class="toc-text">4.2 系统测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tdd%E6%B5%8B%E8%AF%95"><span class="toc-number">5.2.1.</span> <span class="toc-text">4.2.1 TDD测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tdd_test_cdt-1"><span class="toc-number">5.2.1.1.</span> <span class="toc-text">4.2.1.1 TDD_test_cdt&#x2F;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tdd_test_zxk-1"><span class="toc-number">5.2.1.2.</span> <span class="toc-text">4.2.1.2 TDD_test_zxk&#x2F;</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%95%8C%E9%9D%A2%E5%B1%95%E7%A4%BA"><span class="toc-number">6.</span> <span class="toc-text">5. 系统界面展示</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#index-%E4%B8%BB%E9%A1%B5"><span class="toc-number">6.1.</span> <span class="toc-text">5.1 index | 主页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#choose_language-%E9%80%89%E6%8B%A9%E8%AF%AD%E8%A8%80%E7%95%8C%E9%9D%A2"><span class="toc-number">6.2.</span> <span class="toc-text">5.2 choose_language |
选择语言界面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#getpic-%E6%8B%8D%E7%85%A7%E7%95%8C%E9%9D%A2"><span class="toc-number">6.3.</span> <span class="toc-text">5.3 getPic | 拍照界面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ocr-%E6%8B%8D%E7%85%A7%E7%BF%BB%E8%AF%91%E7%BB%93%E6%9E%9C"><span class="toc-number">6.4.</span> <span class="toc-text">5.4 OCR | 拍照翻译结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#voice_translation-%E8%AF%AD%E9%9F%B3%E7%BF%BB%E8%AF%91%E9%A1%B5%E9%9D%A2"><span class="toc-number">6.5.</span> <span class="toc-text">5.5 voice_translation |
语音翻译页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#edit-%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E7%95%8C%E9%9D%A2"><span class="toc-number">6.6.</span> <span class="toc-text">5.6 edit | 文本编辑界面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#history-%E7%BF%BB%E8%AF%91%E5%8E%86%E5%8F%B2"><span class="toc-number">6.7.</span> <span class="toc-text">5.7 history | 翻译历史</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">7.</span> <span class="toc-text">6. 总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%90%86%E8%AE%BA%E8%AF%BE%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A"><span class="toc-number">8.</span> <span class="toc-text">7. 理论课实验报告</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84%E5%86%85%E5%AE%B9%E5%92%8C%E8%A6%81%E6%B1%82"><span class="toc-number">8.1.</span> <span class="toc-text">一、实验目的、内容和要求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%90%8D%E7%A7%B0"><span class="toc-number">8.1.1.</span> <span class="toc-text">1.1 实验名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84"><span class="toc-number">8.1.2.</span> <span class="toc-text">1.2 实验目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9%E5%92%8C%E8%A6%81%E6%B1%82"><span class="toc-number">8.1.3.</span> <span class="toc-text">1.3 实验内容和要求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84"><span class="toc-number">8.2.</span> <span class="toc-text">二、代码重构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%9E%841%E7%A5%9E%E7%A7%98%E5%91%BD%E5%90%8Dmysterious-name"><span class="toc-number">8.2.1.</span> <span class="toc-text">2.1 重构1：神秘命名（Mysterious
Name）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E4%BB%A3%E7%A0%81"><span class="toc-number">8.2.1.1.</span> <span class="toc-text">2.1.1 坏味道代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E8%AF%B4%E6%98%8E"><span class="toc-number">8.2.1.2.</span> <span class="toc-text">2.1.2 坏味道说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E6%96%B9%E6%B3%95"><span class="toc-number">8.2.1.3.</span> <span class="toc-text">2.1.3 重构方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E5%90%8E%E4%BB%A3%E7%A0%81"><span class="toc-number">8.2.1.4.</span> <span class="toc-text">2.1.4 重构后代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%9E%842%E9%87%8D%E5%A4%8D%E4%BB%A3%E7%A0%81duplicated-code"><span class="toc-number">8.2.2.</span> <span class="toc-text">2.2 重构2：重复代码（Duplicated
Code）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E4%BB%A3%E7%A0%81-1"><span class="toc-number">8.2.2.1.</span> <span class="toc-text">2.2.1 坏味道代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E8%AF%B4%E6%98%8E-1"><span class="toc-number">8.2.2.2.</span> <span class="toc-text">2.2.2 坏味道说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E6%96%B9%E6%B3%95-1"><span class="toc-number">8.2.2.3.</span> <span class="toc-text">2.2.3 重构方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E5%90%8E%E4%BB%A3%E7%A0%81-1"><span class="toc-number">8.2.2.4.</span> <span class="toc-text">2.2.4 重构后代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%9E%843%E8%BF%87%E9%95%BF%E5%87%BD%E6%95%B0long-function"><span class="toc-number">8.2.3.</span> <span class="toc-text">2.3 重构3：过长函数（Long
Function）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E4%BB%A3%E7%A0%81-2"><span class="toc-number">8.2.3.1.</span> <span class="toc-text">2.3.1 坏味道代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E8%AF%B4%E6%98%8E-2"><span class="toc-number">8.2.3.2.</span> <span class="toc-text">2.3.2 坏味道说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E6%96%B9%E6%B3%95-2"><span class="toc-number">8.2.3.3.</span> <span class="toc-text">2.3.3 重构方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E5%90%8E%E4%BB%A3%E7%A0%81-2"><span class="toc-number">8.2.3.4.</span> <span class="toc-text">2.3.4 重构后代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%9E%844%E8%BF%87%E9%95%BF%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8long-parameter-list"><span class="toc-number">8.2.4.</span> <span class="toc-text">2.4
重构4:过长参数列表（Long Parameter List）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E4%BB%A3%E7%A0%81-3"><span class="toc-number">8.2.4.1.</span> <span class="toc-text">2.4.1 坏味道代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E8%AF%B4%E6%98%8E-3"><span class="toc-number">8.2.4.2.</span> <span class="toc-text">2.4.2 坏味道说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E6%96%B9%E6%B3%95-3"><span class="toc-number">8.2.4.3.</span> <span class="toc-text">2.4.3 重构方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E5%90%8E%E4%BB%A3%E7%A0%81-3"><span class="toc-number">8.2.4.4.</span> <span class="toc-text">2.4.4 重构后代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%9E%845-%E5%85%A8%E5%B1%80%E6%95%B0%E6%8D%AEglobal-data"><span class="toc-number">8.2.5.</span> <span class="toc-text">2.5 重构5: 全局数据（Global
Data）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E4%BB%A3%E7%A0%81-4"><span class="toc-number">8.2.5.1.</span> <span class="toc-text">2.5.1 坏味道代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E8%AF%B4%E6%98%8E-4"><span class="toc-number">8.2.5.2.</span> <span class="toc-text">2.5.2 坏味道说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E6%96%B9%E6%B3%95-4"><span class="toc-number">8.2.5.3.</span> <span class="toc-text">2.5.3 重构方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E5%90%8E%E4%BB%A3%E7%A0%81-4"><span class="toc-number">8.2.5.4.</span> <span class="toc-text">2.5.4 重构后代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E5%8F%98%E6%95%B0%E6%8D%AE"><span class="toc-number">8.2.6.</span> <span class="toc-text">2.6 可变数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E4%BB%A3%E7%A0%81-5"><span class="toc-number">8.2.6.1.</span> <span class="toc-text">2.6.1 坏味道代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E8%AF%B4%E6%98%8E-5"><span class="toc-number">8.2.6.2.</span> <span class="toc-text">2.6.2 坏味道说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E6%96%B9%E6%B3%95-5"><span class="toc-number">8.2.6.3.</span> <span class="toc-text">2.6.3 重构方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E5%90%8E%E4%BB%A3%E7%A0%81-5"><span class="toc-number">8.2.6.4.</span> <span class="toc-text">2.6.4 重构后代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%9E%847-%E5%8F%91%E6%95%A3%E5%BC%8F%E5%8F%98%E5%8C%96divergent-change"><span class="toc-number">8.2.7.</span> <span class="toc-text">2.7 重构7:
发散式变化（Divergent Change）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E4%BB%A3%E7%A0%81-6"><span class="toc-number">8.2.7.1.</span> <span class="toc-text">2.7.1 坏味道代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E8%AF%B4%E6%98%8E-6"><span class="toc-number">8.2.7.2.</span> <span class="toc-text">2.7.2 坏味道说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E6%96%B9%E6%B3%95-6"><span class="toc-number">8.2.7.3.</span> <span class="toc-text">2.7.3 重构方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E5%90%8E%E4%BB%A3%E7%A0%81-6"><span class="toc-number">8.2.7.4.</span> <span class="toc-text">2.7.4 重构后代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B3%A5%E5%9B%A2data-clumps"><span class="toc-number">8.2.8.</span> <span class="toc-text">2.8 数据泥团（Data Clumps）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E4%BB%A3%E7%A0%81-7"><span class="toc-number">8.2.8.1.</span> <span class="toc-text">2.8.1 坏味道代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%8F%E5%91%B3%E9%81%93%E8%AF%B4%E6%98%8E-7"><span class="toc-number">8.2.8.2.</span> <span class="toc-text">2.8.2 坏味道说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E6%96%B9%E6%B3%95-7"><span class="toc-number">8.2.8.3.</span> <span class="toc-text">2.8.3 重构方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%9E%84%E5%90%8E%E4%BB%A3%E7%A0%81-7"><span class="toc-number">8.2.8.4.</span> <span class="toc-text">2.8.4 重构后代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E5%AE%9E%E9%AA%8C%E6%80%BB%E7%BB%93"><span class="toc-number">8.3.</span> <span class="toc-text">三、实验总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/report/ccd/" title="编译原理课程实验报告"><img src="https://z1.ax1x.com/2023/12/12/pifVYB4.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="编译原理课程实验报告"/></a><div class="content"><a class="title" href="/report/ccd/" title="编译原理课程实验报告">编译原理课程实验报告</a><time datetime="2023-12-12T12:09:46.000Z" title="发表于 2023-12-12 20:09:46">2023-12-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/report/se-report/" title="软件工程课程设计 &amp; 理论课实验报告"><img src="https://s1.ax1x.com/2023/07/26/pCjsWb4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="软件工程课程设计 &amp; 理论课实验报告"/></a><div class="content"><a class="title" href="/report/se-report/" title="软件工程课程设计 &amp; 理论课实验报告">软件工程课程设计 &amp; 理论课实验报告</a><time datetime="2023-07-18T03:09:40.000Z" title="发表于 2023-07-18 11:09:40">2023-07-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/report/os-report/" title="操作系统实验报告&amp;课程设计"><img src="https://s1.ax1x.com/2023/07/26/pCjs4a9.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="操作系统实验报告&amp;课程设计"/></a><div class="content"><a class="title" href="/report/os-report/" title="操作系统实验报告&amp;课程设计">操作系统实验报告&amp;课程设计</a><time datetime="2023-07-12T03:43:44.000Z" title="发表于 2023-07-12 11:43:44">2023-07-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/tutorial/maike/" title="安全教育刷课教程"><img src="https://s1.ax1x.com/2023/04/14/ppzT0Vx.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="安全教育刷课教程"/></a><div class="content"><a class="title" href="/tutorial/maike/" title="安全教育刷课教程">安全教育刷课教程</a><time datetime="2023-04-14T08:04:24.000Z" title="发表于 2023-04-14 16:04:24">2023-04-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/tutorial/book/" title="课本pdf互助站"><img src="https://s1.ax1x.com/2023/03/27/ppyNdwq.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="课本pdf互助站"/></a><div class="content"><a class="title" href="/tutorial/book/" title="课本pdf互助站">课本pdf互助站</a><time datetime="2023-03-27T13:23:13.000Z" title="发表于 2023-03-27 21:23:13">2023-03-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s1.ax1x.com/2023/07/26/pCjsWb4.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By dekrt</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">你是宇宙中恰好相遇的浪漫</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '919vOTDx94zr39dk7GN8V5oO-gzGzoHsz',
      appKey: 'SNQo190ERObk522PearaqLyG',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>